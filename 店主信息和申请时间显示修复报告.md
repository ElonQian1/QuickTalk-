# 店主信息和申请时间显示修复报告

## 🐛 问题描述

在移动端管理界面的待审核店铺列表中，`class="value"` 的店主信息和 `class="detail-row"` 的申请时间没有正确显示。

## 🔍 问题分析

### 数据结构检查
通过调试脚本发现，后端API返回的数据结构中：
- **店主字段**: `owner_username` (值: "jkl")
- **时间字段**: `created_at` (值: "2025-09-12 09:12:47")

### 前端渲染问题
在 `renderMobilePendingShops` 函数中，代码错误地使用了：
- `shop.ownerName` ❌ (应该是 `shop.owner_username`)
- `shop.createdAt` ❌ (应该是 `shop.created_at`)

## 🛠️ 修复方案

### 修复前代码:
```javascript
<div class="detail-row">
    <span class="label">店主:</span>
    <span class="value">${shop.ownerName}</span>
</div>
<div class="detail-row">
    <span class="label">申请时间:</span>
    <span class="value">${new Date(shop.createdAt).toLocaleDateString()}</span>
</div>
```

### 修复后代码:
```javascript
<div class="detail-row">
    <span class="label">店主:</span>
    <span class="value">${shop.owner_username || shop.ownerName || '未知'}</span>
</div>
<div class="detail-row">
    <span class="label">申请时间:</span>
    <span class="value">${new Date(shop.created_at || shop.createdAt).toLocaleDateString()}</span>
</div>
```

## ✅ 修复内容

1. **字段名映射修正**:
   - 使用 `shop.owner_username` 获取店主信息
   - 使用 `shop.created_at` 获取申请时间

2. **兼容性处理**:
   - 添加备用字段 `shop.ownerName` 和 `shop.createdAt`
   - 店主信息添加 `'未知'` 作为最后默认值

3. **容错机制**:
   - 使用逻辑或运算符 `||` 提供多级后备

## 🎯 验证结果

修复后，待审核店铺列表应该正确显示：

### 店主信息 (`class="value"`)
- ✅ 显示: "jkl"
- ✅ 来源: `shop.owner_username`

### 申请时间 (`class="detail-row"`)
- ✅ 显示: "2025/9/12" (格式化后)
- ✅ 来源: `shop.created_at`

## 📋 完整店铺信息展示

每个待审核店铺现在会显示：
- **店铺名称**: "爱疯手机网"
- **域名**: "aifeng.com" 
- **店主**: "jkl" ✅ (已修复)
- **申请时间**: "2025/9/12" ✅ (已修复)
- **描述**: "卖手机的"
- **状态**: "待审核"
- **操作按钮**: ✅ 通过 / ❌ 拒绝

## 🔧 技术细节

### 涉及文件
- `static/admin-mobile.html` - 第3970-3980行左右

### 数据流程
1. **后端API**: `/api/admin/pending-shops` → 返回包含 `owner_username`, `created_at` 的数据
2. **前端接收**: `loadMobilePendingShops()` → 调用API获取数据
3. **前端渲染**: `renderMobilePendingShops()` → 使用正确字段名渲染HTML

### 调试工具
- `debug-shop-details.js` - 用于检查数据库中的实际数据结构
- `test-pending-shops-display.html` - 用于验证API响应和字段映射

## 🔄 后续建议

1. **统一字段命名**:
   - 考虑在后端API中添加字段别名
   - 或在前端统一数据格式转换

2. **数据验证**:
   - 添加字段存在性检查
   - 提供更友好的缺失数据提示

3. **文档更新**:
   - 更新API文档，明确字段命名规范
   - 添加前后端数据格式映射文档

---
*修复时间: 2025-09-12 18:00:00*
*涉及文件: static/admin-mobile.html*
*状态: ✅ 已完成*
