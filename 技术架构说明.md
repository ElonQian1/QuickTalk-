# 客服系统技术架构说明

## 系统组成

### 1. 后端服务器 (您的服务器)
```
┌─────────────────────────────────────┐
│         您的服务器                    │
│   ┌─────────────────────────────┐    │
│   │     Node.js Express         │    │
│   │     端口: 3030              │    │
│   │                             │    │
│   │  ┌─────────────────────┐     │    │
│   │  │   HTTP API 接口     │     │    │
│   │  │  /api/connect      │     │    │
│   │  │  /api/messages     │     │    │
│   │  │  /api/send         │     │    │
│   │  └─────────────────────┘     │    │
│   │                             │    │
│   │  ┌─────────────────────┐     │    │
│   │  │   WebSocket 服务    │     │    │
│   │  │   (实时通信)        │     │    │
│   │  └─────────────────────┘     │    │
│   └─────────────────────────────┘    │
└─────────────────────────────────────┘
```

### 2. 朋友的网站 (客户端)
```
┌─────────────────────────────────────┐
│       朋友的网站                      │
│   ┌─────────────────────────────┐    │
│   │    网站主体内容              │    │
│   │   (PHP/ASP/Java/等)        │    │
│   │                             │    │
│   │  ┌─────────────────────┐     │    │
│   │  │   嵌入的客服代码     │     │    │
│   │  │  (您提供的HTML/JS)  │     │    │
│   │  │                     │     │    │
│   │  │  通过HTTP请求连接    │     │    │
│   │  │  到您的服务器        │     │    │
│   │  └─────────────────────┘     │    │
│   └─────────────────────────────┘    │
└─────────────────────────────────────┘
```

## 工作原理

### 1. 代码嵌入方式
朋友的网站支持以下任一方式：

#### A. 后台管理面板
- 网站管理员登录后台
- 在"自定义代码"/"插件"/"小工具"区域
- 粘贴您提供的完整HTML代码

#### B. 模板文件编辑
- 直接编辑网站模板文件
- 在 `<head>` 或 `<body>` 标签内添加代码

#### C. 插件/扩展系统
- 通过插件形式安装
- 配置服务器地址等参数

### 2. 通信流程
```
用户访问朋友网站
         ↓
    页面加载客服代码
         ↓
   客服代码连接您的服务器
         ↓
    建立通信通道
         ↓
   用户可以与客服对话
```

### 3. 跨域解决方案
您的服务器设置了CORS头：
```javascript
res.header('Access-Control-Allow-Origin', '*');
```
这允许任何域名的网站调用您的API。

## 常见的支持这种集成的网站类型

### 1. 内容管理系统 (CMS)
- **WordPress**: 通过插件或主题编辑器
- **Drupal**: 自定义模块或区块
- **Joomla**: 自定义组件
- **TYPO3**: 扩展或模板

### 2. 电商平台
- **Shopify**: 主题编辑器
- **WooCommerce**: 自定义代码区
- **Magento**: 模板或扩展
- **OpenCart**: 修改模板

### 3. 论坛系统
- **Discuz!**: 插件或模板修改
- **phpBB**: 自定义MOD
- **vBulletin**: 插件系统

### 4. 建站平台
- **Wix**: 高级账户支持自定义代码
- **Squarespace**: 代码注入功能
- **Webflow**: 自定义代码组件

### 5. 自开发网站
- 开发者友好的系统
- 支持第三方集成
- 灵活的架构设计

## 技术要求

### 对朋友网站的要求
1. **支持HTML/CSS/JavaScript**: 能够添加自定义代码
2. **网络连接**: 能够发出HTTP请求到外部服务器
3. **现代浏览器**: 支持 fetch API 和 ES6+

### 对您服务器的要求
1. **公网访问**: 服务器要有公网IP或域名
2. **CORS配置**: 允许跨域请求
3. **稳定运行**: 保持服务器24/7运行

## 配置步骤

### 1. 修改服务器地址
在嵌入代码中找到：
```javascript
const SERVER_URL = 'http://localhost:3030';
```
改为您的实际服务器地址：
```javascript
const SERVER_URL = 'http://您的域名或IP:3030';
```

### 2. 启动您的服务器
```bash
cd 论坛客服项目
npm start
```

### 3. 提供代码给朋友
将修改后的 `embed-customer-service-http.html` 内容给朋友

### 4. 朋友网站集成
朋友在其网站后台粘贴完整代码即可

## 安全考虑

1. **HTTPS**: 生产环境建议使用HTTPS
2. **域名限制**: 可以限制允许的域名
3. **消息过滤**: 添加内容过滤机制
4. **频率限制**: 防止API滥用

这就是为什么您的代码能够在朋友网站上工作的完整技术原理！
