# 店主账号移动端访问问题修复说明

## 问题诊断
店主账号 `shop_owner` 登录后无法在移动端看到自己的店铺列表，错误信息：
```
GET http://localhost:3030/api/admin/shops 403 (Forbidden)
API响应错误: {"error":"需要超级管理员权限"}
```

## 问题根源
1. **认证机制不匹配**: 桌面版使用 `X-Session-Id` 头部，移动端使用 `Authorization Bearer` 头部
2. **认证信息缺失**: 移动端页面没有有效的session传递机制
3. **后端中间件**: `requireAuth` 函数只支持 `X-Session-Id` 方式

## 修复方案

### 1. 后端修复
更新 `server.js` 中的 `requireAuth` 函数，同时支持两种认证方式：
- `X-Session-Id` (桌面版)
- `Authorization: Bearer` (移动端)

### 2. 前端修复
- 修改移动端店铺管理器使用 `X-Session-Id` 方式
- 添加从URL参数获取session ID的功能
- 在桌面版添加跳转到移动端的按钮

### 3. 跳转机制
桌面版现在有 "📱 手机版" 按钮，点击后会：
- 获取当前用户的session ID
- 打开新窗口访问 `/mobile-admin?sessionId=xxx`
- 移动端自动获取URL中的session ID进行认证

## 使用方法

### 方法1: 从桌面端跳转（推荐）
1. 用店主账号登录桌面版: `http://localhost:3030/admin`
2. 登录成功后，点击右上角的 "📱 手机版" 按钮
3. 系统会自动打开移动端，并传递当前用户的登录凭据
4. 在移动端点击底部导航的 "店铺" 按钮即可看到店铺列表

### 方法2: 直接访问移动端（需要session ID）
1. 先在桌面端登录获取session ID
2. 手动访问: `http://localhost:3030/mobile-admin?sessionId=你的sessionId`
3. 点击 "店铺" 按钮查看列表

### 方法3: 临时测试（如果上述方法不可用）
如果你急需测试，可以：
1. 打开浏览器开发工具
2. 在Console中运行：`sessionStorage.setItem('currentSessionId', 'sess_你的sessionID')`
3. 刷新移动端页面
4. 点击 "店铺" 按钮

## 验证修复

访问移动端时，应该能看到：
1. ✅ 店铺列表正常显示
2. ✅ 店铺卡片包含完整信息（名称、域名、状态等）
3. ✅ 统计数据（总店铺数、运行中、审核中）
4. ✅ 操作按钮（查看消息、管理店铺等）

## 错误处理

如果仍然遇到问题，检查：
1. **浏览器控制台**: 查看是否有JavaScript错误
2. **网络请求**: 确认请求头包含正确的 `X-Session-Id`
3. **服务器日志**: 查看认证是否成功

## 技术细节

### 认证流程
```javascript
// 获取session ID的优先级
1. URL参数: ?sessionId=xxx
2. sessionStorage: currentSessionId  
3. localStorage: adminToken (兼容性)
```

### API请求示例
```javascript
fetch('/api/admin/shops', {
    headers: {
        'X-Session-Id': sessionId,
        'Content-Type': 'application/json'
    }
})
```

## 后续优化建议

1. **统一认证机制**: 考虑统一使用JWT token
2. **自动登录**: 添加移动端独立的登录界面
3. **离线缓存**: 实现店铺数据的本地缓存
4. **推送通知**: 添加新消息的实时推送

---

现在你可以用店主账号测试移动端的店铺管理功能了！🎉
