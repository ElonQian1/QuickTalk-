<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åˆ†æä»ªè¡¨æ¿ - QuickTalkå®¢æœç³»ç»Ÿ</title>
    
    <!-- æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="/static/css/analytics-dashboard.css">
    <link rel="stylesheet" href="/static/css/style.css">
    
    <!-- Chart.js å›¾è¡¨åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- å›¾æ ‡å­—ä½“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* å¿«é€Ÿæ ·å¼è¦†ç›– */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
        }
        
        /* å¯¼èˆªæ æ ·å¼ */
        .top-nav {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .nav-title {
            color: white;
            font-size: 20px;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .nav-menu {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .nav-item {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateY(-1px);
        }
        
        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* å¿«é€Ÿæ“ä½œæ  */
        .quick-actions {
            background: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .quick-action-btn {
            padding: 8px 16px;
            border: 1px solid #e3e8ef;
            border-radius: 8px;
            background: white;
            color: #2c3e50;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .quick-action-btn:hover {
            background: #f8f9fa;
            border-color: #3498db;
            color: #3498db;
            transform: translateY(-1px);
        }
        
        /* é¡µè„š */
        .footer {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
            font-size: 14px;
            border-top: 1px solid #ecf0f1;
            margin-top: 40px;
            background: white;
        }
        
        /* å“åº”å¼èœå• */
        @media (max-width: 768px) {
            .nav-content {
                flex-direction: column;
                gap: 16px;
            }
            
            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .quick-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="top-nav">
        <div class="nav-content">
            <h1 class="nav-title">
                ğŸ“Š QuickTalk æ•°æ®åˆ†æä»ªè¡¨æ¿
            </h1>
            <div class="nav-menu">
                <a href="/mobile/admin" class="nav-item">
                    <i class="fas fa-comments"></i> å®¢æœç®¡ç†
                </a>
                <a href="/analytics" class="nav-item active">
                    <i class="fas fa-chart-bar"></i> æ•°æ®åˆ†æ
                </a>
                <a href="/integration-generator.html" class="nav-item">
                    <i class="fas fa-code"></i> é›†æˆä»£ç 
                </a>
                <a href="/test-search-history.html" class="nav-item">
                    <i class="fas fa-search"></i> æœç´¢æµ‹è¯•
                </a>
                <a href="/" class="nav-item">
                    <i class="fas fa-home"></i> é¦–é¡µ
                </a>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
        <!-- å¿«é€Ÿæ“ä½œæ  -->
        <div class="quick-actions">
            <span style="color: #7f8c8d; font-weight: 500;">å¿«é€Ÿæ“ä½œ:</span>
            <a href="#" class="quick-action-btn" onclick="dashboard && dashboard.refreshData()">
                <i class="fas fa-sync"></i> åˆ·æ–°æ•°æ®
            </a>
            <a href="#" class="quick-action-btn" onclick="dashboard && dashboard.generateKpiReport()">
                <i class="fas fa-file-alt"></i> ç”ŸæˆæŠ¥å‘Š
            </a>
            <a href="#" class="quick-action-btn" onclick="dashboard && dashboard.exportReport()">
                <i class="fas fa-download"></i> å¯¼å‡ºæ•°æ®
            </a>
            <a href="#" class="quick-action-btn" onclick="toggleFullscreen()">
                <i class="fas fa-expand"></i> å…¨å±æ¨¡å¼
            </a>
            <a href="#" class="quick-action-btn" onclick="showHelp()">
                <i class="fas fa-question-circle"></i> å¸®åŠ©
            </a>
        </div>

        <!-- æ•°æ®åˆ†æä»ªè¡¨æ¿å®¹å™¨ -->
        <div id="analytics-dashboard">
            <!-- ä»ªè¡¨æ¿å†…å®¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            <div style="text-align: center; padding: 60px 20px; color: #7f8c8d;">
                <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“Š</div>
                <h2 style="margin: 0 0 16px 0; color: #2c3e50;">æ­£åœ¨åˆå§‹åŒ–æ•°æ®åˆ†æä»ªè¡¨æ¿...</h2>
                <p style="margin: 0; font-size: 16px;">è¯·ç¨å€™ï¼Œæˆ‘ä»¬æ­£åœ¨ä¸ºæ‚¨å‡†å¤‡æœ€æ–°çš„æ•°æ®åˆ†æã€‚</p>
                <div style="margin-top: 30px;">
                    <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #ecf0f1; border-left: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="footer">
        <p>Â© 2024 QuickTalk å®¢æœç³»ç»Ÿ - ç¬¬ä¸‰é˜¶æ®µ: æ•°æ®åˆ†æä»ªè¡¨æ¿</p>
        <p style="margin-top: 8px; font-size: 12px; opacity: 0.8;">
            å®æ—¶ç›‘æ§ | æ•ˆç‡åˆ†æ | å®¢æˆ·æ´å¯Ÿ | æ™ºèƒ½æŠ¥å‘Š
        </p>
    </footer>

    <!-- JavaScript åº“å’Œè„šæœ¬ -->
    <script src="/static/js/analytics-dashboard.js"></script>
    
    <script>
        // é¡µé¢çº§åˆ«çš„è¾…åŠ©å‡½æ•°
        
        /**
         * åˆ‡æ¢å…¨å±æ¨¡å¼
         */
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log('æ— æ³•è¿›å…¥å…¨å±æ¨¡å¼:', err);
                    alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒå…¨å±æ¨¡å¼');
                });
            } else {
                document.exitFullscreen();
            }
        }
        
        /**
         * æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
         */
        function showHelp() {
            const helpModal = document.createElement('div');
            helpModal.className = 'kpi-report-modal';
            helpModal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ğŸ“˜ ä½¿ç”¨å¸®åŠ©</h3>
                        <button class="close-btn" onclick="this.parentElement.parentElement.parentElement.remove()">âœ•</button>
                    </div>
                    <div class="modal-body">
                        <div class="help-section">
                            <h4>ğŸ¯ ä¸»è¦åŠŸèƒ½</h4>
                            <ul>
                                <li><strong>å®æ—¶ç›‘æ§:</strong> æŸ¥çœ‹å½“å‰å¯¹è¯ã€æ¶ˆæ¯ã€å“åº”æ—¶é—´ç­‰å…³é”®æŒ‡æ ‡</li>
                                <li><strong>è¶‹åŠ¿åˆ†æ:</strong> è§‚å¯Ÿä¸šåŠ¡æ•°æ®çš„æ—¶é—´å˜åŒ–è¶‹åŠ¿</li>
                                <li><strong>æ•ˆç‡è¯„ä¼°:</strong> åˆ†æå®¢æœäººå‘˜å·¥ä½œæ•ˆç‡å’Œè¡¨ç°</li>
                                <li><strong>æ»¡æ„åº¦ç»Ÿè®¡:</strong> å®¢æˆ·æ»¡æ„åº¦åˆ†å¸ƒå’Œå˜åŒ–è¶‹åŠ¿</li>
                                <li><strong>å·¥ä½œè´Ÿè½½:</strong> äº†è§£ä¸åŒæ—¶æ®µçš„å·¥ä½œè´Ÿè½½åˆ†å¸ƒ</li>
                                <li><strong>KPIæŠ¥å‘Š:</strong> ç»¼åˆè¯„ä¼°å„é¡¹å…³é”®ç»©æ•ˆæŒ‡æ ‡</li>
                            </ul>
                        </div>
                        
                        <div class="help-section">
                            <h4>âŒ¨ï¸ å¿«æ·é”®</h4>
                            <ul>
                                <li><strong>Ctrl/Cmd + R:</strong> åˆ·æ–°æ•°æ®</li>
                                <li><strong>Ctrl/Cmd + E:</strong> å¯¼å‡ºæŠ¥å‘Š</li>
                                <li><strong>F11:</strong> å…¨å±æ¨¡å¼</li>
                            </ul>
                        </div>
                        
                        <div class="help-section">
                            <h4>ğŸ“Š å›¾è¡¨è¯´æ˜</h4>
                            <ul>
                                <li><strong>å¯¹è¯è¶‹åŠ¿:</strong> æ˜¾ç¤ºè¿‡å»æ—¶é—´æ®µå†…çš„å¯¹è¯æ•°é‡å˜åŒ–</li>
                                <li><strong>å·¥ä½œè´Ÿè½½:</strong> æŒ‰å°æ—¶æ˜¾ç¤ºæ¶ˆæ¯å¤„ç†é‡åˆ†å¸ƒ</li>
                                <li><strong>å®¢æœæ’è¡Œ:</strong> å®¢æœäººå‘˜æ•ˆç‡æ’åå’Œè¯¦ç»†æ•°æ®</li>
                                <li><strong>æ»¡æ„åº¦åˆ†å¸ƒ:</strong> ä¸åŒæ˜Ÿçº§è¯„ä»·çš„åˆ†å¸ƒæƒ…å†µ</li>
                            </ul>
                        </div>
                        
                        <div class="help-section">
                            <h4>ğŸ”„ æ•°æ®æ›´æ–°</h4>
                            <p>ä»ªè¡¨æ¿æ¯5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡æ•°æ®ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç‚¹å‡»åˆ·æ–°æŒ‰é’®è·å–æœ€æ–°æ•°æ®ã€‚</p>
                        </div>
                        
                        <div class="help-section">
                            <h4>ğŸ“¥ æ•°æ®å¯¼å‡º</h4>
                            <p>æ”¯æŒå¯¼å‡ºCSVæ ¼å¼çš„KPIæŠ¥å‘Šï¼ŒåŒ…å«è¯¦ç»†çš„ç»Ÿè®¡æ•°æ®å’Œåˆ†æç»“æœã€‚</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" onclick="window.open('https://github.com/your-repo/quicktalk', '_blank')">æŸ¥çœ‹æ–‡æ¡£</button>
                        <button class="btn btn-secondary" onclick="this.parentElement.parentElement.parentElement.remove()">å…³é—­</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(helpModal);
        }
        
        /**
         * é”®ç›˜å¿«æ·é”®å¤„ç†
         */
        document.addEventListener('keydown', (e) => {
            // F11 å…¨å±
            if (e.key === 'F11') {
                e.preventDefault();
                toggleFullscreen();
            }
            
            // Esc é€€å‡ºæ¨¡æ€æ¡†
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.kpi-report-modal');
                modals.forEach(modal => modal.remove());
            }
        });
        
        /**
         * å…¨å±çŠ¶æ€å˜åŒ–å¤„ç†
         */
        document.addEventListener('fullscreenchange', () => {
            const isFullscreen = !!document.fullscreenElement;
            const fullscreenBtn = document.querySelector('.quick-action-btn[onclick="toggleFullscreen()"] i');
            
            if (fullscreenBtn) {
                fullscreenBtn.className = isFullscreen ? 'fas fa-compress' : 'fas fa-expand';
            }
            
            // å…¨å±æ—¶éšè—å¯¼èˆªå’Œå¿«é€Ÿæ“ä½œæ 
            const nav = document.querySelector('.top-nav');
            const quickActions = document.querySelector('.quick-actions');
            const footer = document.querySelector('.footer');
            
            if (nav) nav.style.display = isFullscreen ? 'none' : 'block';
            if (quickActions) quickActions.style.display = isFullscreen ? 'none' : 'flex';
            if (footer) footer.style.display = isFullscreen ? 'none' : 'block';
        });
        
        /**
         * é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
         */
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && dashboard) {
                // é¡µé¢é‡æ–°å¯è§æ—¶åˆ·æ–°æ•°æ®
                console.log('ğŸ“± é¡µé¢é‡æ–°å¯è§ï¼Œåˆ·æ–°æ•°æ®');
                dashboard.refreshData();
            }
        });
        
        /**
         * çª—å£å¤§å°å˜åŒ–å¤„ç†
         */
        window.addEventListener('resize', () => {
            if (dashboard && dashboard.charts) {
                // å»¶è¿Ÿé‡ç»˜å›¾è¡¨ä»¥ç¡®ä¿å®¹å™¨å°ºå¯¸æ­£ç¡®
                setTimeout(() => {
                    Object.values(dashboard.charts).forEach(chart => {
                        if (chart && chart.resize) {
                            chart.resize();
                        }
                    });
                }, 100);
            }
        });
        
        /**
         * é”™è¯¯å¤„ç†
         */
        window.addEventListener('error', (e) => {
            console.error('é¡µé¢é”™è¯¯:', e);
            
            // æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #f8d7da;
                color: #721c24;
                padding: 12px 16px;
                border-radius: 8px;
                border: 1px solid #f5c6cb;
                z-index: 10001;
                max-width: 300px;
                font-size: 14px;
            `;
            errorDiv.innerHTML = `
                <strong>âš ï¸ å‘ç”Ÿé”™è¯¯</strong><br>
                è¯·åˆ·æ–°é¡µé¢é‡è¯•ï¼Œå¦‚é—®é¢˜æŒç»­è¯·è”ç³»æŠ€æœ¯æ”¯æŒã€‚
                <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; color: #721c24; cursor: pointer; margin-left: 10px;">âœ•</button>
            `;
            
            document.body.appendChild(errorDiv);
            
            // 5ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                if (errorDiv.parentElement) {
                    errorDiv.remove();
                }
            }, 5000);
        });
        
        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        window.addEventListener('load', () => {
            console.log('ğŸ“Š æ•°æ®åˆ†æä»ªè¡¨æ¿é¡µé¢åŠ è½½å®Œæˆ');
            
            // æ£€æŸ¥å¿…è¦çš„ä¾èµ–
            if (typeof Chart === 'undefined') {
                console.error('âŒ Chart.js æœªåŠ è½½');
                alert('å›¾è¡¨åº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        });
        
        // ä¸ºç§»åŠ¨è®¾å¤‡æ·»åŠ è§¦æ‘¸å‹å¥½æ€§
        if ('ontouchstart' in window) {
            document.body.classList.add('touch-device');
            
            // æ·»åŠ è§¦æ‘¸è®¾å¤‡ç‰¹å®šçš„æ ·å¼
            const touchStyles = document.createElement('style');
            touchStyles.textContent = `
                .touch-device .quick-action-btn {
                    min-height: 44px;
                    min-width: 44px;
                }
                .touch-device .metric-card {
                    padding: 20px;
                }
                .touch-device .chart-btn {
                    min-height: 40px;
                    padding: 8px 16px;
                }
            `;
            document.head.appendChild(touchStyles);
        }
    </script>

    <!-- æ ·å¼åŠ¨ç”»å¢å¼º -->
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* åŠ è½½åŠ¨ç”»å¢å¼º */
        .loading-bounce {
            animation: bounce 1.5s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        /* å¹³æ»‘è¿‡æ¸¡ */
        * {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        /* é«˜å¯¹æ¯”åº¦æ¨¡å¼æ”¯æŒ */
        @media (prefers-contrast: high) {
            .metric-card,
            .chart-card,
            .kpi-section {
                border: 2px solid #000;
            }
            
            .metric-value,
            .kpi-score {
                font-weight: 900;
            }
        }
        
        /* å‡å°‘åŠ¨ç”»æ¨¡å¼æ”¯æŒ */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</body>
</html>
