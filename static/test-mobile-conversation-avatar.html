<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>移动端对话头像测试</title>
    
    <!-- 引入模块 -->
    <link rel="stylesheet" href="/static/css/conversation-avatar.css">
    <script src="/static/js/conversation-utils.js"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            padding: 20px;
            margin: 0;
        }
        
        .test-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
        }
        
        .test-section h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .conversations-list {
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }
        
        .test-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #5a6fd8;
        }
        
        .btn.btn-danger {
            background: #dc3545;
        }
        
        .btn.btn-danger:hover {
            background: #c82333;
        }
        
        .status-info {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.4;
            color: #666;
            border-left: 4px solid #667eea;
        }
        
        .mobile-test-input {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .mobile-test-input input {
            flex: 1;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .avatar-preview {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        /* 移动端特定的对话项样式 */
        .mobile-conversation-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.3s;
            position: relative;
        }
        
        .mobile-conversation-item:hover {
            background: #f8f9fa;
        }
        
        .mobile-conversation-item.has-unread {
            background: linear-gradient(90deg, #fff3f3 0%, #ffffff 100%);
        }
        
        .mobile-conversation-content {
            flex: 1;
            min-width: 0;
        }
        
        .mobile-conversation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3px;
        }
        
        .mobile-customer-name {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .mobile-message-time {
            font-size: 11px;
            color: #adb5bd;
        }
        
        .mobile-last-message {
            font-size: 12px;
            color: #6c757d;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>📱 移动端对话头像测试</h1>
        
        <div class="test-section">
            <h2>🔍 快速测试</h2>
            <div class="test-buttons">
                <button class="btn" onclick="generateMobileTestData()">📋 生成测试数据</button>
                <button class="btn" onclick="randomizeUnread()">📧 随机未读数</button>
                <button class="btn btn-danger" onclick="clearAllUnread()">✅ 清除未读</button>
            </div>
            
            <div class="conversations-list" id="mobileConversationsList">
                <!-- 移动端对话列表 -->
            </div>
        </div>
        
        <div class="test-section">
            <h2>🛠️ 自定义测试</h2>
            <div class="mobile-test-input">
                <input type="text" id="testCustomerId" placeholder="客户ID" value="user_12345">
                <input type="text" id="testCustomerName" placeholder="客户名" value="">
            </div>
            <div class="mobile-test-input">
                <input type="number" id="testUnreadCount" placeholder="未读数" min="0" max="999" value="5">
                <button class="btn" onclick="generateSingleMobileAvatar()">生成</button>
            </div>
            
            <div id="singleAvatarPreview" class="avatar-preview">
                <!-- 单个头像预览 -->
            </div>
        </div>
        
        <div class="test-section">
            <div class="status-info">
                <strong>✨ 移动端功能特色:</strong><br>
                • 彩色头像 + 右上角未读红点<br>
                • 6种主题颜色，一致分配<br>
                • 脉冲动画效果<br>
                • 响应式设计，触控友好<br>
                • 与桌面端数据同步
            </div>
        </div>
    </div>

    <script>
        // 移动端测试数据
        const mobileTestConversations = [
            { id: 'conv_m01', customer_id: 'user_12345', customer_name: '张先生', last_message: '你好，我想咨询产品价格', unread_count: 3, last_message_time: new Date() },
            { id: 'conv_m02', customer_id: 'customer_abc', customer_name: '李女士', last_message: '订单什么时候发货？', unread_count: 1, last_message_time: new Date(Date.now() - 300000) },
            { id: 'conv_m03', customer_id: 'user_xyz789', customer_name: null, last_message: '质量很好，满意', unread_count: 0, last_message_time: new Date(Date.now() - 600000) },
            { id: 'conv_m04', customer_id: 'guest_999', customer_name: '王总', last_message: '需要批量订购', unread_count: 12, last_message_time: new Date(Date.now() - 900000) },
            { id: 'conv_m05', customer_id: 'vip_888', customer_name: null, last_message: '感谢优质服务', unread_count: 0, last_message_time: new Date(Date.now() - 1200000) },
            { id: 'conv_m06', customer_id: 'customer_premium', customer_name: '陈经理', last_message: '希望能尽快处理退款', unread_count: 8, last_message_time: new Date(Date.now() - 1800000) }
        ];

        // 生成移动端测试对话列表
        function generateMobileTestData() {
            const container = document.getElementById('mobileConversationsList');
            
            const html = mobileTestConversations.map(conv => {
                const formattedTime = new Date(conv.last_message_time).toLocaleString('zh-CN', {
                    month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit'
                });
                
                return `
                    <div class="mobile-conversation-item ${ConversationUtils.getUnreadClass(conv.unread_count)}" 
                         data-conversation-id="${conv.id}">
                        ${ConversationUtils.generateAvatarHTML({
                            customerId: conv.customer_id,
                            customerName: conv.customer_name,
                            unreadCount: conv.unread_count || 0
                        })}
                        <div class="mobile-conversation-content">
                            <div class="mobile-conversation-header">
                                <span class="mobile-customer-name">${ConversationUtils.formatCustomerName(conv.customer_id, conv.customer_name)}</span>
                                <span class="mobile-message-time">${formattedTime}</span>
                            </div>
                            <div class="mobile-last-message">${conv.last_message}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
            console.log('✅ 移动端测试数据已生成');
        }

        // 随机化未读消息数量
        function randomizeUnread() {
            const updatedConversations = mobileTestConversations.map(conv => ({
                ...conv,
                unread_count: Math.floor(Math.random() * 15) // 0-14 随机未读数
            }));
            
            ConversationUtils.updateConversationUnreadBadges(updatedConversations, '#mobileConversationsList');
            console.log('✅ 移动端未读消息已随机更新');
        }

        // 清除所有未读
        function clearAllUnread() {
            const clearedConversations = mobileTestConversations.map(conv => ({
                ...conv,
                unread_count: 0
            }));
            
            ConversationUtils.updateConversationUnreadBadges(clearedConversations, '#mobileConversationsList');
            console.log('✅ 移动端所有未读消息已清除');
        }

        // 生成单个移动端头像测试
        function generateSingleMobileAvatar() {
            const customerId = document.getElementById('testCustomerId').value || 'user_test123';
            const customerName = document.getElementById('testCustomerName').value || null;
            const unreadCount = parseInt(document.getElementById('testUnreadCount').value) || 0;
            
            const avatarHTML = ConversationUtils.generateAvatarHTML({
                customerId,
                customerName,
                unreadCount
            });
            
            const formattedName = ConversationUtils.formatCustomerName(customerId, customerName);
            const theme = ConversationUtils.generateAvatarTheme(customerId);
            
            document.getElementById('singleAvatarPreview').innerHTML = `
                ${avatarHTML}
                <div style="font-size: 12px;">
                    <strong>客户:</strong> ${formattedName}<br>
                    <strong>ID:</strong> ${customerId}<br>
                    <strong>主题:</strong> ${theme}<br>
                    <strong>未读:</strong> ${unreadCount}
                </div>
            `;
            
            console.log('✅ 移动端单个头像测试完成', { customerId, customerName, unreadCount, formattedName, theme });
        }

        // 页面加载时自动生成测试数据
        window.addEventListener('DOMContentLoaded', () => {
            generateMobileTestData();
            generateSingleMobileAvatar();
            console.log('📱 移动端对话头像测试页面已加载');
        });

        // 添加移动端特有的触控反馈
        document.addEventListener('touchstart', function(e) {
            if (e.target.closest('.mobile-conversation-item')) {
                e.target.closest('.mobile-conversation-item').style.background = '#e9ecef';
            }
        });

        document.addEventListener('touchend', function(e) {
            if (e.target.closest('.mobile-conversation-item')) {
                setTimeout(() => {
                    const item = e.target.closest('.mobile-conversation-item');
                    if (item && !item.classList.contains('has-unread')) {
                        item.style.background = '';
                    } else if (item) {
                        item.style.background = 'linear-gradient(90deg, #fff3f3 0%, #ffffff 100%)';
                    }
                }, 150);
            }
        });
    </script>
</body>
</html>