<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ç§»åŠ¨ç«¯å¯¹è¯å¤´åƒæµ‹è¯•</title>
    
    <!-- å¼•å…¥æ¨¡å— -->
    <link rel="stylesheet" href="/static/css/conversation-avatar.css">
    <script src="/static/js/conversation-utils.js"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            padding: 20px;
            margin: 0;
        }
        
        .test-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
        }
        
        .test-section h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .conversations-list {
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }
        
        .test-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #5a6fd8;
        }
        
        .btn.btn-danger {
            background: #dc3545;
        }
        
        .btn.btn-danger:hover {
            background: #c82333;
        }
        
        .status-info {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.4;
            color: #666;
            border-left: 4px solid #667eea;
        }
        
        .mobile-test-input {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .mobile-test-input input {
            flex: 1;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .avatar-preview {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        /* ç§»åŠ¨ç«¯ç‰¹å®šçš„å¯¹è¯é¡¹æ ·å¼ */
        .mobile-conversation-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.3s;
            position: relative;
        }
        
        .mobile-conversation-item:hover {
            background: #f8f9fa;
        }
        
        .mobile-conversation-item.has-unread {
            background: linear-gradient(90deg, #fff3f3 0%, #ffffff 100%);
        }
        
        .mobile-conversation-content {
            flex: 1;
            min-width: 0;
        }
        
        .mobile-conversation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3px;
        }
        
        .mobile-customer-name {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .mobile-message-time {
            font-size: 11px;
            color: #adb5bd;
        }
        
        .mobile-last-message {
            font-size: 12px;
            color: #6c757d;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ“± ç§»åŠ¨ç«¯å¯¹è¯å¤´åƒæµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ğŸ” å¿«é€Ÿæµ‹è¯•</h2>
            <div class="test-buttons">
                <button class="btn" onclick="generateMobileTestData()">ğŸ“‹ ç”Ÿæˆæµ‹è¯•æ•°æ®</button>
                <button class="btn" onclick="randomizeUnread()">ğŸ“§ éšæœºæœªè¯»æ•°</button>
                <button class="btn btn-danger" onclick="clearAllUnread()">âœ… æ¸…é™¤æœªè¯»</button>
            </div>
            
            <div class="conversations-list" id="mobileConversationsList">
                <!-- ç§»åŠ¨ç«¯å¯¹è¯åˆ—è¡¨ -->
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ› ï¸ è‡ªå®šä¹‰æµ‹è¯•</h2>
            <div class="mobile-test-input">
                <input type="text" id="testCustomerId" placeholder="å®¢æˆ·ID" value="user_12345">
                <input type="text" id="testCustomerName" placeholder="å®¢æˆ·å" value="">
            </div>
            <div class="mobile-test-input">
                <input type="number" id="testUnreadCount" placeholder="æœªè¯»æ•°" min="0" max="999" value="5">
                <button class="btn" onclick="generateSingleMobileAvatar()">ç”Ÿæˆ</button>
            </div>
            
            <div id="singleAvatarPreview" class="avatar-preview">
                <!-- å•ä¸ªå¤´åƒé¢„è§ˆ -->
            </div>
        </div>
        
        <div class="test-section">
            <div class="status-info">
                <strong>âœ¨ ç§»åŠ¨ç«¯åŠŸèƒ½ç‰¹è‰²:</strong><br>
                â€¢ å½©è‰²å¤´åƒ + å³ä¸Šè§’æœªè¯»çº¢ç‚¹<br>
                â€¢ 6ç§ä¸»é¢˜é¢œè‰²ï¼Œä¸€è‡´åˆ†é…<br>
                â€¢ è„‰å†²åŠ¨ç”»æ•ˆæœ<br>
                â€¢ å“åº”å¼è®¾è®¡ï¼Œè§¦æ§å‹å¥½<br>
                â€¢ ä¸æ¡Œé¢ç«¯æ•°æ®åŒæ­¥
            </div>
        </div>
    </div>

    <script>
        // ç§»åŠ¨ç«¯æµ‹è¯•æ•°æ®
        const mobileTestConversations = [
            { id: 'conv_m01', customer_id: 'user_12345', customer_name: 'å¼ å…ˆç”Ÿ', last_message: 'ä½ å¥½ï¼Œæˆ‘æƒ³å’¨è¯¢äº§å“ä»·æ ¼', unread_count: 3, last_message_time: new Date() },
            { id: 'conv_m02', customer_id: 'customer_abc', customer_name: 'æå¥³å£«', last_message: 'è®¢å•ä»€ä¹ˆæ—¶å€™å‘è´§ï¼Ÿ', unread_count: 1, last_message_time: new Date(Date.now() - 300000) },
            { id: 'conv_m03', customer_id: 'user_xyz789', customer_name: null, last_message: 'è´¨é‡å¾ˆå¥½ï¼Œæ»¡æ„', unread_count: 0, last_message_time: new Date(Date.now() - 600000) },
            { id: 'conv_m04', customer_id: 'guest_999', customer_name: 'ç‹æ€»', last_message: 'éœ€è¦æ‰¹é‡è®¢è´­', unread_count: 12, last_message_time: new Date(Date.now() - 900000) },
            { id: 'conv_m05', customer_id: 'vip_888', customer_name: null, last_message: 'æ„Ÿè°¢ä¼˜è´¨æœåŠ¡', unread_count: 0, last_message_time: new Date(Date.now() - 1200000) },
            { id: 'conv_m06', customer_id: 'customer_premium', customer_name: 'é™ˆç»ç†', last_message: 'å¸Œæœ›èƒ½å°½å¿«å¤„ç†é€€æ¬¾', unread_count: 8, last_message_time: new Date(Date.now() - 1800000) }
        ];

        // ç”Ÿæˆç§»åŠ¨ç«¯æµ‹è¯•å¯¹è¯åˆ—è¡¨
        function generateMobileTestData() {
            const container = document.getElementById('mobileConversationsList');
            
            const html = mobileTestConversations.map(conv => {
                const formattedTime = new Date(conv.last_message_time).toLocaleString('zh-CN', {
                    month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit'
                });
                
                return `
                    <div class="mobile-conversation-item ${ConversationUtils.getUnreadClass(conv.unread_count)}" 
                         data-conversation-id="${conv.id}">
                        ${ConversationUtils.generateAvatarHTML({
                            customerId: conv.customer_id,
                            customerName: conv.customer_name,
                            unreadCount: conv.unread_count || 0
                        })}
                        <div class="mobile-conversation-content">
                            <div class="mobile-conversation-header">
                                <span class="mobile-customer-name">${ConversationUtils.formatCustomerName(conv.customer_id, conv.customer_name)}</span>
                                <span class="mobile-message-time">${formattedTime}</span>
                            </div>
                            <div class="mobile-last-message">${conv.last_message}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
            console.log('âœ… ç§»åŠ¨ç«¯æµ‹è¯•æ•°æ®å·²ç”Ÿæˆ');
        }

        // éšæœºåŒ–æœªè¯»æ¶ˆæ¯æ•°é‡
        function randomizeUnread() {
            const updatedConversations = mobileTestConversations.map(conv => ({
                ...conv,
                unread_count: Math.floor(Math.random() * 15) // 0-14 éšæœºæœªè¯»æ•°
            }));
            
            ConversationUtils.updateConversationUnreadBadges(updatedConversations, '#mobileConversationsList');
            console.log('âœ… ç§»åŠ¨ç«¯æœªè¯»æ¶ˆæ¯å·²éšæœºæ›´æ–°');
        }

        // æ¸…é™¤æ‰€æœ‰æœªè¯»
        function clearAllUnread() {
            const clearedConversations = mobileTestConversations.map(conv => ({
                ...conv,
                unread_count: 0
            }));
            
            ConversationUtils.updateConversationUnreadBadges(clearedConversations, '#mobileConversationsList');
            console.log('âœ… ç§»åŠ¨ç«¯æ‰€æœ‰æœªè¯»æ¶ˆæ¯å·²æ¸…é™¤');
        }

        // ç”Ÿæˆå•ä¸ªç§»åŠ¨ç«¯å¤´åƒæµ‹è¯•
        function generateSingleMobileAvatar() {
            const customerId = document.getElementById('testCustomerId').value || 'user_test123';
            const customerName = document.getElementById('testCustomerName').value || null;
            const unreadCount = parseInt(document.getElementById('testUnreadCount').value) || 0;
            
            const avatarHTML = ConversationUtils.generateAvatarHTML({
                customerId,
                customerName,
                unreadCount
            });
            
            const formattedName = ConversationUtils.formatCustomerName(customerId, customerName);
            const theme = ConversationUtils.generateAvatarTheme(customerId);
            
            document.getElementById('singleAvatarPreview').innerHTML = `
                ${avatarHTML}
                <div style="font-size: 12px;">
                    <strong>å®¢æˆ·:</strong> ${formattedName}<br>
                    <strong>ID:</strong> ${customerId}<br>
                    <strong>ä¸»é¢˜:</strong> ${theme}<br>
                    <strong>æœªè¯»:</strong> ${unreadCount}
                </div>
            `;
            
            console.log('âœ… ç§»åŠ¨ç«¯å•ä¸ªå¤´åƒæµ‹è¯•å®Œæˆ', { customerId, customerName, unreadCount, formattedName, theme });
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æ•°æ®
        window.addEventListener('DOMContentLoaded', () => {
            generateMobileTestData();
            generateSingleMobileAvatar();
            console.log('ğŸ“± ç§»åŠ¨ç«¯å¯¹è¯å¤´åƒæµ‹è¯•é¡µé¢å·²åŠ è½½');
        });

        // æ·»åŠ ç§»åŠ¨ç«¯ç‰¹æœ‰çš„è§¦æ§åé¦ˆ
        document.addEventListener('touchstart', function(e) {
            if (e.target.closest('.mobile-conversation-item')) {
                e.target.closest('.mobile-conversation-item').style.background = '#e9ecef';
            }
        });

        document.addEventListener('touchend', function(e) {
            if (e.target.closest('.mobile-conversation-item')) {
                setTimeout(() => {
                    const item = e.target.closest('.mobile-conversation-item');
                    if (item && !item.classList.contains('has-unread')) {
                        item.style.background = '';
                    } else if (item) {
                        item.style.background = 'linear-gradient(90deg, #fff3f3 0%, #ffffff 100%)';
                    }
                }, 150);
            }
        });
    </script>
</body>
</html>