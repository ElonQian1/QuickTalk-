<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickTalk - 纯Rust客服系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 90%;
            text-align: center;
        }
        
        .logo {
            font-size: 2.5rem;
            color: #667eea;
            margin-bottom: 1rem;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .feature {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .feature h3 {
            color: #333;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .feature p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }
        
        .status {
            margin-top: 2rem;
            padding: 1rem;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 6px;
            color: #155724;
        }
        
        .status.connecting {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }
        
        .status.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .specs {
            margin-top: 2rem;
            text-align: left;
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 6px;
        }
        
        .specs h4 {
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .specs ul {
            list-style: none;
            padding-left: 1rem;
        }
        
        .specs li {
            color: #666;
            margin: 0.3rem 0;
            position: relative;
        }
        
        .specs li:before {
            content: "✓";
            color: #28a745;
            font-weight: bold;
            position: absolute;
            left: -1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">🦀 QuickTalk</div>
        <div class="subtitle">纯Rust驱动的客服系统 - 无Node.js依赖</div>
        
        <div class="features">
            <div class="feature">
                <h3>🚀 纯Rust</h3>
                <p>完全使用Rust语言开发，高性能且内存安全</p>
            </div>
            <div class="feature">
                <h3>🔌 WebSocket</h3>
                <p>原生WebSocket支持，实时双向通信</p>
            </div>
            <div class="feature">
                <h3>💾 SQLite</h3>
                <p>内置SQLite数据库，轻量级数据存储</p>
            </div>
            <div class="feature">
                <h3>📁 文件管理</h3>
                <p>支持文件上传下载，多媒体消息</p>
            </div>
        </div>
        
        <div class="buttons">
            <a href="/admin" class="btn btn-primary">管理后台</a>
            <a href="/api/health" class="btn btn-secondary">系统状态</a>
            <button onclick="testWebSocket()" class="btn btn-secondary">测试WebSocket</button>
        </div>
        
        <div id="status" class="status" style="display: none;"></div>
        
        <div class="specs">
            <h4>技术规格:</h4>
            <ul>
                <li>服务器: Axum + Tokio (异步Rust)</li>
                <li>数据库: SQLite + SQLX</li>
                <li>WebSocket: 原生Axum WebSocket支持</li>
                <li>文件上传: Multipart表单处理</li>
                <li>跨域支持: Tower-HTTP CORS</li>
                <li>日志记录: Tracing框架</li>
                <li>部署: 单一可执行文件</li>
            </ul>
        </div>
    </div>

    <script>
        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 3000);
            }
        }
        
        function testWebSocket() {
            showStatus('正在连接WebSocket...', 'connecting');
            
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws`;
            
            try {
                const ws = new WebSocket(wsUrl);
                
                ws.onopen = function() {
                    showStatus('WebSocket连接成功！', 'success');
                    
                    // 发送测试消息
                    ws.send(JSON.stringify({
                        msg_type: 'message',
                        conversation_id: 'test-conversation',
                        sender_id: 'test-user',
                        content: 'Hello from Pure Rust QuickTalk!',
                        timestamp: new Date().toISOString()
                    }));
                };
                
                ws.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    showStatus(`收到消息: ${data.type || data.message || '未知消息'}`, 'success');
                };
                
                ws.onerror = function() {
                    showStatus('WebSocket连接错误', 'error');
                };
                
                ws.onclose = function() {
                    showStatus('WebSocket连接已关闭', 'connecting');
                };
                
                // 5秒后关闭连接
                setTimeout(() => {
                    if (ws.readyState === WebSocket.OPEN) {
                        ws.close();
                    }
                }, 5000);
                
            } catch (error) {
                showStatus(`WebSocket测试失败: ${error.message}`, 'error');
            }
        }
        
        // 页面加载时检查健康状态
        window.onload = function() {
            fetch('/api/health')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showStatus(`服务器运行正常 - ${data.data.server} v${data.data.version}`, 'success');
                    }
                })
                .catch(() => {
                    showStatus('无法连接到服务器', 'error');
                });
        };
    </script>
</body>
</html>