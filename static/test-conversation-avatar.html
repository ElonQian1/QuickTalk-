<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¹è¯å¤´åƒå’Œçº¢ç‚¹åŠŸèƒ½æµ‹è¯•</title>
    
    <!-- å¼•å…¥æ–°åˆ›å»ºçš„CSSå’ŒJSæ¨¡å— -->
    <link rel="stylesheet" href="/static/css/conversation-avatar.css">
    <script src="/static/js/conversation-utils.js"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            margin: 0;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .test-section {
            margin-bottom: 40px;
        }
        
        .test-section h2 {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
            margin-bottom: 20px;
        }
        
        .conversations-list {
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #5a6fd8;
        }
        
        .btn.btn-danger {
            background: #dc3545;
        }
        
        .btn.btn-danger:hover {
            background: #c82333;
        }
        
        .status-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª å¯¹è¯å¤´åƒå’Œçº¢ç‚¹åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ğŸ“‹ æµ‹è¯•ç”¨ä¾‹</h2>
            <div class="test-buttons">
                <button class="btn" onclick="generateTestConversations()">ğŸ”„ ç”Ÿæˆæµ‹è¯•æ•°æ®</button>
                <button class="btn" onclick="updateUnreadCounts()">ğŸ“§ æ›´æ–°æœªè¯»æ•°</button>
                <button class="btn btn-danger" onclick="clearAllUnread()">âœ… æ¸…é™¤æ‰€æœ‰æœªè¯»</button>
            </div>
            
            <div class="conversations-list" id="testConversationsList">
                <!-- è¿™é‡Œå°†åŠ¨æ€ç”Ÿæˆå¯¹è¯åˆ—è¡¨ -->
            </div>
            
            <div class="status-info">
                <strong>åŠŸèƒ½è¯´æ˜:</strong>
                <ul>
                    <li>âœ¨ <strong>å¤´åƒç”Ÿæˆ</strong>: æ ¹æ®å®¢æˆ·IDè‡ªåŠ¨ç”Ÿæˆå½©è‰²åœ†å½¢å¤´åƒï¼Œæ˜¾ç¤ºå®¢æˆ·åç§°é¦–å­—æ¯æˆ–IDæœ«ä½æ•°å­—</li>
                    <li>ğŸ”´ <strong>æœªè¯»çº¢ç‚¹</strong>: åœ¨å¤´åƒå³ä¸Šè§’æ˜¾ç¤ºæœªè¯»æ¶ˆæ¯æ•°é‡ï¼Œæ”¯æŒè„‰å†²åŠ¨ç”»æ•ˆæœ</li>
                    <li>ğŸ¨ <strong>é¢œè‰²ä¸»é¢˜</strong>: åŸºäºå®¢æˆ·IDå“ˆå¸Œå€¼è‡ªåŠ¨åˆ†é…6ç§ä¸åŒé¢œè‰²ä¸»é¢˜</li>
                    <li>ğŸ“± <strong>å“åº”å¼è®¾è®¡</strong>: é€‚é…æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯æ˜¾ç¤º</li>
                    <li>ğŸ”§ <strong>æ¨¡å—åŒ–æ¶æ„</strong>: CSSå’ŒJSåˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•</li>
                </ul>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ› ï¸ å•ç‹¬æµ‹è¯•å·¥å…·</h2>
            <div style="display: flex; gap: 20px; align-items: center; margin-bottom: 15px;">
                <input type="text" id="testCustomerId" placeholder="è¾“å…¥å®¢æˆ·ID" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 150px;">
                <input type="text" id="testCustomerName" placeholder="å®¢æˆ·åç§° (å¯é€‰)" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 150px;">
                <input type="number" id="testUnreadCount" placeholder="æœªè¯»æ•°" min="0" max="999" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 80px;">
                <button class="btn" onclick="generateSingleAvatar()">ç”Ÿæˆå¤´åƒ</button>
            </div>
            
            <div id="singleAvatarTest" style="display: flex; align-items: center; gap: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                <!-- å•ç‹¬å¤´åƒæµ‹è¯•ç»“æœ -->
            </div>
        </div>
    </div>

    <script>
        // æµ‹è¯•æ•°æ®
        const testConversations = [
            { id: 'conv_001', customer_id: 'user_12345', customer_name: 'å¼ ä¸‰', last_message: 'ä½ å¥½ï¼Œè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©çš„å—ï¼Ÿ', unread_count: 3 },
            { id: 'conv_002', customer_id: 'customer_67890', customer_name: 'æå››', last_message: 'æˆ‘æƒ³å’¨è¯¢ä¸€ä¸‹äº§å“ä»·æ ¼', unread_count: 1 },
            { id: 'conv_003', customer_id: 'user_abcde', customer_name: null, last_message: 'è°¢è°¢æ‚¨çš„å¸®åŠ©ï¼', unread_count: 0 },
            { id: 'conv_004', customer_id: 'guest_98765', customer_name: 'ç‹äº”', last_message: 'è®¢å•ä»€ä¹ˆæ—¶å€™èƒ½å‘è´§ï¼Ÿ', unread_count: 7 },
            { id: 'conv_005', customer_id: 'user_xyz123', customer_name: null, last_message: 'è´¨é‡å¾ˆå¥½ï¼Œæ»¡æ„', unread_count: 0 },
            { id: 'conv_006', customer_id: 'vip_888', customer_name: 'èµµå…­', last_message: 'éœ€è¦é€€è´§å¤„ç†', unread_count: 15 },
            { id: 'conv_007', customer_id: 'customer_999', customer_name: null, last_message: 'ç‰©æµä¿¡æ¯æ›´æ–°äº†å—ï¼Ÿ', unread_count: 2 },
            { id: 'conv_008', customer_id: 'user_premium', customer_name: 'é’±ä¸ƒ', last_message: 'éå¸¸å¥½çš„æœåŠ¡ä½“éªŒ', unread_count: 0 }
        ];

        // ç”Ÿæˆæµ‹è¯•å¯¹è¯åˆ—è¡¨
        function generateTestConversations() {
            const container = document.getElementById('testConversationsList');
            
            const html = testConversations.map(conv => `
                <div class="conversation-item ${ConversationUtils.getUnreadClass(conv.unread_count)}" 
                     data-conversation-id="${conv.id}">
                    ${ConversationUtils.generateAvatarHTML({
                        customerId: conv.customer_id,
                        customerName: conv.customer_name,
                        unreadCount: conv.unread_count || 0
                    })}
                    <div class="conversation-info">
                        <div class="customer-name">${ConversationUtils.formatCustomerName(conv.customer_id, conv.customer_name)}</div>
                        <div class="last-message">${conv.last_message}</div>
                        <div class="conversation-time">${new Date().toLocaleString('zh-CN')}</div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
            console.log('âœ… æµ‹è¯•å¯¹è¯åˆ—è¡¨å·²ç”Ÿæˆ');
        }

        // æ›´æ–°æœªè¯»æ¶ˆæ¯æ•°é‡
        function updateUnreadCounts() {
            const updatedConversations = testConversations.map(conv => ({
                ...conv,
                unread_count: Math.floor(Math.random() * 20) // éšæœºç”Ÿæˆ0-19çš„æœªè¯»æ•°
            }));
            
            ConversationUtils.updateConversationUnreadBadges(updatedConversations, '#testConversationsList');
            console.log('âœ… æœªè¯»æ¶ˆæ¯æ•°é‡å·²æ›´æ–°');
        }

        // æ¸…é™¤æ‰€æœ‰æœªè¯»
        function clearAllUnread() {
            const clearedConversations = testConversations.map(conv => ({
                ...conv,
                unread_count: 0
            }));
            
            ConversationUtils.updateConversationUnreadBadges(clearedConversations, '#testConversationsList');
            console.log('âœ… æ‰€æœ‰æœªè¯»æ¶ˆæ¯å·²æ¸…é™¤');
        }

        // ç”Ÿæˆå•ä¸ªå¤´åƒæµ‹è¯•
        function generateSingleAvatar() {
            const customerId = document.getElementById('testCustomerId').value || 'user_test123';
            const customerName = document.getElementById('testCustomerName').value || null;
            const unreadCount = parseInt(document.getElementById('testUnreadCount').value) || 0;
            
            const avatarHTML = ConversationUtils.generateAvatarHTML({
                customerId,
                customerName,
                unreadCount
            });
            
            const formattedName = ConversationUtils.formatCustomerName(customerId, customerName);
            const theme = ConversationUtils.generateAvatarTheme(customerId);
            
            document.getElementById('singleAvatarTest').innerHTML = `
                ${avatarHTML}
                <div>
                    <strong>æµ‹è¯•ç»“æœ:</strong><br>
                    å®¢æˆ·ID: ${customerId}<br>
                    æ˜¾ç¤ºåç§°: ${formattedName}<br>
                    é¢œè‰²ä¸»é¢˜: ${theme}<br>
                    æœªè¯»æ•°é‡: ${unreadCount}
                </div>
            `;
            
            console.log('âœ… å•ç‹¬å¤´åƒæµ‹è¯•å®Œæˆ', { customerId, customerName, unreadCount, formattedName, theme });
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æ•°æ®
        window.addEventListener('DOMContentLoaded', () => {
            generateTestConversations();
            console.log('ğŸ‰ å¯¹è¯å¤´åƒå’Œçº¢ç‚¹åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ’¡ æ‚¨å¯ä»¥é€šè¿‡æŒ‰é’®æµ‹è¯•ä¸åŒåŠŸèƒ½ï¼Œæˆ–åœ¨å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹ConversationUtilså¯¹è±¡');
        });
    </script>
</body>
</html>