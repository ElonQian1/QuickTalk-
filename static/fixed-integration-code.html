<!-- QuickTalk客服系统 - 轻量集成代码（动态加载版） -->
<!-- 优点：集成代码永不过时，所有逻辑从服务器动态加载 -->
<script>
(function() {
    // QuickTalk配置 - 这是唯一需要定制的部分
    const QUICKTALK_CONFIG = {
        shopKey: 'sk_ji85ucic9p00m12as1ygf34o8humuxfl',
        shopId: 'shop_1757591780450_1',
        shopName: '时尚服装店',
        authorizedDomain: 'bbs16.929991.xyz',
        
        // 服务器配置
        serverUrl: 'http://localhost:3030',
        
        // 版本控制
        version: '1.0.0',
        cacheBreaker: Date.now() // 强制刷新缓存
    };
    
    // 域名验证
    const currentDomain = window.location.hostname;
    if (currentDomain !== QUICKTALK_CONFIG.authorizedDomain && 
        !currentDomain.endsWith('.' + QUICKTALK_CONFIG.authorizedDomain) && 
        currentDomain !== 'localhost') {
        console.error('❌ QuickTalk客服系统：域名未授权');
        console.error('当前域名:', currentDomain);
        console.error('授权域名:', QUICKTALK_CONFIG.authorizedDomain);
        return;
    }
    
    console.log('🚀 QuickTalk客服系统：开始动态加载...');
    
    // 动态加载样式文件
    function loadCSS() {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = `${QUICKTALK_CONFIG.serverUrl}/embed/customer-service.css?v=${QUICKTALK_CONFIG.cacheBreaker}`;
        link.onerror = () => {
            console.error('❌ QuickTalk样式加载失败');
        };
        document.head.appendChild(link);
    }
    
    // 动态加载JavaScript文件
    function loadJS() {
        const script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = `${QUICKTALK_CONFIG.serverUrl}/embed/customer-service.js?v=${QUICKTALK_CONFIG.cacheBreaker}`;
        
        script.onload = () => {
            console.log('✅ QuickTalk脚本加载成功');
            
            // 初始化客服系统
            if (window.QuickTalkCustomerService) {
                window.QuickTalkCustomerService.init(QUICKTALK_CONFIG);
                console.log('✅ QuickTalk客服系统初始化完成');
            } else {
                console.error('❌ QuickTalk客服系统初始化失败：主模块未找到');
            }
        };
        
        script.onerror = () => {
            console.error('❌ QuickTalk脚本加载失败，使用降级方案');
            fallbackToInlineCode();
        };
        
        document.head.appendChild(script);
    }
    
    // 降级方案：使用内联代码
    function fallbackToInlineCode() {
        console.log('🔄 QuickTalk: 启用降级方案...');
        // 这里可以放一个简化版的客服系统
        // 或者显示"客服系统暂时不可用"的提示
        
        const fallbackHTML = `
            <div style="
                position: fixed;
                bottom: 40px;
                right: 40px;
                background: #667eea;
                color: white;
                padding: 15px 20px;
                border-radius: 25px;
                font-size: 14px;
                cursor: pointer;
                z-index: 999999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            " onclick="alert('客服系统正在维护中，请稍后再试')">
                📞 客服咨询
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', fallbackHTML);
    }
    
    // 开始加载
    try {
        loadCSS();
        loadJS();
    } catch (e) {
        console.error('❌ QuickTalk加载失败:', e);
        fallbackToInlineCode();
    }
    
    // 全局暴露配置（供动态加载的脚本使用）
    window.QUICKTALK_EMBED_CONFIG = QUICKTALK_CONFIG;
    
})();
</script>

<!-- 
🔥 QuickTalk客服系统 - 动态加载集成代码

【🚀 核心优势】
✅ 集成代码永不过时：所有业务逻辑从服务器动态加载
✅ 一次更新全网生效：无需手动更新每个网站的集成代码
✅ 版本控制：自动获取最新功能（图片消息、新特性等）
✅ 降级保护：服务器不可用时显示备用界面
✅ 缓存刷新：每次加载都获取最新版本

【🔧 工作原理】
1. 集成代码只包含配置信息和加载逻辑
2. 动态从服务器加载 CSS 和 JavaScript
3. 服务器提供完整的客服系统实现
4. 支持版本控制和缓存管理

【📁 需要在服务器创建的文件】
- /embed/customer-service.css - 客服系统样式
- /embed/customer-service.js  - 客服系统逻辑

【🔄 更新流程】
服务器更新代码 → 所有网站自动获取最新版本 → 无需手动维护

【📱 使用方法】
只需要在网站中嵌入这段代码，所有功能都会自动加载！
-->