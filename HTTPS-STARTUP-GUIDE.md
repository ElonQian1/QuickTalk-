# HTTPS å¯åŠ¨å®Œæ•´æŒ‡å—

## ğŸ”’ æ¦‚è¿°

æ­¤æŒ‡å—æä¾›äº†å¯åŠ¨å®¢æœç³»ç»Ÿ HTTPS åŠŸèƒ½çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬å·²ç»ä¿®å¤äº†ä¹‹å‰çš„ç«¯å£å†²çªé—®é¢˜ï¼ˆç¨‹åºé»˜è®¤æ¨¡å¼ä» "auto" æ”¹ä¸º "http"ï¼‰ï¼Œç°åœ¨å¯ä»¥å®‰å…¨åœ°å¯åŠ¨ HTTPS æ¨¡å¼ã€‚

## âœ… é—®é¢˜è§£å†³çŠ¶æ€

### å·²ä¿®å¤çš„é—®é¢˜
- âœ… **ç«¯å£å†²çªæ ¹æœ¬åŸå› **: ä¿®å¤äº† `server/mod.rs` ä¸­çš„é»˜è®¤ TLS_MODE ä» "auto" æ”¹ä¸º "http"
- âœ… **SSLè¯ä¹¦**: ç°æœ‰æœ‰æ•ˆçš„ SSL è¯ä¹¦æ–‡ä»¶ (`certs/server.crt`, `certs/server.key`)
- âœ… **ä¸“ç”¨å¯åŠ¨è„šæœ¬**: åˆ›å»ºäº†å¸¦ç«¯å£æ£€æŸ¥å’Œè¯ä¹¦éªŒè¯çš„ä¸“ç”¨ HTTPS å¯åŠ¨è„šæœ¬

### å½“å‰çŠ¶æ€
- ğŸŸ¢ **åç«¯ä»£ç **: å®Œå…¨æ”¯æŒ HTTPS æ¨¡å¼
- ğŸŸ¢ **SSLè¯ä¹¦**: æœ‰æ•ˆè¯ä¹¦å·²å­˜åœ¨
- ğŸŸ¢ **å¯åŠ¨è„šæœ¬**: å®Œæ•´çš„è‡ªåŠ¨åŒ–å¯åŠ¨è§£å†³æ–¹æ¡ˆ

## ğŸš€ å¯åŠ¨ HTTPS çš„æ–¹æ³•

### æ–¹æ³•1: ä½¿ç”¨ä¸“ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

#### Windows ç³»ç»Ÿ:
```powershell
cd e:\duihua\customer-service-system
.\start-https.bat
```

#### Linux ç³»ç»Ÿ:
```bash
cd /path/to/customer-service-system
chmod +x start-https.sh
./start-https.sh
```

**è„šæœ¬åŠŸèƒ½**:
- è‡ªåŠ¨æ£€æŸ¥ç«¯å£ 8443 å’Œ 8080 æ˜¯å¦è¢«å ç”¨
- éªŒè¯ SSL è¯ä¹¦æœ‰æ•ˆæ€§
- è®¾ç½®æ­£ç¡®çš„ç¯å¢ƒå˜é‡
- ç¼–è¯‘åç«¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
- å¯åŠ¨ HTTPS æœåŠ¡å™¨

### æ–¹æ³•2: æ‰‹åŠ¨å¯åŠ¨

#### 1. è®¾ç½®ç¯å¢ƒå˜é‡
```powershell
# Windows PowerShell
$env:TLS_MODE="https"
$env:HTTPS_PORT="8443"
$env:TLS_CERT_PATH="certs\server.crt"
$env:TLS_KEY_PATH="certs\server.key"
$env:ENABLE_HTTP_REDIRECT="true"
```

```bash
# Linux Bash
export TLS_MODE="https"
export HTTPS_PORT="8443"
export TLS_CERT_PATH="certs/server.crt"
export TLS_KEY_PATH="certs/server.key"
export ENABLE_HTTP_REDIRECT="true"
```

#### 2. ç¼–è¯‘åç«¯ï¼ˆåŒ…å« HTTPS åŠŸèƒ½ï¼‰
```bash
cd backend
cargo build --release --features https
```

#### 3. å¯åŠ¨æœåŠ¡å™¨
```bash
cd backend
./target/release/customer-service-backend
```

## ğŸ“‹ å¯åŠ¨è„šæœ¬é€‰é¡¹

### å¸¸ç”¨é€‰é¡¹
```bash
# åŸºæœ¬å¯åŠ¨
./start-https.sh

# ä½¿ç”¨è‡ªå®šä¹‰ç«¯å£
./start-https.sh --port 9443

# å¼ºåˆ¶é‡æ–°ç¼–è¯‘
./start-https.sh --force-build

# ä»…éªŒè¯è¯ä¹¦
./start-https.sh --verify-cert

# ä»…ç”Ÿæˆæ–°è¯ä¹¦
./start-https.sh --generate-cert

# æ˜¾ç¤ºå¸®åŠ©
./start-https.sh --help
```

## ğŸŒ è®¿é—®åœ°å€

å¯åŠ¨æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **HTTPS**: https://localhost:8443
- **HTTP é‡å®šå‘**: http://localhost:8080 (è‡ªåŠ¨è·³è½¬åˆ° HTTPS)

## ğŸ”§ æ•…éšœæ’é™¤

### 1. ç«¯å£è¢«å ç”¨
**ç—‡çŠ¶**: æ˜¾ç¤º "Address already in use (os error 98)" æˆ– "ç«¯å£ 8443 å·²è¢«å ç”¨"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# Linux: æŸ¥çœ‹å¹¶ç»“æŸå ç”¨è¿›ç¨‹
sudo netstat -tlnp | grep :8443
sudo kill -9 <PID>

# Windows: æŸ¥çœ‹å¹¶ç»“æŸå ç”¨è¿›ç¨‹
netstat -ano | findstr :8443
taskkill /PID <PID> /F
```

**è‡ªåŠ¨è§£å†³**: ä½¿ç”¨å¯åŠ¨è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶è¯¢é—®æ˜¯å¦ç»“æŸå ç”¨è¿›ç¨‹

### 2. SSL è¯ä¹¦é—®é¢˜
**ç—‡çŠ¶**: "SSL certificate validation failed" æˆ– "è¯ä¹¦éªŒè¯å¤±è´¥"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# éªŒè¯ç°æœ‰è¯ä¹¦
./start-https.sh --verify-cert

# ç”Ÿæˆæ–°è¯ä¹¦
./start-https.sh --generate-cert
```

### 3. ç¼–è¯‘é”™è¯¯
**ç—‡çŠ¶**: "compilation failed" æˆ– "ä¾èµ–ç¼ºå¤±"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…ç†å¹¶é‡æ–°ç¼–è¯‘
cd backend
cargo clean
cargo build --release --features https
```

### 4. æµè§ˆå™¨å®‰å…¨è­¦å‘Š
**ç—‡çŠ¶**: æµè§ˆå™¨æ˜¾ç¤º "æ­¤è¿æ¥ä¸å®‰å…¨" æˆ– "è¯ä¹¦æ— æ•ˆ"

**åŸå› **: ä½¿ç”¨è‡ªç­¾åè¯ä¹¦

**è§£å†³æ–¹æ¡ˆ**: 
- åœ¨æµè§ˆå™¨ä¸­ç‚¹å‡» "é«˜çº§" -> "ç»§ç»­è®¿é—®"
- æˆ–è€…ä½¿ç”¨çœŸå®çš„ SSL è¯ä¹¦

## ğŸ”’ è¯ä¹¦ç®¡ç†

### ç°æœ‰è¯ä¹¦ä¿¡æ¯
- **è¯ä¹¦æ–‡ä»¶**: `certs/server.crt`
- **å¯†é’¥æ–‡ä»¶**: `certs/server.key`
- **è¯ä¹¦ç±»å‹**: è‡ªç­¾åè¯ä¹¦
- **æœ‰æ•ˆæœŸ**: 365 å¤©ï¼ˆä»ç”Ÿæˆæ—¥æœŸå¼€å§‹ï¼‰

### ç”Ÿæˆæ–°è¯ä¹¦
å¦‚éœ€ç”Ÿæˆæ–°çš„è‡ªç­¾åè¯ä¹¦ï¼š
```bash
# ä½¿ç”¨å¯åŠ¨è„šæœ¬ç”Ÿæˆ
./start-https.sh --generate-cert

# æ‰‹åŠ¨ç”Ÿæˆ
openssl genrsa -out certs/server.key 2048
openssl req -new -x509 -key certs/server.key -out certs/server.crt -days 365 \
    -subj "/C=CN/ST=State/L=City/O=Organization/OU=OrgUnit/CN=localhost"
```

### ä½¿ç”¨çœŸå®è¯ä¹¦
å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨ Let's Encrypt æˆ–å…¶ä»– CA ç­¾å‘çš„è¯ä¹¦ï¼š
1. å°†è¯ä¹¦æ–‡ä»¶å¤åˆ¶åˆ° `certs/server.crt`
2. å°†ç§é’¥æ–‡ä»¶å¤åˆ¶åˆ° `certs/server.key`
3. ç¡®ä¿æ–‡ä»¶æƒé™æ­£ç¡®ï¼ˆç§é’¥ä»…æ‰€æœ‰è€…å¯è¯»ï¼‰

## ğŸŒŸ æœ€ä½³å®è·µ

### 1. å®‰å…¨é…ç½®
- å®šæœŸæ›´æ–° SSL è¯ä¹¦
- ä½¿ç”¨å¼ºå¯†ç å’Œå¯†é’¥é•¿åº¦
- å¯ç”¨ HTTP åˆ° HTTPS é‡å®šå‘
- é…ç½®é˜²ç«å¢™è§„åˆ™

### 2. æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨ `cargo build --release` ç¼–è¯‘ä¼˜åŒ–ç‰ˆæœ¬
- é…ç½®é€‚å½“çš„å¹¶å‘è¿æ¥æ•°
- ç›‘æ§å†…å­˜å’Œ CPU ä½¿ç”¨æƒ…å†µ

### 3. ç›‘æ§å’Œæ—¥å¿—
- æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—ä¸­çš„ SSL ç›¸å…³é”™è¯¯
- ç›‘æ§è¯ä¹¦è¿‡æœŸæ—¶é—´
- è®¾ç½®è‡ªåŠ¨ç»­ç­¾ï¼ˆå¯¹äº Let's Encryptï¼‰

## ğŸš¨ æ³¨æ„äº‹é¡¹

### ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§
ç¨‹åºæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§è¯»å–é…ç½®ï¼š
1. å‘½ä»¤è¡Œç¯å¢ƒå˜é‡
2. `.env` æ–‡ä»¶
3. é»˜è®¤å€¼

### ç«¯å£å†²çªå¤„ç†
- 8443: HTTPS ä¸»æœåŠ¡å™¨ç«¯å£
- 8080: HTTP é‡å®šå‘æœåŠ¡å™¨ç«¯å£ï¼ˆå¯é€‰ï¼‰

å¦‚æœç«¯å£è¢«å ç”¨ï¼Œå¯åŠ¨è„šæœ¬ä¼šæä¾›è‡ªåŠ¨å¤„ç†é€‰é¡¹ã€‚

### è¯ä¹¦è·¯å¾„
ç¡®ä¿è¯ä¹¦è·¯å¾„æ­£ç¡®ï¼š
- Windows: `certs\server.crt`, `certs\server.key`
- Linux: `certs/server.crt`, `certs/server.key`

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. é¦–å…ˆè¿è¡Œ `./start-https.sh --verify-cert` æ£€æŸ¥è¯ä¹¦
2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—è¾“å‡º
4. ç¡®è®¤ç¯å¢ƒå˜é‡è®¾ç½®æ­£ç¡®

---

**æ›´æ–°æ—¶é—´**: 2025å¹´10æœˆ14æ—¥  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ