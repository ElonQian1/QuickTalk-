<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠå¤©ç•Œé¢æµ‹è¯•</title>
    <link rel="stylesheet" href="/css/multi-shop-customer-service.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .test-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .test-header {
            background: #667eea;
            color: white;
            padding: 15px 20px;
            text-align: center;
        }
        .test-content {
            flex: 1;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h2>ğŸ“± èŠå¤©ç•Œé¢æµ‹è¯•</h2>
        </div>
        <div class="test-content">
            <div id="csContent">
                <div class="loading">æ­£åœ¨åˆå§‹åŒ–èŠå¤©ç•Œé¢...</div>
            </div>
        </div>
    </div>

    <script src="/src/multi-shop-customer-service-manager.js"></script>
    <script>
        // æ¨¡æ‹Ÿç™»å½•çŠ¶æ€å’Œæ•°æ®
        localStorage.setItem('sessionId', 'test_session_123');
        
        // åˆ›å»ºæµ‹è¯•å®ä¾‹
        const testManager = new MultiShopCustomerServiceManager();
        
        // æ¨¡æ‹Ÿå½“å‰ç”¨æˆ·å’Œåº—é“ºæ•°æ®
        testManager.currentUser = { id: 'shop_owner', username: 'shop_owner' };
        testManager.currentShop = { id: 'shop_1757591780450_1', name: 'æ—¶å°šæœè£…åº—' };
        
        // æ¨¡æ‹Ÿå¯¹è¯æ•°æ®
        const mockMessages = [
            {
                id: 1,
                content: 'Hello! Testing the chat interface',
                sender_type: 'customer',
                timestamp: new Date(Date.now() - 300000).toISOString(), // 5åˆ†é’Ÿå‰
                customer_id: 'test_user_chat_interface'
            },
            {
                id: 2,
                content: 'æˆ‘æ”¶åˆ°äº†æ‚¨çš„æ¶ˆæ¯ï¼Œæ­£åœ¨ä¸ºæ‚¨æŸ¥è¯¢ç›¸å…³ä¿¡æ¯ï¼Œè¯·ç¨ç­‰ç‰‡åˆ»...',
                sender_type: 'staff',
                timestamp: new Date(Date.now() - 240000).toISOString(), // 4åˆ†é’Ÿå‰
                sender_name: 'æ™ºèƒ½å®¢æœ'
            },
            {
                id: 3,
                content: 'è°¢è°¢å›å¤ï¼æˆ‘æƒ³äº†è§£ä¸€ä¸‹ä½ ä»¬çš„äº§å“ä¿¡æ¯',
                sender_type: 'customer',
                timestamp: new Date(Date.now() - 120000).toISOString(), // 2åˆ†é’Ÿå‰
                customer_id: 'test_user_chat_interface'
            }
        ];
        
        // è®¾ç½®å½“å‰å¯¹è¯
        testManager.currentConversation = {
            id: 'test_conversation_123',
            customer_name: 'æµ‹è¯•å®¢æˆ·',
            customer_id: 'test_user_chat_interface',
            shop_name: 'æ—¶å°šæœè£…åº—'
        };
        
        // ç›´æ¥æ¸²æŸ“èŠå¤©ç•Œé¢
        setTimeout(() => {
            testManager.renderConversation(mockMessages);
            console.log('âœ… æµ‹è¯•èŠå¤©ç•Œé¢å·²æ¸²æŸ“');
        }, 1000);
        
        // æ¨¡æ‹Ÿå‘é€æ¶ˆæ¯API
        testManager.sendMessage = async function() {
            const input = document.getElementById('messageInput');
            if (!input) return;

            const content = input.value.trim();
            if (!content) return;

            // æ·»åŠ æ¶ˆæ¯åˆ°ç•Œé¢
            const messagesList = document.getElementById('messagesList');
            const newMessage = document.createElement('div');
            newMessage.className = 'message message-staff';
            newMessage.innerHTML = `
                <div class="message-content">${this.escapeHtml(content)}</div>
                <div class="message-time">${new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', hour12: false })}</div>
            `;
            
            messagesList.appendChild(newMessage);
            messagesList.scrollTop = messagesList.scrollHeight;
            
            input.value = '';
            console.log('âœ… æµ‹è¯•æ¶ˆæ¯å·²å‘é€:', content);
        };
        
        // æ¨¡æ‹Ÿè¿”å›æŒ‰é’®
        testManager.goBackToShopDetail = function() {
            document.getElementById('csContent').innerHTML = `
                <div style="text-align: center; padding: 40px 20px; color: #666;">
                    <h3>ğŸ“‹ åº—é“ºè¯¦æƒ…é¡µé¢</h3>
                    <p>è¿™é‡Œä¼šæ˜¾ç¤ºåº—é“ºçš„æ‰€æœ‰å¯¹è¯åˆ—è¡¨</p>
                    <button onclick="location.reload()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">é‡æ–°æµ‹è¯•èŠå¤©ç•Œé¢</button>
                </div>
            `;
            console.log('âœ… è¿”å›åº—é“ºè¯¦æƒ…é¡µé¢');
        };
    </script>
</body>
</html>
