<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聊天界面测试</title>
    <link rel="stylesheet" href="/css/multi-shop-customer-service.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .test-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .test-header {
            background: #667eea;
            color: white;
            padding: 15px 20px;
            text-align: center;
        }
        .test-content {
            flex: 1;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h2>📱 聊天界面测试</h2>
        </div>
        <div class="test-content">
            <div id="csContent">
                <div class="loading">正在初始化聊天界面...</div>
            </div>
        </div>
    </div>

    <script src="/src/multi-shop-customer-service-manager.js"></script>
    <script>
        // 模拟登录状态和数据
        localStorage.setItem('sessionId', 'test_session_123');
        
        // 创建测试实例
        const testManager = new MultiShopCustomerServiceManager();
        
        // 模拟当前用户和店铺数据
        testManager.currentUser = { id: 'shop_owner', username: 'shop_owner' };
        testManager.currentShop = { id: 'shop_1757591780450_1', name: '时尚服装店' };
        
        // 模拟对话数据
        const mockMessages = [
            {
                id: 1,
                content: 'Hello! Testing the chat interface',
                sender_type: 'customer',
                timestamp: new Date(Date.now() - 300000).toISOString(), // 5分钟前
                customer_id: 'test_user_chat_interface'
            },
            {
                id: 2,
                content: '我收到了您的消息，正在为您查询相关信息，请稍等片刻...',
                sender_type: 'staff',
                timestamp: new Date(Date.now() - 240000).toISOString(), // 4分钟前
                sender_name: '智能客服'
            },
            {
                id: 3,
                content: '谢谢回复！我想了解一下你们的产品信息',
                sender_type: 'customer',
                timestamp: new Date(Date.now() - 120000).toISOString(), // 2分钟前
                customer_id: 'test_user_chat_interface'
            }
        ];
        
        // 设置当前对话
        testManager.currentConversation = {
            id: 'test_conversation_123',
            customer_name: '测试客户',
            customer_id: 'test_user_chat_interface',
            shop_name: '时尚服装店'
        };
        
        // 直接渲染聊天界面
        setTimeout(() => {
            testManager.renderConversation(mockMessages);
            console.log('✅ 测试聊天界面已渲染');
        }, 1000);
        
        // 模拟发送消息API
        testManager.sendMessage = async function() {
            const input = document.getElementById('messageInput');
            if (!input) return;

            const content = input.value.trim();
            if (!content) return;

            // 添加消息到界面
            const messagesList = document.getElementById('messagesList');
            const newMessage = document.createElement('div');
            newMessage.className = 'message message-staff';
            newMessage.innerHTML = `
                <div class="message-content">${this.escapeHtml(content)}</div>
                <div class="message-time">${new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', hour12: false })}</div>
            `;
            
            messagesList.appendChild(newMessage);
            messagesList.scrollTop = messagesList.scrollHeight;
            
            input.value = '';
            console.log('✅ 测试消息已发送:', content);
        };
        
        // 模拟返回按钮
        testManager.goBackToShopDetail = function() {
            document.getElementById('csContent').innerHTML = `
                <div style="text-align: center; padding: 40px 20px; color: #666;">
                    <h3>📋 店铺详情页面</h3>
                    <p>这里会显示店铺的所有对话列表</p>
                    <button onclick="location.reload()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">重新测试聊天界面</button>
                </div>
            `;
            console.log('✅ 返回店铺详情页面');
        };
    </script>
</body>
</html>
