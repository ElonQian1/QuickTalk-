<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•å®¢æˆ·ç«¯æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .test-info h3 {
            margin: 0 0 10px 0;
            color: #1976d2;
        }
        
        .simulation-area {
            background: #f5f5f5;
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            min-height: 400px;
            position: relative;
        }
        
        .domain-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        
        .step {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .step h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
        }
        
        button:hover {
            background: #5a6fd8;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“· QuickTalkå®¢æˆ·ç«¯æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-info">
            <h3>ğŸ¯ æµ‹è¯•ç›®æ ‡</h3>
            <p>éªŒè¯å®¢æˆ·ç«¯é›†æˆä»£ç çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œç¡®ä¿ç”¨æˆ·å¯ä»¥å‘åº—é“ºå‘é€å›¾ç‰‡ã€è§†é¢‘ç­‰å¤šåª’ä½“æ–‡ä»¶ã€‚</p>
            <ul>
                <li>ğŸ“¤ å®¢æˆ·ç«¯æ–‡ä»¶é€‰æ‹©å’Œä¸Šä¼ </li>
                <li>ğŸ–¼ï¸ å›¾ç‰‡é¢„è§ˆåŠŸèƒ½</li>
                <li>ğŸ“Š ä¸Šä¼ è¿›åº¦æ˜¾ç¤º</li>
                <li>ğŸ’¬ å¤šåª’ä½“æ¶ˆæ¯å‘é€åˆ°WebSocket</li>
                <li>ğŸ”„ ä¸åº—é“ºåå°çš„å®æ—¶é€šä¿¡</li>
            </ul>
        </div>

        <div class="simulation-area">
            <div class="domain-info">æ¨¡æ‹ŸåŸŸå: bbs16.929991.xyz</div>
            <h3>ğŸŒ å®¢æˆ·ç«¯ç½‘ç«™æ¨¡æ‹Ÿ</h3>
            <p>è¿™é‡Œæ¨¡æ‹Ÿå®¢æˆ·ç½‘ç«™åµŒå…¥QuickTalkå®¢æœç³»ç»Ÿçš„æƒ…å†µï¼š</p>
            
            <!-- è¿™é‡Œå°†åµŒå…¥åŠ¨æ€åŠ è½½çš„å®¢æœä»£ç  -->
            <div id="customer-service-area">
                <p>æ­£åœ¨åŠ è½½QuickTalkå®¢æœç³»ç»Ÿ...</p>
            </div>
        </div>

        <div class="step">
            <h4>ğŸ“‹ æµ‹è¯•æ­¥éª¤</h4>
            <ol>
                <li>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åŠ è½½å®¢æœç³»ç»Ÿ</li>
                <li>ç‚¹å‡»å®¢æœæŒ‰é’®æ‰“å¼€èŠå¤©çª—å£</li>
                <li>ç‚¹å‡»èŠå¤©çª—å£ä¸­çš„ğŸ“·æŒ‰é’®</li>
                <li>é€‰æ‹©å›¾ç‰‡æˆ–å…¶ä»–æ–‡ä»¶</li>
                <li>æŸ¥çœ‹é¢„è§ˆæ•ˆæœ</li>
                <li>ç‚¹å‡»"å‘é€æ–‡ä»¶"æŒ‰é’®</li>
                <li>è§‚å¯Ÿä¸Šä¼ è¿›åº¦å’Œæœ€ç»ˆç»“æœ</li>
            </ol>
            
            <button onclick="loadCustomerService()">ğŸš€ åŠ è½½å®¢æœç³»ç»Ÿ</button>
            <button onclick="showTestLog()">ğŸ“Š æ˜¾ç¤ºæµ‹è¯•æ—¥å¿—</button>
            <button onclick="clearLog()">ğŸ§¹ æ¸…ç©ºæ—¥å¿—</button>
            
            <div class="log" id="testLog" style="display: none;"></div>
        </div>

        <div class="step">
            <h4>ğŸ” éªŒè¯ç‚¹</h4>
            <ul id="checkpoints">
                <li>âœ… å®¢æœç³»ç»ŸåŠ è½½æˆåŠŸ</li>
                <li>â³ æ–‡ä»¶ä¸Šä¼ æŒ‰é’®æ˜¾ç¤º</li>
                <li>â³ æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†æ‰“å¼€</li>
                <li>â³ å›¾ç‰‡é¢„è§ˆæ­£å¸¸æ˜¾ç¤º</li>
                <li>â³ ä¸Šä¼ è¿›åº¦æ¡å·¥ä½œ</li>
                <li>â³ å¤šåª’ä½“æ¶ˆæ¯å‘é€æˆåŠŸ</li>
                <li>â³ åº—é“ºåå°æ”¶åˆ°æ–‡ä»¶</li>
            </ul>
        </div>
    </div>

    <script>
        let testLog = [];
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            testLog.push(`[${timestamp}] ${message}`);
            console.log(message);
            updateLogDisplay();
        }
        
        function updateLogDisplay() {
            const logElement = document.getElementById('testLog');
            if (logElement.style.display !== 'none') {
                logElement.innerHTML = testLog.join('\n');
                logElement.scrollTop = logElement.scrollHeight;
            }
        }
        
        function showTestLog() {
            const logElement = document.getElementById('testLog');
            logElement.style.display = logElement.style.display === 'none' ? 'block' : 'none';
            updateLogDisplay();
        }
        
        function clearLog() {
            testLog = [];
            updateLogDisplay();
        }
        
        function updateCheckpoint(index, status) {
            const checkpoints = document.querySelectorAll('#checkpoints li');
            if (checkpoints[index]) {
                checkpoints[index].innerHTML = checkpoints[index].innerHTML.replace(/^[âœ…â³âŒ]/, status);
            }
        }
        
        function loadCustomerService() {
            log('ğŸš€ å¼€å§‹åŠ è½½QuickTalkå®¢æœç³»ç»Ÿ...');
            
            // æ¨¡æ‹Ÿå®¢æˆ·ç½‘ç«™åµŒå…¥çš„åŠ¨æ€åŠ è½½ä»£ç 
            const script = document.createElement('script');
            script.innerHTML = `
                (function() {
                    // QuickTalké…ç½® - è¿™æ˜¯å”¯ä¸€éœ€è¦å®šåˆ¶çš„éƒ¨åˆ†
                    const QUICKTALK_CONFIG = {
                        shopKey: 'sk_ji85ucic9p00m12as1ygf34o8humuxfl',
                        shopId: 'shop_1757591780450_1',
                        shopName: 'æ—¶å°šæœè£…åº—',
                        authorizedDomain: 'bbs16.929991.xyz',
                        
                        // æœåŠ¡å™¨é…ç½®
                        serverUrl: 'http://localhost:3030',
                        
                        // ç‰ˆæœ¬æ§åˆ¶
                        version: '1.0.0',
                        cacheBreaker: Date.now() // å¼ºåˆ¶åˆ·æ–°ç¼“å­˜
                    };
                    
                    // ç”±äºæ˜¯æµ‹è¯•ç¯å¢ƒï¼Œè·³è¿‡åŸŸåéªŒè¯
                    console.log('ğŸš€ QuickTalkå®¢æœç³»ç»Ÿï¼šå¼€å§‹åŠ¨æ€åŠ è½½...');
                    parent.log('âœ… é…ç½®éªŒè¯é€šè¿‡ï¼Œå¼€å§‹åŠ è½½èµ„æº...');
                    
                    // åŠ¨æ€åŠ è½½æ ·å¼æ–‡ä»¶
                    function loadCSS() {
                        const link = document.createElement('link');
                        link.rel = 'stylesheet';
                        link.type = 'text/css';
                        link.href = QUICKTALK_CONFIG.serverUrl + '/embed/customer-service.css?v=' + QUICKTALK_CONFIG.cacheBreaker;
                        link.onload = () => {
                            parent.log('âœ… CSSæ ·å¼åŠ è½½æˆåŠŸ');
                        };
                        link.onerror = () => {
                            parent.log('âŒ CSSæ ·å¼åŠ è½½å¤±è´¥');
                        };
                        document.head.appendChild(link);
                    }
                    
                    // åŠ¨æ€åŠ è½½JavaScriptæ–‡ä»¶
                    function loadJS() {
                        const script = document.createElement('script');
                        script.type = 'text/javascript';
                        script.src = QUICKTALK_CONFIG.serverUrl + '/embed/customer-service.js?v=' + QUICKTALK_CONFIG.cacheBreaker;
                        
                        script.onload = () => {
                            parent.log('âœ… JavaScriptè„šæœ¬åŠ è½½æˆåŠŸ');
                            parent.updateCheckpoint(0, 'âœ…');
                            
                            // åˆå§‹åŒ–å®¢æœç³»ç»Ÿ
                            if (window.QuickTalkCustomerService) {
                                window.QuickTalkCustomerService.init(QUICKTALK_CONFIG);
                                parent.log('âœ… QuickTalkå®¢æœç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                                parent.updateCheckpoint(1, 'âœ…');
                                
                                // ç›‘å¬æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
                                const originalShowFileUpload = window.QuickTalkCustomerService.showFileUpload;
                                window.QuickTalkCustomerService.showFileUpload = function() {
                                    parent.log('ğŸ“· ç”¨æˆ·ç‚¹å‡»æ–‡ä»¶ä¸Šä¼ æŒ‰é’®');
                                    parent.updateCheckpoint(2, 'âœ…');
                                    return originalShowFileUpload.call(this);
                                };
                                
                                const originalHandleFileSelect = window.QuickTalkCustomerService.handleFileSelect;
                                window.QuickTalkCustomerService.handleFileSelect = function(event) {
                                    parent.log('ğŸ“ ç”¨æˆ·é€‰æ‹©äº†æ–‡ä»¶: ' + event.target.files[0]?.name);
                                    parent.updateCheckpoint(3, 'âœ…');
                                    return originalHandleFileSelect.call(this, event);
                                };
                                
                                const originalUploadAndSendFile = window.QuickTalkCustomerService.uploadAndSendFile;
                                window.QuickTalkCustomerService.uploadAndSendFile = async function() {
                                    parent.log('ğŸ“¤ å¼€å§‹ä¸Šä¼ æ–‡ä»¶...');
                                    parent.updateCheckpoint(4, 'âœ…');
                                    try {
                                        const result = await originalUploadAndSendFile.call(this);
                                        parent.log('âœ… æ–‡ä»¶ä¸Šä¼ å’Œå‘é€æˆåŠŸï¼');
                                        parent.updateCheckpoint(5, 'âœ…');
                                        return result;
                                    } catch (error) {
                                        parent.log('âŒ æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ' + error.message);
                                        parent.updateCheckpoint(5, 'âŒ');
                                        throw error;
                                    }
                                };
                            } else {
                                parent.log('âŒ QuickTalkå®¢æœç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼šä¸»æ¨¡å—æœªæ‰¾åˆ°');
                                parent.updateCheckpoint(0, 'âŒ');
                            }
                        };
                        
                        script.onerror = () => {
                            parent.log('âŒ JavaScriptè„šæœ¬åŠ è½½å¤±è´¥');
                            parent.updateCheckpoint(0, 'âŒ');
                        };
                        
                        document.head.appendChild(script);
                    }
                    
                    // å¼€å§‹åŠ è½½
                    try {
                        loadCSS();
                        loadJS();
                    } catch (e) {
                        parent.log('âŒ åŠ è½½è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + e.message);
                    }
                    
                    // å…¨å±€æš´éœ²é…ç½®ï¼ˆä¾›åŠ¨æ€åŠ è½½çš„è„šæœ¬ä½¿ç”¨ï¼‰
                    window.QUICKTALK_EMBED_CONFIG = QUICKTALK_CONFIG;
                })();
            `;
            
            document.head.appendChild(script);
            
            setTimeout(() => {
                document.getElementById('customer-service-area').innerHTML = '<p>âœ… å®¢æœç³»ç»ŸåŠ è½½å®Œæˆï¼è¯·æŸ¥çœ‹é¡µé¢å³ä¸‹è§’çš„å®¢æœæŒ‰é’®ã€‚</p>';
            }, 2000);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ“‹ æµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
            log('ğŸ’¡ ç‚¹å‡»"åŠ è½½å®¢æœç³»ç»Ÿ"æŒ‰é’®å¼€å§‹æµ‹è¯•');
        });
    </script>
</body>
</html>