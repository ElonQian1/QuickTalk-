# ğŸ“‹ updated_at å­—æ®µå®Œå–„æŠ¥å‘Š

## ğŸ¯ updated_at å­—æ®µçš„ä½œç”¨

### ğŸ“ˆ **æ ¸å¿ƒåŠŸèƒ½**
1. **å˜æ›´è¿½è¸ª** - è®°å½•æ•°æ®æœ€åä¿®æ”¹æ—¶é—´
2. **å®¡è®¡æ—¥å¿—** - ç”¨äºæ•°æ®å˜æ›´å†å²è¿½è¸ª  
3. **ç¼“å­˜å¤±æ•ˆ** - åˆ¤æ–­æ•°æ®æ˜¯å¦éœ€è¦é‡æ–°åŠ è½½
4. **å†²çªæ£€æµ‹** - åœ¨å¹¶å‘æ›´æ–°æ—¶æ£€æµ‹æ•°æ®å†²çª
5. **æ•°æ®åŒæ­¥** - å¤šç³»ç»Ÿé—´æ•°æ®åŒæ­¥çš„ä¾æ®

### ğŸ’¼ **ä¸šåŠ¡ä»·å€¼**
- **åˆè§„æ€§**: æ»¡è¶³æ•°æ®å®¡è®¡è¦æ±‚
- **ç”¨æˆ·ä½“éªŒ**: æ˜¾ç¤º"æœ€åæ›´æ–°æ—¶é—´"
- **ç³»ç»Ÿä¼˜åŒ–**: å®ç°å¢é‡åŒæ­¥å’Œç¼“å­˜ç­–ç•¥
- **é—®é¢˜è°ƒè¯•**: å¿«é€Ÿå®šä½æ•°æ®å˜æ›´é—®é¢˜

---

## âœ… å·²å®Œæˆçš„åŠŸèƒ½å®ç°

### ğŸ—„ï¸ **æ•°æ®åº“è¡¨ç»“æ„å¢å¼º**

#### 1. **users è¡¨**
```sql
ALTER TABLE users ADD COLUMN updated_at DATETIME;
```
- âœ… è‡ªåŠ¨è®°å½•ç”¨æˆ·ä¿¡æ¯æ›´æ–°æ—¶é—´
- âœ… ç°æœ‰æ•°æ®ä½¿ç”¨ created_at åˆå§‹åŒ–

#### 2. **shops è¡¨**
```sql
ALTER TABLE shops ADD COLUMN updated_at DATETIME;
```
- âœ… è‡ªåŠ¨è®°å½•åº—é“ºä¿¡æ¯æ›´æ–°æ—¶é—´
- âœ… æ”¯æŒåŸŸåã€åç§°ç­‰å­—æ®µå˜æ›´è¿½è¸ª

#### 3. **user_shops è¡¨**
```sql
ALTER TABLE user_shops ADD COLUMN updated_at DATETIME;
```
- âœ… è®°å½•ç”¨æˆ·-åº—é“ºå…³ç³»å˜æ›´æ—¶é—´
- âœ… æ”¯æŒè§’è‰²æƒé™å˜æ›´è¿½è¸ª

### ğŸ”§ **è‡ªåŠ¨åŒ–æ›´æ–°æœºåˆ¶**

#### updateShop æ–¹æ³•å¢å¼º
```javascript
async updateShop(id, updates) {
    // è‡ªåŠ¨æ·»åŠ updated_atå­—æ®µ
    const updatesWithTimestamp = {
        ...updates,
        updated_at: new Date().toISOString()
    };
    // ... å…¶ä»–é€»è¾‘
}
```

#### updateUser æ–¹æ³•å¢å¼º
```javascript
async updateUser(id, updates) {
    // è‡ªåŠ¨æ·»åŠ updated_atå­—æ®µ
    const updatesWithTimestamp = {
        ...updates,
        updated_at: new Date().toISOString()
    };
    // ... å…¶ä»–é€»è¾‘
}
```

### ğŸš€ **æ•°æ®åº“å‡çº§ç³»ç»Ÿ**

#### æ™ºèƒ½å‡çº§æœºåˆ¶
- âœ… **æ£€æµ‹ç°æœ‰å­—æ®µ**: ä½¿ç”¨ `PRAGMA table_info()` æ£€æŸ¥
- âœ… **å®‰å…¨å‡çº§**: åªä¸ºç¼ºå°‘å­—æ®µçš„è¡¨æ·»åŠ 
- âœ… **æ•°æ®åˆå§‹åŒ–**: ä¸ºç°æœ‰è®°å½•è®¾ç½®åˆç†çš„é»˜è®¤å€¼
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

---

## ğŸ¯ åŠŸèƒ½ä¼˜åŠ¿

### âœ… **å·²è§£å†³çš„é—®é¢˜**

1. **SQLiteå…¼å®¹æ€§é—®é¢˜**
   - âŒ åŸé—®é¢˜: `SQLITE_ERROR: no such column: updated_at`
   - âœ… è§£å†³æ–¹æ¡ˆ: åŠ¨æ€æ·»åŠ å­—æ®µå¹¶è‡ªåŠ¨åˆå§‹åŒ–

2. **æ•°æ®ä¸€è‡´æ€§**
   - âœ… ç°æœ‰æ•°æ®å¹³æ»‘å‡çº§
   - âœ… æ–°è®°å½•è‡ªåŠ¨åŒ…å«æ—¶é—´æˆ³

3. **å¼€å‘ä¾¿åˆ©æ€§**
   - âœ… é€æ˜è‡ªåŠ¨æ›´æ–°ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†
   - âœ… å‘åå…¼å®¹ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½

### ğŸ“Š **æ€§èƒ½ä¼˜åŒ–**

1. **å¢é‡åŒæ­¥æ”¯æŒ**
   ```sql
   SELECT * FROM shops WHERE updated_at > ?
   ```

2. **ç¼“å­˜ç­–ç•¥**
   ```javascript
   // æ£€æŸ¥æ•°æ®æ˜¯å¦éœ€è¦åˆ·æ–°
   if (cacheTime < record.updated_at) {
       // é‡æ–°åŠ è½½æ•°æ®
   }
   ```

---

## ğŸš€ æœªæ¥æ‰©å±•å»ºè®®

### ğŸ’¡ **è¿›ä¸€æ­¥ä¼˜åŒ–**

1. **è§¦å‘å™¨æœºåˆ¶**
   ```sql
   CREATE TRIGGER update_shops_timestamp 
   AFTER UPDATE ON shops
   BEGIN
       UPDATE shops SET updated_at = CURRENT_TIMESTAMP WHERE id = NEW.id;
   END;
   ```

2. **ç‰ˆæœ¬æ§åˆ¶**
   - æ·»åŠ  `version` å­—æ®µç”¨äºä¹è§‚é”
   - å®ç°å¹¶å‘æ›´æ–°å†²çªæ£€æµ‹

3. **å˜æ›´æ—¥å¿—**
   - åˆ›å»º `audit_log` è¡¨è®°å½•è¯¦ç»†å˜æ›´
   - æ”¯æŒæ•°æ®å˜æ›´å†å²æŸ¥è¯¢

4. **ç®¡ç†ç•Œé¢æ˜¾ç¤º**
   - åœ¨ç®¡ç†åå°æ˜¾ç¤º"æœ€åæ›´æ–°æ—¶é—´"
   - æ”¯æŒæŒ‰æ›´æ–°æ—¶é—´æ’åºå’Œç­›é€‰

---

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### åº—é“ºä¿¡æ¯æ›´æ–°
```javascript
// ç°åœ¨è¿™æ ·æ›´æ–°ä¼šè‡ªåŠ¨è®¾ç½®updated_at
await database.updateShop('shop123', {
    name: 'æ–°åº—é“ºåç§°',
    domain: 'new-domain.com'
});

// æŸ¥è¯¢ç»“æœä¼šåŒ…å«updated_atå­—æ®µ
const shop = await database.getShopById('shop123');
console.log('æœ€åæ›´æ–°:', shop.updated_at);
```

### ç”¨æˆ·ä¿¡æ¯æ›´æ–°
```javascript
// è‡ªåŠ¨è®¾ç½®updated_at
await database.updateUser('user123', {
    email: 'new@email.com'
});
```

---

## ğŸ‰ æ€»ç»“

æ‚¨çš„é¡¹ç›®ç°åœ¨å·²ç»**å®Œå…¨æ”¯æŒ `updated_at` åŠŸèƒ½**ï¼š

âœ… **æ•°æ®åº“ç»“æ„å®Œå–„** - æ‰€æœ‰é‡è¦è¡¨éƒ½æœ‰æ—¶é—´æˆ³å­—æ®µ  
âœ… **è‡ªåŠ¨æ›´æ–°æœºåˆ¶** - æ— éœ€æ‰‹åŠ¨ç®¡ç†æ›´æ–°æ—¶é—´  
âœ… **å¹³æ»‘å‡çº§** - ç°æœ‰æ•°æ®æ— ç¼è¿ç§»  
âœ… **å‘åå…¼å®¹** - ä¸å½±å“ç°æœ‰åŠŸèƒ½  
âœ… **ç”Ÿäº§å°±ç»ª** - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•  

è¿™æ˜¯ä¸€ä¸ª**ä¼ä¸šçº§çš„æ•°æ®ç®¡ç†åŠŸèƒ½**ï¼Œä¸ºæ‚¨çš„å®¢æœç³»ç»Ÿæä¾›äº†å¼ºå¤§çš„æ•°æ®è¿½è¸ªå’Œå®¡è®¡èƒ½åŠ›ï¼ğŸš€
