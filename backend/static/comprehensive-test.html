<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket SDK å®Œæ•´åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
        }
        .content {
            padding: 30px;
        }
        .status-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .success { background: #d4edda; color: #155724; border-left: 5px solid #28a745; }
        .error { background: #f8d7da; color: #721c24; border-left: 5px solid #dc3545; }
        .info { background: #d1ecf1; color: #0c5460; border-left: 5px solid #17a2b8; }
        .warning { background: #fff3cd; color: #856404; border-left: 5px solid #ffc107; }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        .test-card:hover {
            border-color: #007bff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .test-card h3 {
            margin-top: 0;
            color: #495057;
        }
        
        button {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        button:hover:not(:disabled) { 
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .demo-btn { background: linear-gradient(135deg, #28a745, #20c997); }
        .test-btn { background: linear-gradient(135deg, #ffc107, #fd7e14); }
        .danger-btn { background: linear-gradient(135deg, #dc3545, #c82333); }
        
        #chat-widget {
            border: 2px dashed #dee2e6;
            min-height: 200px;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            background: #f8f9fa;
            position: relative;
        }
        #chat-widget:empty::before {
            content: "ğŸ¤– å®¢æœçª—å£å°†åœ¨è¿™é‡Œæ˜¾ç¤º";
            color: #6c757d;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .feature-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .feature-item .icon {
            font-size: 24px;
            margin-right: 10px;
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .test-grid { grid-template-columns: 1fr; }
            button { min-width: 100px; font-size: 12px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ WebSocket SDK å®Œæ•´æµ‹è¯•</h1>
            <p>éªŒè¯å“åº”å¼è®¾è®¡ã€å›¾ç‰‡é¢„è§ˆã€æ–‡ä»¶å¤„ç†ç­‰æ ¸å¿ƒåŠŸèƒ½</p>
        </div>
        
        <div class="content">
            <div class="status-section">
                <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
                <div id="status" class="status info">â³ æ­£åœ¨åˆå§‹åŒ–SDK...</div>
            </div>

            <div class="feature-list">
                <div class="feature-item">
                    <div class="icon">ğŸ“±</div>
                    <div>å“åº”å¼é¢æ¿è®¾è®¡</div>
                </div>
                <div class="feature-item">
                    <div class="icon">ğŸ–¼ï¸</div>
                    <div>å›¾ç‰‡ç‚¹å‡»é¢„è§ˆ</div>
                </div>
                <div class="feature-item">
                    <div class="icon">ğŸ“</div>
                    <div>æ–‡ä»¶ä¸‹è½½æ”¯æŒ</div>
                </div>
                <div class="feature-item">
                    <div class="icon">ğŸ¯</div>
                    <div>æ¨¡å—åŒ–æ¶æ„</div>
                </div>
                <div class="feature-item">
                    <div class="icon">âš¡</div>
                    <div>WebSocketå®æ—¶é€šä¿¡</div>
                </div>
                <div class="feature-item">
                    <div class="icon">ğŸ›¡ï¸</div>
                    <div>é”™è¯¯å¤„ç†æœºåˆ¶</div>
                </div>
            </div>

            <div class="test-grid">
                <div class="test-card">
                    <h3>ğŸ”§ åŸºç¡€åŠŸèƒ½æµ‹è¯•</h3>
                    <p>éªŒè¯SDKåˆå§‹åŒ–å’Œæ ¸å¿ƒç»„ä»¶</p>
                    <button onclick="testBasicFunctions()" id="basicBtn" disabled class="test-btn">è¿è¡ŒåŸºç¡€æµ‹è¯•</button>
                </div>

                <div class="test-card">
                    <h3>ğŸ–¼ï¸ ImageVieweræµ‹è¯•</h3>
                    <p>æµ‹è¯•å›¾ç‰‡é¢„è§ˆå’Œä¸‹è½½åŠŸèƒ½</p>
                    <button onclick="testImageViewer()" id="testBtn" disabled class="test-btn">æµ‹è¯•å›¾ç‰‡æŸ¥çœ‹å™¨</button>
                    <button onclick="showDemoImage()" id="demoBtn" disabled class="demo-btn">æ˜¾ç¤ºæ¼”ç¤ºå›¾ç‰‡</button>
                </div>

                <div class="test-card">
                    <h3>ğŸ“± å“åº”å¼æµ‹è¯•</h3>
                    <p>æµ‹è¯•ä¸åŒå±å¹•å°ºå¯¸çš„é€‚é…</p>
                    <button onclick="testResponsive()" id="responsiveBtn" disabled class="test-btn">æµ‹è¯•å“åº”å¼</button>
                    <button onclick="simulateMobile()" id="mobileBtn" disabled class="demo-btn">æ¨¡æ‹Ÿç§»åŠ¨ç«¯</button>
                </div>

                <div class="test-card">
                    <h3>ğŸ’¬ æ¶ˆæ¯åŠŸèƒ½æµ‹è¯•</h3>
                    <p>æµ‹è¯•ä¸åŒç±»å‹æ¶ˆæ¯çš„æ˜¾ç¤º</p>
                    <button onclick="addTestMessages()" id="messageBtn" disabled class="demo-btn">æ·»åŠ æµ‹è¯•æ¶ˆæ¯</button>
                    <button onclick="clearMessages()" id="clearBtn" disabled class="danger-btn">æ¸…ç©ºæ¶ˆæ¯</button>
                </div>
            </div>

            <div id="chat-widget"></div>
        </div>
    </div>

    <script src="./embed/service-standalone.js"></script>
    <script>
        const statusDiv = document.getElementById('status');
        const buttons = {
            basic: document.getElementById('basicBtn'),
            test: document.getElementById('testBtn'),
            demo: document.getElementById('demoBtn'),
            responsive: document.getElementById('responsiveBtn'),
            mobile: document.getElementById('mobileBtn'),
            message: document.getElementById('messageBtn'),
            clear: document.getElementById('clearBtn')
        };
        
        let sdk = null;

        function updateStatus(message, type = 'info') {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        function enableAllButtons() {
            Object.values(buttons).forEach(btn => btn.disabled = false);
        }

        function testBasicFunctions() {
            if (!sdk) {
                updateStatus('âŒ SDKæœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                const tests = [
                    () => sdk.getConnectionState(),
                    () => sdk.getDeviceInfo(),
                    () => sdk.getUIManager(),
                    () => sdk.getUIManager().getImageViewer()
                ];
                
                let results = [];
                tests.forEach((test, index) => {
                    try {
                        const result = test();
                        results.push(`æµ‹è¯•${index + 1}: âœ… é€šè¿‡`);
                    } catch (error) {
                        results.push(`æµ‹è¯•${index + 1}: âŒ å¤±è´¥ - ${error.message}`);
                    }
                });
                
                updateStatus(`åŸºç¡€åŠŸèƒ½æµ‹è¯•å®Œæˆ - ${results.join(', ')}`, 'success');
                console.log('åŸºç¡€åŠŸèƒ½æµ‹è¯•ç»“æœ:', results);
            } catch (error) {
                updateStatus('âŒ åŸºç¡€åŠŸèƒ½æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }

        function testImageViewer() {
            if (!sdk) {
                updateStatus('âŒ SDKæœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                const uiManager = sdk.getUIManager();
                const imageViewer = uiManager.getImageViewer();
                updateStatus('âœ… ImageVieweræµ‹è¯•é€šè¿‡ï¼åŠŸèƒ½å¯ç”¨', 'success');
                console.log('ImageViewerå®ä¾‹:', imageViewer);
                console.log('ImageVieweræ–¹æ³•:', Object.getOwnPropertyNames(Object.getPrototypeOf(imageViewer)));
            } catch (error) {
                updateStatus('âŒ ImageVieweræµ‹è¯•å¤±è´¥: ' + error.message, 'error');
                console.error('é”™è¯¯è¯¦æƒ…:', error);
            }
        }

        function showDemoImage() {
            if (!sdk) {
                updateStatus('âŒ SDKæœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                const uiManager = sdk.getUIManager();
                const imageViewer = uiManager.getImageViewer();
                imageViewer.show({
                    src: 'https://via.placeholder.com/800x600/4CAF50/white?text=WebSocket+SDK+Demo',
                    alt: 'SDKæ¼”ç¤ºå›¾ç‰‡',
                    title: 'WebSocket SDK å›¾ç‰‡é¢„è§ˆæ¼”ç¤º'
                });
                updateStatus('âœ… æ¼”ç¤ºå›¾ç‰‡å·²æ‰“å¼€ï¼Œæµ‹è¯•ç‚¹å‡»ã€ä¸‹è½½ã€å…³é—­åŠŸèƒ½', 'success');
            } catch (error) {
                updateStatus('âŒ å›¾ç‰‡é¢„è§ˆå¤±è´¥: ' + error.message, 'error');
                console.error('é”™è¯¯è¯¦æƒ…:', error);
            }
        }

        function testResponsive() {
            if (!sdk) {
                updateStatus('âŒ SDKæœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                const deviceInfo = sdk.getDeviceInfo();
                updateStatus(`âœ… å“åº”å¼ä¿¡æ¯: ${deviceInfo}`, 'info');
                console.log('è®¾å¤‡ä¿¡æ¯è¯¦æƒ…:', deviceInfo);
                
                // è§¦å‘çª—å£resizeäº‹ä»¶æµ‹è¯•å“åº”å¼
                window.dispatchEvent(new Event('resize'));
                
                setTimeout(() => {
                    updateStatus('âœ… å“åº”å¼æµ‹è¯•å®Œæˆï¼Œå·²è§¦å‘resizeäº‹ä»¶', 'success');
                }, 1000);
            } catch (error) {
                updateStatus('âŒ å“åº”å¼æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }

        function simulateMobile() {
            // é€šè¿‡ä¿®æ”¹viewport metaæ ‡ç­¾æ¨¡æ‹Ÿç§»åŠ¨ç«¯
            let viewport = document.querySelector('meta[name="viewport"]');
            if (!viewport) {
                viewport = document.createElement('meta');
                viewport.name = 'viewport';
                document.head.appendChild(viewport);
            }
            viewport.content = 'width=375, initial-scale=1.0';
            
            // è§¦å‘resizeäº‹ä»¶
            window.dispatchEvent(new Event('resize'));
            
            updateStatus('âœ… å·²åˆ‡æ¢åˆ°ç§»åŠ¨ç«¯æ¨¡æ‹Ÿæ¨¡å¼ (375pxå®½åº¦)', 'info');
            
            setTimeout(() => {
                viewport.content = 'width=device-width, initial-scale=1.0';
                window.dispatchEvent(new Event('resize'));
                updateStatus('âœ… å·²æ¢å¤åˆ°å“åº”å¼æ¨¡å¼', 'success');
            }, 3000);
        }

        function addTestMessages() {
            if (!sdk) {
                updateStatus('âŒ SDKæœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                const uiManager = sdk.getUIManager();
                
                // æ·»åŠ æ–‡æœ¬æ¶ˆæ¯
                uiManager.addMessage({
                    id: 'test-1',
                    type: 'text',
                    content: 'æ¬¢è¿ä½¿ç”¨WebSocket SDK! ğŸ‰',
                    senderId: 'system',
                    timestamp: new Date().toISOString(),
                    senderType: 'staff'
                });

                // æ·»åŠ å›¾ç‰‡æ¶ˆæ¯
                uiManager.addMessage({
                    id: 'test-2',
                    type: 'image',
                    content: 'è¿™æ˜¯ä¸€å¼ æµ‹è¯•å›¾ç‰‡',
                    fileUrl: 'https://via.placeholder.com/300x200/FF6B6B/white?text=Test+Image',
                    fileName: 'test-image.jpg',
                    senderId: 'customer',
                    timestamp: new Date().toISOString(),
                    senderType: 'customer'
                });

                // æ·»åŠ æ–‡ä»¶æ¶ˆæ¯
                uiManager.addMessage({
                    id: 'test-3',
                    type: 'file',
                    content: 'æ–‡æ¡£æ–‡ä»¶',
                    fileUrl: 'https://example.com/document.pdf',
                    fileName: 'document.pdf',
                    senderId: 'staff',
                    timestamp: new Date().toISOString(),
                    senderType: 'staff'
                });

                updateStatus('âœ… æµ‹è¯•æ¶ˆæ¯å·²æ·»åŠ ï¼Œç‚¹å‡»å›¾ç‰‡å¯é¢„è§ˆ', 'success');
            } catch (error) {
                updateStatus('âŒ æ·»åŠ æµ‹è¯•æ¶ˆæ¯å¤±è´¥: ' + error.message, 'error');
            }
        }

        function clearMessages() {
            // è¿™ä¸ªåŠŸèƒ½éœ€è¦åœ¨UIManagerä¸­å®ç°
            updateStatus('âš ï¸ æ¸…ç©ºæ¶ˆæ¯åŠŸèƒ½éœ€è¦åœ¨UIManagerä¸­å®ç°', 'warning');
        }

        // åˆå§‹åŒ–SDK
        if (typeof QuickTalkSDK !== 'undefined') {
            try {
                updateStatus('ğŸ”§ åˆ›å»ºSDKå®ä¾‹...', 'info');
                
                sdk = new QuickTalkSDK({
                    shopId: 'test-shop-demo',
                    customerId: 'test-customer-demo',
                    wsUrl: 'ws://localhost:8080',
                    apiUrl: 'http://localhost:8080',
                    containerId: 'chat-widget',
                    debugMode: true
                });
                
                updateStatus('â³ æ­£åœ¨åˆå§‹åŒ–SDK...', 'info');
                
                sdk.init().then(() => {
                    updateStatus('âœ… SDKåˆå§‹åŒ–æˆåŠŸï¼æ‰€æœ‰åŠŸèƒ½å·²å°±ç»ª', 'success');
                    enableAllButtons();
                    
                    // è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
                    setTimeout(() => {
                        testBasicFunctions();
                    }, 1000);
                    
                }).catch(error => {
                    updateStatus('âŒ SDKåˆå§‹åŒ–å¤±è´¥: ' + error.message, 'error');
                    console.error('åˆå§‹åŒ–é”™è¯¯:', error);
                });
                
            } catch (error) {
                updateStatus('âŒ SDKåˆ›å»ºå¤±è´¥: ' + error.message, 'error');
                console.error('åˆ›å»ºé”™è¯¯:', error);
            }
        } else {
            updateStatus('âŒ QuickTalkSDKæœªå®šä¹‰ï¼Œè¯·æ£€æŸ¥service-standalone.jsæ˜¯å¦åŠ è½½', 'error');
        }

        // ç›‘å¬çª—å£resizeäº‹ä»¶
        window.addEventListener('resize', () => {
            if (sdk) {
                console.log('ğŸ“± çª—å£å¤§å°å˜åŒ–:', {
                    width: window.innerWidth,
                    height: window.innerHeight,
                    deviceInfo: sdk.getDeviceInfo()
                });
            }
        });
    </script>
</body>
</html>