<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è¶…çº§ç®¡ç†å‘˜æ¢å¤å·¥å…·ï¼ˆå—é™ï¼‰</title>
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial; background:#f6f7fb; color:#2c3e50; margin:0; }
    .container { max-width: 760px; margin: 40px auto; background:#fff; border-radius:16px; padding:24px 28px; box-shadow:0 6px 24px rgba(0,0,0,.06); }
    h1 { font-size:22px; margin:0 0 8px; }
    .sub { color:#6c757d; margin-bottom:20px; }
    .card { background:#f8f9fa; border:1px solid #e9ecef; border-radius:12px; padding:16px; margin:16px 0; }
    .row { display:flex; gap:16px; flex-wrap:wrap; }
    .stat { flex:1 1 150px; background:#fff; border:1px solid #e9ecef; border-radius:12px; padding:12px; text-align:center; }
    .stat .num { font-size:20px; font-weight:700; color:#3f51b5; }
    button { background:#667eea; color:#fff; border:none; border-radius:10px; padding:12px 16px; cursor:pointer; font-weight:600; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    pre { background:#0b1021; color:#c7d2fe; border-radius:12px; padding:12px; overflow:auto; }
    .ok { color:#2e7d32; }
    .warn { color:#ef6c00; }
    .err { color:#c62828; }
    a { color:#667eea; text-decoration:none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ›¡ï¸ è¶…çº§ç®¡ç†å‘˜æ¢å¤å·¥å…·ï¼ˆå—é™ï¼‰</h1>
    <div class="sub">ä»…å½“ç³»ç»Ÿå†…ä¸å­˜åœ¨ä»»ä½• super_admin æ—¶ï¼Œå…è®¸åˆ›å»º/æå‡ admin/admin123 ä¸ºè¶…çº§ç®¡ç†å‘˜ã€‚</div>

    <div class="card">
      <div class="row">
        <div class="stat">
          <div>ç®¡ç†å‘˜æ€»æ•°</div>
          <div id="totalAdmins" class="num">-</div>
        </div>
        <div class="stat">
          <div>è¶…çº§ç®¡ç†å‘˜æ•°é‡</div>
          <div id="superAdmins" class="num">-</div>
        </div>
        <div class="stat">
          <div>åº—é“ºæ€»æ•°</div>
          <div id="totalShops" class="num">-</div>
        </div>
      </div>
      <div id="status" class="sub"></div>
      <div style="display:flex; gap:12px;">
        <button id="btnRefresh">åˆ·æ–°ç»Ÿè®¡</button>
        <button id="btnRecover">æ‰§è¡Œæ¢å¤ admin â†’ super_admin</button>
        <a href="/admin" target="_blank"><button type="button">æ‰“å¼€åå°</button></a>
      </div>
    </div>

    <div class="card">
      <div style="margin-bottom:8px; font-weight:600;">æ¥å£å“åº”</div>
      <pre id="output">ç­‰å¾…æ“ä½œ...</pre>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    async function fetchStats() {
      try {
        const res = await fetch('/api/admin/stats');
        const data = await res.json();
        if (!data.success) throw new Error(data.message || 'è·å–ç»Ÿè®¡å¤±è´¥');
        const admins = data.data?.admins || [];
        const superCount = admins.filter(a => a.role === 'super_admin').length;
        const total = data.data?.summary?.total_accounts ?? admins.length;
        const shops = data.data?.summary?.total_shops ?? 0;
        $('totalAdmins').textContent = total;
        $('superAdmins').textContent = superCount;
        $('totalShops').textContent = shops;
        $('status').innerHTML = superCount > 0
          ? '<span class="warn">ç³»ç»Ÿå·²å­˜åœ¨è¶…çº§ç®¡ç†å‘˜ï¼Œæ¢å¤æŒ‰é’®å°†è¿”å›æ‹’ç»ä¿¡æ¯ï¼ˆå®‰å…¨ä¿æŠ¤ç”Ÿæ•ˆï¼‰ã€‚</span>'
          : '<span class="ok">æœªæ£€æµ‹åˆ°è¶…çº§ç®¡ç†å‘˜ï¼Œå¯æ‰§è¡Œå—é™æ¢å¤ã€‚</span>';
        $('output').textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        $('output').textContent = 'è·å–ç»Ÿè®¡å¤±è´¥: ' + e.message;
        $('status').innerHTML = '<span class="err">æ— æ³•è·å–ç»Ÿè®¡ï¼Œè¯·ç¡®è®¤åç«¯åœ¨çº¿ã€‚</span>';
      }
    }

    async function recover() {
      $('btnRecover').disabled = true;
      $('output').textContent = 'è¯·æ±‚ä¸­...';
      try {
        const res = await fetch('/api/admin/recover-super-admin', { method: 'POST' });
        const data = await res.json();
        $('output').textContent = JSON.stringify(data, null, 2);
        await fetchStats();
      } catch (e) {
        $('output').textContent = 'æ¢å¤å¤±è´¥: ' + e.message;
      } finally {
        $('btnRecover').disabled = false;
      }
    }

    $('btnRefresh').addEventListener('click', fetchStats);
    $('btnRecover').addEventListener('click', recover);
    fetchStats();
  </script>
</body>
</html>
