<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>QuickTalk ÁßªÂä®Á´ØÁÆ°ÁêÜÂêéÂè∞ (ÈáçÊûÑÁâà)</title>
    
    <!-- ==================== Ê†∏ÂøÉÊ†∑ÂºèÊ®°Âùó ==================== -->
    <!-- Âü∫Á°ÄÊ†∑ÂºèÔºàÊåâ‰ºòÂÖàÁ∫ßÊéíÂ∫èÔºâ -->
    <link rel="stylesheet" href="/static/css/reset.css">
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/responsive-layout.css">
    
    <!-- Ê†∏ÂøÉÂäüËÉΩÊ†∑Âºè -->
    <link rel="stylesheet" href="/static/css/responsive-messages.css">
    <link rel="stylesheet" href="/static/css/chat-input-enhanced.css">
    <link rel="stylesheet" href="/static/css/conversation-avatar.css">
    
    <!-- UIÁªÑ‰ª∂Ê†∑Âºè -->
    <link rel="stylesheet" href="/static/css/toast.css">
    <link rel="stylesheet" href="/static/css/modal-styles.css">
    <link rel="stylesheet" href="/static/css/button-styles.css">
    <link rel="stylesheet" href="/static/css/form-styles.css">
    
    <!-- Â∏ÉÂ±ÄÊ†∑Âºè -->
    <link rel="stylesheet" href="/static/css/top-bar.css">
    <link rel="stylesheet" href="/static/css/bottom-nav.css">
    <link rel="stylesheet" href="/static/css/mobile-layout.css">
    
    <!-- ÂäüËÉΩÊ®°ÂùóÊ†∑Âºè -->
    <link rel="stylesheet" href="/static/css/shop-card-styles.css">
    <link rel="stylesheet" href="/static/css/messages-list.css">
    <link rel="stylesheet" href="/static/css/state-styles.css">

    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="app-container">
        <!-- Ê°åÈù¢Á´Ø‰æßËæπÂØºËà™Ê†è -->
        <div data-include="/static/components/sidebar-nav.html"></div>
        
        <!-- ÁßªÂä®Á´ØÈ°∂ÈÉ®Áä∂ÊÄÅÊ†è -->
        <div data-include="/static/components/top-bar.html" class="d-md-none"></div>

        <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
        <div class="main-content">
            <div data-include="/static/components/main-content.html"></div>
        </div>

        <!-- ÁßªÂä®Á´ØÂ∫ïÈÉ®ÂØºËà™Ê†è -->
        <div data-include="/static/components/bottom-nav.html" class="d-md-none"></div>
    </div>

    <!-- ==================== ÈáçÊûÑÂêéÁöÑËΩªÈáèÂåñJavaScriptÊ®°Âùó ==================== -->
    
    <!-- 1. Âü∫Á°ÄËÆæÊñΩÂ±Ç (Core Infrastructure) -->
    <script src="/static/js/core/module-registry.js"></script>
    <script src="/static/js/core/constants.js"></script>
    <script src="/static/js/core/logger.js"></script>
    <script src="/static/js/core/event-bus.js"></script>
    <script src="/static/js/core/responsive-view-manager.js"></script>
    
    <!-- 2. Â∑•ÂÖ∑Â∫ìÂ±Ç (Utilities) -->
    <script src="/static/js/utils/global-utils.js"></script>
    <script src="/static/js/utils/auth-helper.js"></script>
    <script src="/static/js/utils/http-utils.js"></script>
    <script src="/static/js/utils/loading-utils.js"></script>
    <script src="/static/js/utils/notify-utils.js"></script>
    <script src="/static/js/utils/modal-utils.js"></script>
    <script src="/static/js/utils/partials-loader.js"></script>
    
    <!-- 3. È¢ÜÂüüÊ®°ÂûãÂ±Ç (Domain Models) -->
    <script src="/static/js/domain/entities/conversation.js"></script>
    <script src="/static/js/domain/entities/message.js"></script>
    <script src="/static/js/domain/entities/shop.js"></script>
    <script src="/static/js/domain/services/session-service.js"></script>
    
    <!-- 4. Ê∂àÊÅØÊ†∏ÂøÉÊ®°Âùó (Message Core) -->
    <script src="/static/js/core/base-manager.js"></script>
    <script src="/static/js/message/core/message-event-bus.js"></script>
    <script src="/static/js/message/core/message-state-store.js"></script>
    <script src="/static/js/message/core/message-sender.js"></script>
    <script src="/static/js/message/ui/message-render-adapter.js"></script>
    
    <!-- 5. ‰∏öÂä°ÁÆ°ÁêÜÂô® (Business Managers) -->
    <script src="/static/js/usecases/shops-manager-clean.js"></script>
    <script src="/static/js/usecases/conversations-manager-clean.js"></script>
    <script src="/static/js/usecases/messages-manager-clean.js"></script>
    <script src="/static/js/usecases/media-handler.js"></script>
    
    <!-- 6. WebSocketÂü∫Á°ÄËÆæÊñΩ (WebSocket Infrastructure) -->
    <script src="/static/js/websocket/websocket-base.js"></script>
    <script src="/static/js/websocket/simple-websocket-adapter.js"></script>
    <script src="/static/js/websocket/ws-event-router.js"></script>
    <script src="/static/js/websocket/message-send-channel.js"></script>
    
    <!-- 7. ÈáçÊûÑÂêéÁöÑËΩªÈáèÂåñÊ†∏ÂøÉÊ®°Âùó (New Lightweight Core) -->
    <script src="/static/js/core/message-coordinator.js"></script>
    <script src="/static/js/compat/message-legacy-compat-layer.js"></script>
    <script src="/static/js/integrator/message-module-integrator.js"></script>
    
    <!-- 8. UIÁªÑ‰ª∂Â±Ç (UI Components) -->
    <script src="/static/js/ui/toast.js"></script>
    <script src="/static/js/ui/empty-states.js"></script>
    <script src="/static/js/ui/loading-states.js"></script>
    <script src="/static/js/ui/message-bubble.js"></script>
    <script src="/static/js/ui/bottom-nav.js"></script>
    
    <!-- 9. ÁßªÂä®Á´ØÈÄÇÈÖçÂô® (Mobile Adapters) -->
    <script src="/static/js/mobile/mobile-bootstrap.js"></script>
    <script src="/static/js/mobile/message-view-mobile-adapter.js"></script>
    <script src="/static/js/mobile/conversations-mobile-adapter.js"></script>
    <script src="/static/js/mobile/shops-mobile-adapter.js"></script>
    
    <!-- 10. ÂºÄÂèëÂíåÈ™åËØÅÂ∑•ÂÖ∑ (Development Tools) -->
    <script src="/static/js/utils/message-functionality-checker.js"></script>
    <script src="/static/js/utils/message-functionality-enhancer.js"></script>
    <script src="/static/js/utils/module-dependency-analyzer.js"></script>
    
    <!-- 11. Â∫îÁî®ÂêØÂä®Âô® (App Bootstrap) -->
    <script src="/static/js/bootstrap/app-bootstrap.js"></script>
    <script src="/static/js/bootstrap/messages-micro-bootstrap.js"></script>
    
    <!-- 12. Ê®°ÊÄÅÊ°ÜÂíåË°®Âçï (Modals & Forms) -->
    <div data-include="/static/components/modals/modal-overlay.html"></div>
    <div data-include="/static/components/modals/shop-management-modal.html"></div>
    <div data-include="/static/components/modals/create-shop-modal.html"></div>
    <div data-include="/static/components/modals/edit-shop-modal.html"></div>
    <div data-include="/static/components/modals/integration-code-modal.html"></div>
    
    <!-- Ê®°ÊÄÅÊ°ÜËÑöÊú¨ -->
    <script src="/static/js/modals/create-shop-modal.js"></script>
    <script src="/static/js/modals/edit-shop-modal.js"></script>
    <script src="/static/js/modals/integration-code-modal.js"></script>
    
    <!-- 13. Áî®‰æãÊ®°Âùó (Essential Use Cases) -->
    <script src="/static/js/usecases/shop-actions.js"></script>
    <script src="/static/js/usecases/conversation-actions.js"></script>
    <script src="/static/js/usecases/page-navigation.js"></script>
    <script src="/static/js/usecases/auth-session.js"></script>
    
    <!-- Â∫îÁî®ÂàùÂßãÂåñËÑöÊú¨ -->
    <script>
        console.log('üöÄ QuickTalk Mobile Dashboard (ÈáçÊûÑÁâà) Ê≠£Âú®ÂêØÂä®...');
        
        // Á≠âÂæÖÊâÄÊúâÊ®°ÂùóÂä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üì± DOMÂä†ËΩΩÂÆåÊàêÔºåÂºÄÂßãÂàùÂßãÂåñÊ®°Âùó...');
            
            // Ê£ÄÊü•ÂÖ≥ÈîÆÊ®°ÂùóÊòØÂê¶Â∑≤Âä†ËΩΩ
            const requiredModules = [
                'MessageModuleIntegrator',
                'MessageCoreCoordinator', 
                'SimpleWebSocketAdapter',
                'MessageLegacyCompatLayer'
            ];
            
            const missingModules = requiredModules.filter(module => !window[module]);
            
            if (missingModules.length > 0) {
                console.error('‚ùå Áº∫Â∞ëÂÖ≥ÈîÆÊ®°Âùó:', missingModules);
                return;
            }
            
            console.log('‚úÖ ÊâÄÊúâÂÖ≥ÈîÆÊ®°ÂùóÂ∑≤Âä†ËΩΩ');
            
            // ÈõÜÊàêÂô®‰ºöËá™Âä®ÂàùÂßãÂåñÊâÄÊúâÊ®°Âùó
            // ËøôÈáåÂè™ÈúÄË¶ÅÁ≠âÂæÖÂàùÂßãÂåñÂÆåÊàêÁöÑ‰∫ã‰ª∂
            if (window.MessageIntegratorInstance) {
                const checkInitialization = () => {
                    const status = window.MessageIntegratorInstance.getInitializationStatus();
                    if (status.initialized) {
                        console.log('üéâ Ê∂àÊÅØÊ®°ÂùóÈõÜÊàêÂô®ÂàùÂßãÂåñÂÆåÊàê!');
                        console.log('üìä Ê®°ÂùóÁä∂ÊÄÅ:', window.MessageIntegratorInstance.getModuleStatus());
                        
                        // ËøêË°åÂäüËÉΩÂÆåÊï¥ÊÄßÊ£ÄÊü•
                        if (window.MessageFunctionalityChecker) {
                            setTimeout(() => {
                                const checker = new window.MessageFunctionalityChecker();
                                checker.runCheck().then(results => {
                                    console.log('‚úÖ ÂäüËÉΩÂÆåÊï¥ÊÄßÊ£ÄÊü•ÂÆåÊàêÔºåËØÑÂàÜ:', results.overall.score + '/100');
                                });
                            }, 1000);
                        }
                        
                    } else {
                        console.log('‚è≥ Á≠âÂæÖÊ®°ÂùóÂàùÂßãÂåñ...');
                        setTimeout(checkInitialization, 200);
                    }
                };
                
                checkInitialization();
            }
            
            // ÂêØÁî®Â¢ûÂº∫ÂäüËÉΩ
            if (window.MessageFunctionalityEnhancer) {
                window.MessageFunctionalityEnhancer.init({
                    autoFocus: true,
                    keyboardShortcuts: true,
                    fileDropZone: true,
                    debug: false
                });
                console.log('‚ú® Ê∂àÊÅØÂäüËÉΩÂ¢ûÂº∫Âô®Â∑≤ÂêØÁî®');
            }
        });
        
        // ÂÖ®Â±ÄÈîôËØØÂ§ÑÁêÜ
        window.addEventListener('error', (event) => {
            console.error('üö® ÂÖ®Â±ÄÈîôËØØ:', event.error);
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            console.error('üö® Êú™Â§ÑÁêÜÁöÑPromiseÊãíÁªù:', event.reason);
        });
    </script>
</body>
</html>