<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>QuickTalk ç§»åŠ¨ç«¯ç®¡ç†åå° (é‡æ„ç‰ˆ)</title>
    
    <!-- ==================== æ ¸å¿ƒæ ·å¼æ¨¡å— ==================== -->
    <!-- åŸºç¡€æ ·å¼ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰ -->
    <link rel="stylesheet" href="/static/css/reset.css">
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/responsive-layout.css">
    
    <!-- æ ¸å¿ƒåŠŸèƒ½æ ·å¼ -->
    <link rel="stylesheet" href="/static/css/responsive-messages.css">
    <link rel="stylesheet" href="/static/css/chat-input-enhanced.css">
    <link rel="stylesheet" href="/static/css/conversation-avatar.css">
    
    <!-- UIç»„ä»¶æ ·å¼ -->
    <link rel="stylesheet" href="/static/css/toast.css">
    <link rel="stylesheet" href="/static/css/modal-styles.css">
    <link rel="stylesheet" href="/static/css/button-styles.css">
    <link rel="stylesheet" href="/static/css/form-styles.css">
    
    <!-- å¸ƒå±€æ ·å¼ -->
    <link rel="stylesheet" href="/static/css/top-bar.css">
    <link rel="stylesheet" href="/static/css/bottom-nav.css">
    <link rel="stylesheet" href="/static/css/mobile-layout.css">
    
    <!-- åŠŸèƒ½æ¨¡å—æ ·å¼ -->
    <link rel="stylesheet" href="/static/css/shop-card-styles.css">
    <link rel="stylesheet" href="/static/css/messages-list.css">
    <link rel="stylesheet" href="/static/css/state-styles.css">

    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="app-container">
        <!-- æ¡Œé¢ç«¯ä¾§è¾¹å¯¼èˆªæ  -->
        <div data-include="/static/components/sidebar-nav.html"></div>
        
        <!-- ç§»åŠ¨ç«¯é¡¶éƒ¨çŠ¶æ€æ  -->
        <div data-include="/static/components/top-bar.html" class="d-md-none"></div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <div data-include="/static/components/main-content.html"></div>
        </div>

        <!-- ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆªæ  -->
        <div data-include="/static/components/bottom-nav.html" class="d-md-none"></div>
    </div>

    <!-- ==================== é‡æ„åçš„è½»é‡åŒ–JavaScriptæ¨¡å— ==================== -->
    
    <!-- 1. åŸºç¡€è®¾æ–½å±‚ (Core Infrastructure) -->
    <script src="/static/js/core/module-registry.js"></script>
    <script src="/static/js/core/constants.js"></script>
    <script src="/static/js/core/logger.js"></script>
    <script src="/static/js/core/event-bus.js"></script>
    <script src="/static/js/core/responsive-view-manager.js"></script>
    
    <!-- 2. å·¥å…·åº“å±‚ (Utilities) -->
    <script src="/static/js/utils/global-utils.js"></script>
    <script src="/static/js/utils/auth-helper.js"></script>
    <script src="/static/js/utils/http-utils.js"></script>
    <script src="/static/js/utils/loading-utils.js"></script>
    <script src="/static/js/utils/notify-utils.js"></script>
    <script src="/static/js/utils/modal-utils.js"></script>
    <script src="/static/js/utils/partials-loader.js"></script>
    
    <!-- 3. é¢†åŸŸæ¨¡å‹å±‚ (Domain Models) -->
    <script src="/static/js/domain/entities/conversation.js"></script>
    <script src="/static/js/domain/entities/message.js"></script>
    <script src="/static/js/domain/entities/shop.js"></script>
    <script src="/static/js/domain/services/session-service.js"></script>
    
    <!-- 4. æ¶ˆæ¯æ ¸å¿ƒæ¨¡å— (Message Core) -->
    <script src="/static/js/core/base-manager.js"></script>
    <script src="/static/js/message/core/message-event-bus.js"></script>
    <script src="/static/js/message/core/message-state-store.js"></script>
    <script src="/static/js/message/core/message-sender.js"></script>
    <script src="/static/js/message/ui/message-render-adapter.js"></script>
    
    <!-- 5. ä¸šåŠ¡ç®¡ç†å™¨ (Business Managers) -->
    <script src="/static/js/usecases/shops-manager-clean.js"></script>
    <script src="/static/js/usecases/conversations-manager-clean.js"></script>
    <script src="/static/js/usecases/messages-manager-clean.js"></script>
    <script src="/static/js/usecases/media-handler.js"></script>
    
    <!-- 6. WebSocketåŸºç¡€è®¾æ–½ (WebSocket Infrastructure) -->
    <script src="/static/js/websocket/websocket-base.js"></script>
    <script src="/static/js/websocket/simple-websocket-adapter.js"></script>
    <script src="/static/js/websocket/ws-event-router.js"></script>
    <script src="/static/js/websocket/message-send-channel.js"></script>
    
    <!-- 7. é‡æ„åçš„è½»é‡åŒ–æ ¸å¿ƒæ¨¡å— (New Lightweight Core) -->
    <script src="/static/js/core/message-coordinator.js"></script>
    <script src="/static/js/compat/message-legacy-compat-layer.js"></script>
    <script src="/static/js/integrator/message-module-integrator.js"></script>
    
    <!-- 8. UIç»„ä»¶å±‚ (UI Components) -->
    <script src="/static/js/ui/toast.js"></script>
    <script src="/static/js/ui/empty-states.js"></script>
    <script src="/static/js/ui/loading-states.js"></script>
    <script src="/static/js/ui/message-bubble.js"></script>
    <script src="/static/js/ui/bottom-nav.js"></script>
    
    <!-- 9. ç§»åŠ¨ç«¯é€‚é…å™¨ (Mobile Adapters) -->
    <script src="/static/js/mobile/mobile-bootstrap.js"></script>
    <script src="/static/js/mobile/message-view-mobile-adapter.js"></script>
    <script src="/static/js/mobile/conversations-mobile-adapter.js"></script>
    <script src="/static/js/mobile/shops-mobile-adapter.js"></script>
    
    <!-- 10. å¼€å‘å’ŒéªŒè¯å·¥å…· (Development Tools) -->
    <script src="/static/js/utils/message-functionality-checker.js"></script>
    <script src="/static/js/utils/message-functionality-enhancer.js"></script>
    <script src="/static/js/utils/module-dependency-analyzer.js"></script>
    
    <!-- 11. åº”ç”¨å¯åŠ¨å™¨ (App Bootstrap) -->
    <script src="/static/js/bootstrap/app-bootstrap.js"></script>
    <script src="/static/js/bootstrap/messages-micro-bootstrap.js"></script>
    
    <!-- 12. æ¨¡æ€æ¡†å’Œè¡¨å• (Modals & Forms) -->
    <div data-include="/static/components/modals/modal-overlay.html"></div>
    <div data-include="/static/components/modals/shop-management-modal.html"></div>
    <div data-include="/static/components/modals/create-shop-modal.html"></div>
    <div data-include="/static/components/modals/edit-shop-modal.html"></div>
    <div data-include="/static/components/modals/integration-code-modal.html"></div>
    
    <!-- æ¨¡æ€æ¡†è„šæœ¬ -->
    <script src="/static/js/modals/create-shop-modal.js"></script>
    <script src="/static/js/modals/edit-shop-modal.js"></script>
    <script src="/static/js/modals/integration-code-modal.js"></script>
    
    <!-- 13. ç”¨ä¾‹æ¨¡å— (Essential Use Cases) -->
    <script src="/static/js/usecases/shop-actions.js"></script>
    <script src="/static/js/usecases/conversation-actions.js"></script>
    <script src="/static/js/usecases/page-navigation.js"></script>
    <script src="/static/js/usecases/auth-session.js"></script>
    
    <!-- åº”ç”¨åˆå§‹åŒ–è„šæœ¬ -->
    <script>
        console.log('ğŸš€ QuickTalk Mobile Dashboard (é‡æ„ç‰ˆ) æ­£åœ¨å¯åŠ¨...');
        
        // ç­‰å¾…æ‰€æœ‰æ¨¡å—åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ“± DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–æ¨¡å—...');
            
            // æ£€æŸ¥å…³é”®æ¨¡å—æ˜¯å¦å·²åŠ è½½
            const requiredModules = [
                'MessageModuleIntegrator',
                'MessageCoreCoordinator', 
                'SimpleWebSocketAdapter',
                'MessageLegacyCompatLayer'
            ];
            
            const missingModules = requiredModules.filter(module => !window[module]);
            
            if (missingModules.length > 0) {
                console.error('âŒ ç¼ºå°‘å…³é”®æ¨¡å—:', missingModules);
                return;
            }
            
            console.log('âœ… æ‰€æœ‰å…³é”®æ¨¡å—å·²åŠ è½½');
            
            // é›†æˆå™¨ä¼šè‡ªåŠ¨åˆå§‹åŒ–æ‰€æœ‰æ¨¡å—
            // è¿™é‡Œåªéœ€è¦ç­‰å¾…åˆå§‹åŒ–å®Œæˆçš„äº‹ä»¶
            if (window.MessageIntegratorInstance) {
                const checkInitialization = () => {
                    const status = window.MessageIntegratorInstance.getInitializationStatus();
                    if (status.initialized) {
                        console.log('ğŸ‰ æ¶ˆæ¯æ¨¡å—é›†æˆå™¨åˆå§‹åŒ–å®Œæˆ!');
                        console.log('ğŸ“Š æ¨¡å—çŠ¶æ€:', window.MessageIntegratorInstance.getModuleStatus());
                        
                        // è¿è¡ŒåŠŸèƒ½å®Œæ•´æ€§æ£€æŸ¥
                        if (window.MessageFunctionalityChecker) {
                            setTimeout(() => {
                                const checker = new window.MessageFunctionalityChecker();
                                checker.runCheck().then(results => {
                                    console.log('âœ… åŠŸèƒ½å®Œæ•´æ€§æ£€æŸ¥å®Œæˆï¼Œè¯„åˆ†:', results.overall.score + '/100');
                                });
                            }, 1000);
                        }
                        
                    } else {
                        console.log('â³ ç­‰å¾…æ¨¡å—åˆå§‹åŒ–...');
                        setTimeout(checkInitialization, 200);
                    }
                };
                
                checkInitialization();
            }
            
            // å¯ç”¨å¢å¼ºåŠŸèƒ½
            if (window.MessageFunctionalityEnhancer) {
                window.MessageFunctionalityEnhancer.init({
                    autoFocus: true,
                    keyboardShortcuts: true,
                    fileDropZone: true,
                    debug: false
                });
                console.log('âœ¨ æ¶ˆæ¯åŠŸèƒ½å¢å¼ºå™¨å·²å¯ç”¨');
            }
        });
        
        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', (event) => {
            console.error('ğŸš¨ å…¨å±€é”™è¯¯:', event.error);
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            console.error('ğŸš¨ æœªå¤„ç†çš„Promiseæ‹’ç»:', event.reason);
        });
    </script>
</body>
</html>