<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>å®¢æœç®¡ç†åå° - æé€Ÿä¼˜åŒ–ç‰ˆ</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/mobile.css">
</head>
<body class="bg-light">
    <div id="app">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <div data-include="/static/components/navbar.html"></div>
        
        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <main class="container-fluid">
            <div class="row h-100">
                <!-- æ¡Œé¢ç«¯ä¾§è¾¹æ  -->
                <div data-include="/static/components/sidebar.html" class="d-none d-md-block col-md-3 col-lg-2"></div>
                
                <!-- ä¸»è¦å†…å®¹ -->
                <div class="col-12 col-md-9 col-lg-10">
                    <div data-include="/static/components/main-content.html"></div>
                </div>
            </div>
        </main>
        
        <!-- ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆªæ  -->
        <div data-include="/static/components/bottom-nav.html" class="d-md-none"></div>
    </div>

    <!-- ==================== æé€Ÿä¼˜åŒ–JavaScriptæ¶æ„ ==================== -->
    
    <!-- ğŸ—ï¸ åŸºç¡€è®¾æ–½å±‚ (Infrastructure) - 14ä¸ªæ–‡ä»¶ -->
    <script src="/static/js/core/module-registry.js"></script>     <!-- æ¨¡å—æ³¨å†Œä¸­å¿ƒ -->
    <script src="/static/js/websocket/websocket-base.js"></script>  <!-- WebSocketåŸºç¡€ç±» -->
    <script src="/static/js/ui/ui-base.js"></script>               <!-- UIåŸºç¡€ç±» -->
    <script src="/static/js/utils/utils-base.js"></script>         <!-- å·¥å…·åŸºç¡€ç±» -->
    <script src="/static/js/core/unified-utils.js"></script>       <!-- ç»Ÿä¸€å·¥å…·å‡½æ•°åº“ -->
    <script src="/static/js/core/unified-clipboard.js"></script>   <!-- ç»Ÿä¸€å‰ªè´´æ¿å·¥å…· -->
    <script src="/static/js/core/api-client.js"></script>          <!-- ç»Ÿä¸€APIå®¢æˆ·ç«¯ -->
    <script src="/static/js/core/template-renderer.js"></script>   <!-- ç»Ÿä¸€æ¨¡æ¿æ¸²æŸ“å™¨ -->
    <script src="/static/js/core/unified-logger.js"></script>      <!-- ç»Ÿä¸€æ—¥å¿—ç®¡ç†å™¨ -->
    <script src="/static/js/core/unified-event-bus.js"></script>   <!-- ç»Ÿä¸€äº‹ä»¶æ€»çº¿ -->
    <script src="/static/js/core/event-migration-compat.js"></script> <!-- äº‹ä»¶ç³»ç»Ÿå…¼å®¹å±‚ -->
    <script src="/static/js/core/websocket-manager.js"></script>   <!-- ç»Ÿä¸€WebSocketç®¡ç†å™¨ -->
    <script src="/static/js/core/base-manager.js"></script>        <!-- ä¸šåŠ¡ç®¡ç†åŸºç¡€ç±» -->
    <script src="/static/js/core/state-coordinator.js"></script>   <!-- çŠ¶æ€åè°ƒå™¨ -->
    <script src="/static/js/core/event-bus.js"></script>           <!-- äº‹ä»¶æ€»çº¿ -->
    
    <!-- ğŸ“¦ æ ¸å¿ƒæ¨¡å—å±‚ (Core) - 4ä¸ªæ–‡ä»¶ -->
    <script src="/static/js/websocket/simple-websocket-adapter.js"></script>  <!-- WebSocketè¿æ¥ -->
    <script src="/static/js/websocket/ws-event-router.js"></script>          <!-- äº‹ä»¶è·¯ç”± -->
    <script src="/static/js/websocket/message-send-channel.js"></script>     <!-- æ¶ˆæ¯å‘é€ -->
    <script src="/static/js/core/message-coordinator.js"></script>           <!-- æ¶ˆæ¯åè°ƒå™¨ -->
    
    <!-- ğŸ¨ UIç»„ä»¶å±‚ (Components) - 3ä¸ªæ–‡ä»¶ -->
    <script src="/static/js/ui/toast.js"></script>                   <!-- è½»é€šçŸ¥ -->
    <script src="/static/js/ui/loading-states-optimized.js"></script> <!-- åŠ è½½æ€ -->
    <script src="/static/js/ui/empty-states.js"></script>            <!-- ç©ºçŠ¶æ€ -->
    
    <!-- ğŸ’¼ ä¸šåŠ¡é€»è¾‘å±‚ (Business) - 3ä¸ªæ–‡ä»¶ -->
    <script src="/static/js/usecases/shops-manager-clean.js"></script>       <!-- åº—é“ºç®¡ç† (ä¼˜åŒ–ç‰ˆ) -->
    <script src="/static/js/usecases/conversations-manager-clean.js"></script> <!-- å¯¹è¯ç®¡ç† (ä¼˜åŒ–ç‰ˆ) -->
    <script src="/static/js/usecases/messages-manager-clean.js"></script>    <!-- æ¶ˆæ¯ç®¡ç† (ä¼˜åŒ–ç‰ˆ) -->
    
    <!-- ğŸ“± ç§»åŠ¨ç«¯é€‚é…å±‚ (Mobile) - 2ä¸ªæ–‡ä»¶ -->
    <script src="/static/js/mobile/mobile-bootstrap.js"></script>      <!-- ç§»åŠ¨ç«¯åˆå§‹åŒ– -->
    <script src="/static/js/utils/partials-loader.js"></script>        <!-- ç»„ä»¶åŠ è½½å™¨ -->
    
    <!-- ğŸš€ åº”ç”¨å¯åŠ¨å™¨ (Bootstrap) - 1ä¸ªæ–‡ä»¶ -->
    <script>
        // æé€Ÿå¯åŠ¨è„šæœ¬ - ä»£æ›¿å¤šä¸ªå°æ–‡ä»¶
        (function() {
            'use strict';
            
            console.log('ğŸš€ æé€Ÿä¼˜åŒ–ç‰ˆå®¢æœç³»ç»Ÿå¯åŠ¨ä¸­...');
            
            // ç­‰å¾…DOMåŠ è½½å®Œæˆ
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initApp);
            } else {
                initApp();
            }
            
            function initApp() {
                console.log('ğŸ“± æ£€æµ‹è®¾å¤‡ç±»å‹...');
                
                // è®¾å¤‡æ£€æµ‹
                const isMobile = window.innerWidth <= 768;
                document.body.classList.toggle('mobile-device', isMobile);
                
                // åˆå§‹åŒ–åŸºç¡€è®¾æ–½
                console.log('ğŸ—ï¸ åˆå§‹åŒ–åŸºç¡€è®¾æ–½...');
                initInfrastructure();
                
                // åˆå§‹åŒ–ä¸šåŠ¡æ¨¡å—
                console.log('ğŸ’¼ åˆå§‹åŒ–ä¸šåŠ¡æ¨¡å—...');
                initBusinessModules();
                
                // åˆå§‹åŒ–UIç»„ä»¶
                console.log('ğŸ¨ åˆå§‹åŒ–UIç»„ä»¶...');
                initUIComponents();
                
                console.log('âœ… ç³»ç»Ÿå¯åŠ¨å®Œæˆï¼å…±åŠ è½½ 21 ä¸ªæ¨¡å—æ–‡ä»¶');
            }
            
            function initInfrastructure() {
                // WebSocketè¿æ¥åˆå§‹åŒ–
                if (window.SimpleWebSocketAdapter) {
                    window.wsAdapter = new SimpleWebSocketAdapter({
                        debug: false,
                        maxReconnectAttempts: 10
                    });
                    window.wsAdapter.connect();
                }
                
                // äº‹ä»¶è·¯ç”±åˆå§‹åŒ–
                if (window.WsEventRouter && window.MessageCoordinator) {
                    window.eventRouter = new WsEventRouter(window.MessageCoordinator, {
                        debug: false
                    });
                }
                
                // æ¶ˆæ¯å‘é€é€šé“åˆå§‹åŒ–
                if (window.MessageSendChannel) {
                    window.MessageSendChannel.init({
                        debug: false,
                        maxRetries: 3
                    });
                }
            }
            
            function initBusinessModules() {
                // ä¸šåŠ¡ç®¡ç†å™¨æŒ‰éœ€åˆå§‹åŒ–
                if (window.ShopsManager) {
                    window.shopsManager = new ShopsManager();
                }
                
                if (window.ConversationsManager) {
                    window.conversationsManager = new ConversationsManager();
                }
                
                if (window.MessagesManager) {
                    window.messagesManager = new MessagesManager();
                }
            }
            
            function initUIComponents() {
                // UIç»„ä»¶å·²è‡ªåŠ¨åˆå§‹åŒ–ä¸ºå…¨å±€å•ä¾‹
                console.log('UIç»„ä»¶ç»Ÿè®¡:', {
                    toast: !!window.Toast,
                    loading: !!window.LoadingStatesUI,
                    empty: !!window.EmptyStatesUI
                });
            }
            
            // å…¨å±€é”™è¯¯å¤„ç†
            window.addEventListener('error', function(event) {
                console.error('å…¨å±€é”™è¯¯:', event.error);
                if (window.Toast) {
                    window.Toast.error('ç³»ç»Ÿå‡ºç°é”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                }
            });
            
            // ç½‘ç»œçŠ¶æ€ç›‘æ§
            if ('navigator' in window && 'onLine' in navigator) {
                function updateOnlineStatus() {
                    const isOnline = navigator.onLine;
                    document.body.classList.toggle('offline', !isOnline);
                    
                    if (window.Toast) {
                        if (isOnline) {
                            window.Toast.success('ç½‘ç»œè¿æ¥å·²æ¢å¤');
                        } else {
                            window.Toast.warning('ç½‘ç»œè¿æ¥å·²æ–­å¼€');
                        }
                    }
                }
                
                window.addEventListener('online', updateOnlineStatus);
                window.addEventListener('offline', updateOnlineStatus);
            }
            
        })();
    </script>

    <!-- Bootstrap JavaScript (å»¶è¿ŸåŠ è½½) -->
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>