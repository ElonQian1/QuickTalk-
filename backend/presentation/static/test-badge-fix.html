<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çº¢ç‚¹ä¿®å¤éªŒè¯é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-section { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .shop-card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 6px; position: relative; background: white; }
        .conversation-item { border: 1px solid #eee; padding: 15px; margin: 10px 0; border-radius: 6px; background: #f9f9f9; cursor: pointer; }
        .conversation-item:hover { background: #e9ecef; }
        .nav-item { display: inline-block; padding: 10px 15px; margin: 5px; background: #007bff; color: white; border-radius: 5px; cursor: pointer; position: relative; }
        .nav-item:hover { background: #0056b3; }
        .nav-item.active { background: #28a745; }
        .nav-badge { position: absolute; top: -8px; right: -8px; background: red; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; align-items: center; justify-content: center; }
        .nav-badge.hidden { display: none !important; }
        .test-button { padding: 8px 15px; margin: 5px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .test-button:hover { background: #545b62; }
        .log-output { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px; font-family: monospace; font-size: 12px; height: 200px; overflow-y: auto; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>ğŸ”´ çº¢ç‚¹ä¿®å¤éªŒè¯é¡µé¢</h1>
    
    <div class="test-section">
        <h2>1. åº—é“ºçŠ¶æ€çº¢ç‚¹æµ‹è¯•</h2>
        <div class="shop-card" data-shop-id="test-shop-001">
            <h3>æµ‹è¯•åº—é“º 001</h3>
            <div class="shop-status status-active">æœ‰å¯¹è¯</div>
            <p>è¿™ä¸ªshop-statusåº”è¯¥è¢«è½¬æ¢ä¸ºçº¢ç‚¹ç»„ä»¶</p>
        </div>
        
        <div class="shop-card" data-shop-id="test-shop-002">
            <h3>æµ‹è¯•åº—é“º 002</h3>
            <div class="shop-status status-active">ç­‰å¾…ä¸­</div>
            <p>è¿™ä¸ªshop-statusä¹Ÿåº”è¯¥è¢«è½¬æ¢ä¸ºçº¢ç‚¹ç»„ä»¶</p>
        </div>
        
        <button class="test-button" onclick="testShopBadges()">æ¨¡æ‹Ÿåº—é“ºæœªè¯»æ¶ˆæ¯</button>
        <button class="test-button" onclick="clearShopBadges()">æ¸…é™¤åº—é“ºçº¢ç‚¹</button>
    </div>
    
    <div class="test-section">
        <h2>2. å¯¼èˆªçº¢ç‚¹æµ‹è¯•</h2>
        <div class="nav-item tap-feedback" data-page="home">
            <span>é¦–é¡µ</span>
        </div>
        <div class="nav-item tap-feedback active" data-page="messages">
            <span>æ¶ˆæ¯</span>
            <div class="nav-badge" id="messagesBadge">3</div>
        </div>
        <div class="nav-item tap-feedback" data-page="shops">
            <span>åº—é“º</span>
        </div>
        
        <p><strong>æµ‹è¯•è¯´æ˜ï¼š</strong>ç‚¹å‡»"æ¶ˆæ¯"å¯¼èˆªé¡¹æ—¶ï¼Œçº¢ç‚¹åº”è¯¥ä¿æŒæ˜¾ç¤ºï¼Œåªæœ‰ç‚¹å‡»ä¸‹é¢çš„å¯¹è¯é¡¹æ—¶çº¢ç‚¹æ‰æ¶ˆå¤±ã€‚</p>
        
        <button class="test-button" onclick="showNavBadge()">æ˜¾ç¤ºå¯¼èˆªçº¢ç‚¹</button>
        <button class="test-button" onclick="clearNavBadge()">æ¸…é™¤å¯¼èˆªçº¢ç‚¹</button>
    </div>
    
    <div class="test-section">
        <h2>3. å¯¹è¯é¡¹æµ‹è¯•</h2>
        <div class="conversation-item" data-conversation-id="conv-001" data-shop-id="test-shop-001">
            <strong>å®¢æˆ· 001</strong> - æœ€åæ¶ˆæ¯ï¼šä½ å¥½ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ
            <small style="display: block; color: #666; margin-top: 5px;">ç‚¹å‡»è¿™é‡Œåº”è¯¥æ¸…é™¤ç›¸å…³çº¢ç‚¹</small>
        </div>
        
        <div class="conversation-item" data-conversation-id="conv-002" data-shop-id="test-shop-002">
            <strong>å®¢æˆ· 002</strong> - æœ€åæ¶ˆæ¯ï¼šè¯·é—®äº§å“ä»·æ ¼å¤šå°‘ï¼Ÿ
            <small style="display: block; color: #666; margin-top: 5px;">ç‚¹å‡»è¿™é‡Œä¹Ÿåº”è¯¥æ¸…é™¤ç›¸å…³çº¢ç‚¹</small>
        </div>
    </div>
    
    <div class="test-section">
        <h2>4. æ§åˆ¶å°æ—¥å¿—</h2>
        <div class="log-output" id="logOutput">ç­‰å¾…ç»„ä»¶åˆå§‹åŒ–...</div>
        <button class="test-button" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        <button class="test-button" onclick="checkComponents()">æ£€æŸ¥ç»„ä»¶çŠ¶æ€</button>
    </div>

    <!-- å¼•å…¥æˆ‘ä»¬çš„ç»„ä»¶ -->
    <script src="/static/js/application/unified-session-manager.js"></script>
    <script src="/static/js/ui/unread-badge-component.js"></script>
    <script src="/static/js/ui/shop-card-manager.js"></script>
    <script src="/static/js/ui/nav-badge-manager.js"></script>
    <script src="/static/js/application/unified-data-sync-manager.js"></script>
    <script src="/static/js/ui/badge-integration.js"></script>

    <script>
        // æ—¥å¿—è¾“å‡ºåˆ°é¡µé¢
        const logOutput = document.getElementById('logOutput');
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const originalConsoleError = console.error;
        
        function addToLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? 'red' : (type === 'warn' ? 'orange' : 'black');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logOutput.appendChild(logEntry);
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            addToLog(args.join(' '));
        };
        
        console.warn = function(...args) {
            originalConsoleWarn.apply(console, args);
            addToLog(args.join(' '), 'warn');
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };

        // åˆå§‹åŒ–ç»„ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–æµ‹è¯•ç»„ä»¶...');
            
            // æ¨¡æ‹Ÿ DataSyncManagerï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            if (!window.DataSyncManager) {
                window.DataSyncManager = class {
                    constructor() {
                        this.debug = console.log;
                    }
                    enableDebugMode() {
                        console.log('âœ… æ¨¡æ‹Ÿ DataSyncManager è°ƒè¯•æ¨¡å¼å·²å¼€å¯');
                    }
                };
                console.log('âœ… åˆ›å»ºæ¨¡æ‹Ÿ DataSyncManager');
            }
            
            // åˆ›å»º DataSyncManager å®ä¾‹
            window.testDataSyncManager = new DataSyncManager();
            window.testDataSyncManager.enableDebugMode();
            
            // åˆå§‹åŒ–åº—é“ºå¡ç‰‡ç®¡ç†å™¨
            ShopCardManager.quickInit({
                debug: true,
                selector: '.shop-card',
                delay: 1000
            }).then(manager => {
                window.shopCardManager = manager;
                console.log('âœ… åº—é“ºå¡ç‰‡ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ');
            }).catch(error => {
                console.error('âŒ åº—é“ºå¡ç‰‡ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥:', error);
            });
            
            // åˆå§‹åŒ–å¯¼èˆªçº¢ç‚¹ç®¡ç†å™¨
            try {
                window.navBadgeManager = NavBadgeManager.quickInit({
                    debug: true
                });
                console.log('âœ… å¯¼èˆªçº¢ç‚¹ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('âŒ å¯¼èˆªçº¢ç‚¹ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥:', error);
            }
        });

        // æµ‹è¯•å‡½æ•°
        function testShopBadges() {
            console.log('ğŸ§ª æµ‹è¯•åº—é“ºçº¢ç‚¹...');
            if (window.shopCardManager) {
                window.shopCardManager.updateShopBadge('test-shop-001', 5);
                window.shopCardManager.updateShopBadge('test-shop-002', 2);
            } else {
                console.warn('âš ï¸ åº—é“ºå¡ç‰‡ç®¡ç†å™¨æœªåˆå§‹åŒ–');
            }
        }
        
        function clearShopBadges() {
            console.log('ğŸ§¹ æ¸…é™¤åº—é“ºçº¢ç‚¹...');
            if (window.shopCardManager) {
                window.shopCardManager.updateShopBadge('test-shop-001', 0);
                window.shopCardManager.updateShopBadge('test-shop-002', 0);
            }
        }
        
        function showNavBadge() {
            console.log('ğŸ§ª æ˜¾ç¤ºå¯¼èˆªçº¢ç‚¹...');
            if (window.navBadgeManager) {
                window.navBadgeManager.updateNavBadge('messages', 3);
            } else {
                console.warn('âš ï¸ å¯¼èˆªçº¢ç‚¹ç®¡ç†å™¨æœªåˆå§‹åŒ–');
            }
        }
        
        function clearNavBadge() {
            console.log('ğŸ§¹ æ¸…é™¤å¯¼èˆªçº¢ç‚¹...');
            if (window.navBadgeManager) {
                window.navBadgeManager.updateNavBadge('messages', 0);
            }
        }
        
        function clearLog() {
            logOutput.innerHTML = '';
        }
        
        function checkComponents() {
            console.log('ğŸ” æ£€æŸ¥ç»„ä»¶çŠ¶æ€...');
            console.log('ShopCardManager:', window.shopCardManager ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½');
            console.log('NavBadgeManager:', window.navBadgeManager ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½');
            console.log('DataSyncManager:', window.DataSyncManager ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½');
            console.log('çº¢ç‚¹ç»„ä»¶æ•°é‡:', document.querySelectorAll('.unread-badge-component').length);
        }
    </script>
</body>
</html>