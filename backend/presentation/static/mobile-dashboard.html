<!--
    DEPRECATED COPY (只读 / 请勿编辑)
    统一来源文件已迁移至: backend/presentation/static/mobile-dashboard.html
    如需修改，请前往统一来源，避免再次分叉。
    此文件暂时保留以兼容旧路径访问与过渡。
-->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>QuickTalk 移动端管理后台</title>
    
    <!-- 全局基础样式（优先级最高，放在最前） -->
    <link rel="stylesheet" href="/static/css/reset.css">
    <link rel="stylesheet" href="/static/css/variables.css">
    
    <!-- 对话头像和红点样式模块 -->
    <link rel="stylesheet" href="/static/css/conversation-avatar.css">
    
    <!-- 聊天输入框增强样式模块 -->
    <link rel="stylesheet" href="/static/css/chat-input-enhanced.css">
    <!-- Toast 轻提示样式 -->
    <link rel="stylesheet" href="/static/css/toast.css">
    
    <!-- 移动端样式模块化引入 -->
    <link rel="stylesheet" href="/static/css/top-bar.css">
    <link rel="stylesheet" href="/static/css/mobile-layout.css">
    <link rel="stylesheet" href="/static/css/bottom-nav.css">
    <link rel="stylesheet" href="/static/css/shop-card-styles.css">
    <link rel="stylesheet" href="/static/css/home.css">
    <link rel="stylesheet" href="/static/css/modal-styles.css">
    <link rel="stylesheet" href="/static/css/form-styles.css">
    <link rel="stylesheet" href="/static/css/button-styles.css">
    <link rel="stylesheet" href="/static/css/employee-styles.css">
    <link rel="stylesheet" href="/static/css/payment-styles.css">
    <link rel="stylesheet" href="/static/css/settings-panel-styles.css">
    <link rel="stylesheet" href="/static/css/promotion-integration-styles.css">
    <link rel="stylesheet" href="/static/css/chat-interface-styles.css">
    <link rel="stylesheet" href="/static/css/state-styles.css">
    <link rel="stylesheet" href="/static/css/messages-list.css">
    <link rel="stylesheet" href="/static/css/shops-grid.css">
    
    <!-- UI 启动（usecases）：数据同步与店铺卡片管理器初始化 -->
    <!-- 移除重复引用，保留文末业务模块统一启动的 ui-bootstrap.js -->
    
    <!-- 原约2600行内联样式已拆分至以上11个外部CSS模块，提升可维护性 -->
    
    <!-- 按功能拆分：聊天与底部导航样式外置 -->
    <link rel="stylesheet" href="/static/css/messages-view.css">
    <link rel="stylesheet" href="/static/css/chat-view.css">
    <link rel="stylesheet" href="/static/css/pages/shops-page.css">
    <link rel="stylesheet" href="/static/css/workbench-styles.css">
    <link rel="stylesheet" href="/static/css/profile-styles.css">
<!-- 结束 head，开始 body -->
</head>
<body>
    <!-- 对话工具模块 -->
    <script src="/static/js/conversation-utils.js"></script>
    
    <!-- 聊天输入框增强模块 -->
    <script src="/static/js/chat-input-enhanced.js"></script>
    
    <!-- 局部组件加载器 -->
    <script src="/static/js/utils/partials-loader.js"></script>
    <!-- 网站图标（避免浏览器请求 /favicon.ico 404） -->
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <!-- 最小登录态拦截（外链） -->
    <script src="/static/js/login-guard.js"></script>
    <div class="app-container">
        <!-- 顶部状态栏 (组件外提) -->
        <div data-include="/static/components/top-bar.html"></div>

        <!-- 主内容区域 -->
        <div class="main-content">
            <div data-include="/static/components/main-content.html"></div>
        </div>

        <!-- 底部导航栏 (组件外提) -->
        <div data-include="/static/components/bottom-nav.html"></div>
    </div>

    <!-- 引入模块化JS文件 (必须在主脚本之前加载) -->
    <!-- 0. 全局工具库（最优先加载，避免重复代码） -->
    <script src="/static/js/utils/global-utils.js"></script>
    
    <!-- 1. 核心基础设施（必须最先加载） -->
    <script src="/static/js/core/module-registry.js"></script>
    <script src="/static/js/core/module-loader-compat.js"></script>
    <script src="/static/js/core/constants.js"></script>
    <script src="/static/js/core/logger.js"></script>
    <script src="/static/js/core/event-bus.js"></script>
    
    <!-- 2. 领域模型和服务 -->
    <script src="/static/js/domain/entities/conversation.js"></script>
    <script src="/static/js/domain/entities/message.js"></script>
    <script src="/static/js/domain/entities/shop.js"></script>
    <script src="/static/js/domain/services/session-service.js"></script>
    <script src="/static/js/domain/services/badge-service.js"></script>
    
    <!-- 3. 传统模块（向后兼容，待重构） -->
    <script src="/static/js/customer-numbering.js"></script>
    <script src="/static/js/debug-tools.js"></script>
    <script src="/static/js/dom-enhancer.js"></script>
    <script src="/static/js/realtime-data-manager.js"></script>
    <script src="/static/js/display-fixer.js"></script>
    
    <!-- 3.5. 新整合模块（统一会话和数据管理） -->
    <script src="/static/js/application/unified-session-manager.js"></script>
    
    <!-- 3.6. 统一用例聚合与表单门面（需在 usecases 之前加载，避免代理时序问题） -->
    <script src="/static/js/core/unified-usecases.js"></script>
    <script src="/static/js/core/unified-forms.js"></script>
    <!-- 3.7. 统一 WebSocket 门面（需在 ws-* 用例之前加载） -->
    <script src="/static/js/core/unified-websocket.js"></script>
    
    <!-- 4. 全局状态管理 -->
    <script src="/static/js/globals.js"></script>

    <script>
        // 应用初始化入口 - 所有功能已模块化至 /static/js/ 目录
        console.log('📱 QuickTalk Mobile Dashboard 已加载');
    </script>

    <!-- 模态框覆盖层（组件引入） -->
    <div data-include="/static/components/modals/modal-overlay.html"></div>
    <!-- 旧版支付弹窗逻辑（保持兼容） -->
    <script src="/static/js/modals/legacy-payment-modal.js"></script>

    <!-- 店铺管理模态框（组件引入） -->
    <div data-include="/static/components/modals/shop-management-modal.html"></div>
    <!-- 店铺动作入口（usecases） -->
    <script src="/static/js/usecases/shop-actions.js"></script>
    <!-- 付费开通（usecases） -->
    <script src="/static/js/usecases/payment-activation.js"></script>
    <!-- 工具：角色名映射（utils） -->
    <script src="/static/js/utils/roles.js"></script>
    <!-- 工具：HTTP/加载/通知/状态（utils） -->
    <script src="/static/js/utils/http-utils.js"></script>
    <script src="/static/js/utils/loading-utils.js"></script>
    <script src="/static/js/utils/notify-utils.js"></script>
    <script src="/static/js/utils/status-utils.js"></script>
    <script src="/static/js/utils/shop-utils.js"></script>
    <script src="/static/js/utils/user-utils.js"></script>
    <script src="/static/js/utils/format-utils.js"></script>
    <script src="/static/js/utils/modal-utils.js"></script>
    <script src="/static/js/utils/temporary-modal.js"></script>
    <!-- 通用工具：时间格式化、消息提示、店铺API（utils） -->
    <script src="/static/js/utils/common-utils.js"></script>
    <!-- UI Toast（覆盖 common-utils 中的 showToast 占位实现） -->
    <script src="/static/js/ui/toast.js"></script>
    <!-- 统一 UI 组件模块（合并 message-media/chat-header/conversation-item/shop-card） -->
    <script src="/static/js/core/unified-ui-components.js"></script>
    <!-- 空状态 UI 组件（ui） -->
    <script src="/static/js/ui/empty-states.js"></script>
    <script src="/static/js/ui/loading-states.js"></script>
    <script src="/static/js/ui/error-states.js"></script>
    <script src="/static/js/ui/message-bubble.js"></script>
    <!-- 正在输入 UI -->
    <script src="/static/js/ui/typing-indicator.js"></script>
    <!-- 图片灯箱与消息菜单 UI -->
    <script src="/static/js/ui/image-lightbox.js"></script>
    <script src="/static/js/ui/message-actions.js"></script>
    <!-- 键盘安全区 UI -->
    <script src="/static/js/ui/keyboard-safe-area.js"></script>
    <!-- 底部导航 UI -->
    <script src="/static/js/ui/bottom-nav.js"></script>
    <!-- 表单验证与反馈 UI -->
    <script src="/static/js/ui/form-validation.js"></script>
    <script src="/static/js/ui/form-feedback.js"></script>
    <!-- WebSocket 连接状态 UI -->
    <script src="/static/js/ui/connection-indicator.js"></script>
    <!-- 回到底部浮动按钮 UI -->
    <script src="/static/js/ui/scroll-to-bottom.js"></script>
    <!-- 消息历史分页 UI -->
    <script src="/static/js/ui/messages-pagination.js"></script>
    <!-- 会话列表头部 UI（统计/筛选/搜索） -->
    <script src="/static/js/ui/conversations-header.js"></script>
    <!-- 搜索高亮 UI（可选增强） -->
    <script src="/static/js/ui/search-highlight.js"></script>
    <!-- 分页与骨架屏 UI（可选增强） -->
    <script src="/static/js/ui/pagination.js"></script>
    <script src="/static/js/ui/skeleton-list.js"></script>
    <!-- 聊天输入相关 UI -->
    <script src="/static/js/ui/quick-replies.js"></script>
    <script src="/static/js/ui/composer-toolbar.js"></script>
    <!-- 店铺详情模态与标签页（modals） -->
    <script src="/static/js/modals/shop-details-modal.js"></script>
    <!-- 店铺审批操作（usecases） -->
    <script src="/static/js/usecases/shop-approval.js"></script>
    <!-- 店铺操作按钮渲染（usecases） -->
    <script src="/static/js/usecases/shop-actions-render.js"></script>
    <!-- 店铺交互处理（usecases） -->
    <script src="/static/js/usecases/shop-interaction.js"></script>
    <!-- 员工管理入口（usecases） -->
    <script src="/static/js/usecases/employees.js"></script>
    <!-- 员工列表加载与操作（usecases） -->
    <script src="/static/js/usecases/employees-list.js"></script>
    <!-- 店铺设置（usecases） -->
    <script src="/static/js/usecases/shop-settings.js"></script>
    <!-- 刷新API密钥（usecases） -->
    <script src="/static/js/usecases/shop-api-key.js"></script>
    <!-- 会话工具（usecases） -->
    <script src="/static/js/usecases/conversations-tools.js"></script>
    <!-- 通用工具模块（utils） - 在所有其他模块之前加载 -->
    <script src="/static/js/utils/auth-helper.js"></script>
    <script src="/static/js/utils/notify.js"></script>
    <script src="/static/js/utils/ui-states.js"></script>
    
    <!-- 消息页工具（usecases） -->
    <script src="/static/js/usecases/message-tools.js"></script>
    <!-- 对话基础动作（usecases） -->
    <script src="/static/js/usecases/conversation-actions.js"></script>
    <!-- 推广功能模块（usecases） -->
    <script src="/static/js/usecases/promotion.js"></script>
    <!-- 工作台/报表模块（usecases） -->
    <script src="/static/js/usecases/workbench.js"></script>
    <!-- 用户配置模块（usecases） -->
    <script src="/static/js/usecases/user-profile.js"></script>
    <!-- 超级管理员功能（usecases） -->
    <script src="/static/js/usecases/super-admin.js"></script>
    <!-- 页面导航模块（usecases） -->
    <script src="/static/js/usecases/page-navigation.js"></script>
    <!-- 仪表板模块（usecases） -->
    <script src="/static/js/usecases/dashboard.js"></script>
    <!-- 仪表板胶水（usecases） -->
    <script src="/static/js/usecases/dashboard-bootstrap.js"></script>
    <!-- 认证与会话模块（usecases） -->
    <script src="/static/js/usecases/auth-session.js"></script>
    <!-- 页面状态封装（usecases） -->
    <script src="/static/js/usecases/page-state.js"></script>
    <!-- 店铺列表加载模块（usecases） -->
    <script src="/static/js/usecases/shops-list.js"></script>
    <!-- 店铺管理模块（usecases） - 管理店铺操作和权限 -->
    <script src="/static/js/usecases/shop-management.js"></script>
    <!-- 店铺头部筛选/搜索控制器（usecases） -->
    <script src="/static/js/usecases/shops-header.js"></script>
    <!-- 店铺页胶水（usecases） -->
    <script src="/static/js/usecases/shops-bootstrap.js"></script>
    <!-- 未读数管理模块（usecases） - 店铺未读消息红点 -->
    <script src="/static/js/usecases/unread-badges.js"></script>
    <!-- WebSocket 事件桥（usecases） - 统一处理 onmessage 分发 -->
    <script src="/static/js/usecases/ws-event-bridge.js"></script>
    <!-- 页面边界与滚动控制（usecases） -->
    <script src="/static/js/usecases/page-guard.js"></script>
    <!-- 应用初始化模块（usecases） - DOMContentLoaded 启动流程、WebSocket、增强模块 -->
    <script src="/static/js/usecases/app-init.js"></script>
    
    <!-- 重构版业务管理器模块（usecases） - 拆分后的独立模块 -->
    <script src="/static/js/usecases/shops-manager-refactored.js"></script>
    <script src="/static/js/usecases/conversations-manager-refactored.js"></script>
    <script src="/static/js/usecases/messages-manager-refactored.js"></script>
    <script src="/static/js/usecases/media-handler.js"></script>

    <!-- 原版管理器（已暂停加载以避免重复实例化；保留文件以备回滚） -->
    <!-- <script src="/static/js/usecases/shops-manager.js"></script> -->
    <!-- <script src="/static/js/usecases/conversations-manager.js"></script> -->
    <!-- <script src="/static/js/usecases/messages-manager.js"></script> -->
    <!-- Legacy 名称兼容别名（需在重构版加载后、其它依赖使用前） -->
    <script src="/static/js/bootstrap/legacy-managers-alias.js"></script>

    <!-- 消息模块（usecases） - 管理三层结构消息系统 -->
    <!-- WebSocket 适配器（usecases） - 连接管理、重连、事件订阅 -->
    <script src="/static/js/usecases/message-ws-adapter.js"></script>
    <!-- WebSocket 事件路由（usecases） -->
    <script src="/static/js/usecases/ws-event-router.js"></script>
    <!-- 重构版消息模块（精简协调器） -->
    <script src="/static/js/usecases/message-module-refactored.js"></script>
    <!-- 原版消息模块（暂时移除避免与精简版双实例冲突，保留文件以便回滚） -->
    <!-- <script src="/static/js/usecases/message-module.js"></script> -->
    <!-- 消息视图切换胶水（usecases） -->
    <script src="/static/js/usecases/messages-views.js"></script>
    <!-- 消息页胶水（usecases） -->
    <script src="/static/js/usecases/messages-bootstrap.js"></script>
    <!-- 会话列表头部用例（绑定与统计） -->
    <script src="/static/js/usecases/conversations-header.js"></script>
    <!-- 消息头返回键胶水（usecases） -->
    <script src="/static/js/usecases/messages-header.js"></script>
    <!-- 消息页统一初始化入口（确保上面依赖加载后再执行） -->
    <script src="/static/js/usecases/messages-init.js"></script>
    <!-- 正在输入指示胶水（usecases） -->
    <script src="/static/js/usecases/messages-typing.js"></script>
    <!-- 附件上传入口胶水（usecases） -->
    <script src="/static/js/usecases/attachments-bootstrap.js"></script>
    <!-- 消息滚动加载胶水（usecases） -->
    <script src="/static/js/usecases/messages-scroll.js"></script>
    <!-- 消息历史分页用例 -->
    <script src="/static/js/usecases/messages-pagination.js"></script>
    <!-- 图片灯箱与消息菜单用例 -->
    <script src="/static/js/usecases/image-lightbox.js"></script>
    <script src="/static/js/usecases/message-actions.js"></script>
    <!-- 回到底部指示器（usecase） -->
    <script src="/static/js/usecases/chat-scroll-indicator.js"></script>
    <!-- 键盘安全区用例 -->
    <script src="/static/js/usecases/keyboard-safe-area.js"></script>
    <!-- 底部导航与列表状态用例 -->
    <script src="/static/js/usecases/bottom-nav.js"></script>
    <script src="/static/js/usecases/list-states.js"></script>
    <!-- 表单验证与提交用例 -->
    <script src="/static/js/usecases/form-validation.js"></script>
    <script src="/static/js/usecases/form-submit.js"></script>
    <!-- WebSocket 增强用例（重连/心跳/集成） -->
    <script src="/static/js/usecases/ws-reconnect.js"></script>
    <script src="/static/js/usecases/ws-heartbeat.js"></script>
    <script src="/static/js/usecases/ws-integration.js"></script>
    <!-- 首屏列表加载与联动（usecases） -->
    <script src="/static/js/usecases/list-bootstrap.js"></script>
    <!-- 会话分页（usecases） -->
    <script src="/static/js/usecases/conversations-pagination.js"></script>
    <!-- 聊天输入统一绑定（usecases） -->
    <script src="/static/js/usecases/chat-composer.js"></script>

    <!-- 编辑店铺模态框（组件引入） -->
    <div data-include="/static/components/modals/edit-shop-modal.html"></div>
    <script src="/static/js/modals/edit-shop-modal.js"></script>

    

    <!-- 集成代码模态框（组件引入） -->
    <div data-include="/static/components/modals/integration-code-modal.html"></div>
    <script src="/static/js/modals/integration-code-modal.js"></script>
    <!-- 在模态框内追加：服务器地址输入，用于生成集成代码的 serverUrl -->
    <script src="/static/js/modals/integration-code-modal-ui.js"></script>
    <!-- 注：移除了多余闭合标签，确保文档结构完整性 -->

    <!-- 创建店铺模态框（组件引入） -->
    <div data-include="/static/components/modals/create-shop-modal.html"></div>
    <script src="/static/js/modals/create-shop-modal.js"></script>

    <!-- 员工管理模态框（组件引入） -->
    <div data-include="/static/components/modals/employee-management-modal.html"></div>
    <script src="/static/js/modals/employee-management-modal.js"></script>

    <!-- 推广赚钱模态框（组件引入） -->
    <div data-include="/static/components/modals/promotion-modal.html"></div>
    <script src="/static/js/modals/promotion-modal.js"></script>

    <!-- 超级管理员面板模态框 -->
    <div data-include="/static/components/modals/admin-panel-modal.html"></div>
    <script src="/static/js/modals/admin-panel-modal.js"></script>

    <!-- 审核管理面板模态框（组件引入） -->
    <div data-include="/static/components/modals/review-panel-modal.html"></div>
    <script src="/static/js/modals/review-panel-modal.js"></script>

    <!-- 付费开通模态框（组件引入） -->
    <div data-include="/static/components/modals/activation-modal.html"></div>
    
    <!-- 用例模块 -->
    <script src="/static/js/usecases/activate-shop.js"></script>
    <script src="/static/js/modals/activation-modal.js"></script>

    <!-- 5. 数据管理模块（依赖基础模块） -->
    <script src="/static/js/application/unified-data-sync-manager.js"></script>
    
    <!-- 6. UI组件模块（依赖数据管理） -->
    <script src="/static/js/ui/unread-badge-component.js"></script>
    <script src="/static/js/ui/shop-status-badge-adapter.js"></script>
    <script src="/static/js/ui/nav-unread-aggregator.js"></script>
    <script src="/static/js/ui/conversation-badge-adapter.js"></script>
    <script src="/static/js/ui/shop-card-manager.js"></script>
    <script src="/static/js/ui/nav-badge-manager.js"></script>
    
    <!-- 7. 集成模块（依赖所有前面的模块） -->
    <script src="/static/js/ui/badge-integration.js"></script>
    
    <!-- 8. 用例模块（业务逻辑） -->
    <script src="/static/js/usecases/nav-bootstrap.js"></script>
    <script src="/static/js/usecases/composer-enhancements.js"></script>
    <script src="/static/js/usecases/profile-bootstrap.js"></script>
    <script src="/static/js/usecases/profile-manager.js"></script>
    <script src="/static/js/usecases/workbench-bootstrap.js"></script>
    <script src="/static/js/usecases/workbench-manager.js"></script>
    <script src="/static/js/usecases/mobile-interaction-enhancer.js"></script>
    <script src="/static/js/usecases/ui-bootstrap.js"></script>
    
    <!-- 9. 应用启动器（统一初始化） -->
    <script src="/static/js/bootstrap/app-bootstrap.js"></script>
    <!-- 9.1 消息模块单一启动器（小步快跑：确保只实例化精简协调器） -->
    <script src="/static/js/bootstrap/messages-micro-bootstrap.js"></script>
    
    <!-- 开发环境调试工具 -->
        <script src="/static/js/utils/module-debugger.js"></script>
    </body>
</html>