<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no"><title>QuickTalk ç§»åŠ¨ç«¯å®¢æœ (ç²¾ç®€)</title><style>body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f5f6fa;color:#222}header{background:#007aff;color:#fff;padding:12px 16px;font-weight:600;display:flex;justify-content:space-between;align-items:center}main{padding:12px}#convList,#chat{background:#fff;border-radius:14px;padding:12px;margin-bottom:14px;box-shadow:0 4px 10px rgba(0,0,0,.04)}h2{margin:0 0 8px;font-size:16px}ul{list-style:none;margin:0;padding:0;max-height:200px;overflow:auto}li{padding:6px 4px;border-bottom:1px solid #eee;font-size:14px;cursor:pointer}li:last-child{border-bottom:none}li.active{background:#eef5ff}#msgs{max-height:220px;overflow:auto;font-size:13px;border:1px solid #e5e5e5;border-radius:8px;padding:6px;background:#fafafa}#msgs .m{padding:4px 0;border-bottom:1px dashed #ddd}#msgs .m:last-child{border-bottom:none}.sender{font-weight:600;margin-right:4px}.send-box{display:flex;gap:6px;margin-top:8px}input,button{font:inherit}input[type=text]{flex:1;padding:8px 10px;border:1px solid #ccc;border-radius:8px}input[type=text]:focus{outline:none;border-color:#007aff;box-shadow:0 0 0 2px rgba(0,122,255,.15)}button{background:#007aff;color:#fff;border:none;border-radius:8px;padding:8px 14px;font-weight:600;cursor:pointer}button:disabled{opacity:.5;cursor:not-allowed}@media (max-width:480px){header{font-size:16px;padding:10px 12px}}</style></head><body><header><span>ğŸ’¬ ä¼šè¯</span><span id="wsState" style="font-size:12px;opacity:.85">è¿æ¥ä¸­...</span></header><main><section id="convList"><h2>ä¼šè¯åˆ—è¡¨</h2><ul id="convs"></ul></section><section id="chat"><h2 id="chatTitle">èŠå¤©</h2><div id="msgs"></div><div class="send-box"><input id="msgInput" placeholder="è¾“å…¥æ¶ˆæ¯..." type="text"/><button id="sendBtn" disabled>å‘é€</button></div></section></main><script>(function(){const api='/api';const wsUrl=(location.protocol==='https:'?'wss':'ws')+'://'+location.host+'/ws';let ws=null;let current=null;const convUl=document.getElementById('convs');const msgs=document.getElementById('msgs');const inp=document.getElementById('msgInput');const btn=document.getElementById('sendBtn');const wsState=document.getElementById('wsState');function log(m){console.log('[mobile-admin]',m);}async function loadConvs(){try{const r=await fetch(api+'/conversations');const j=await r.json();if(!j.success)return;convUl.innerHTML='';j.data.slice(0,50).forEach(c=>{const li=document.createElement('li');li.textContent=c.id.substring(0,10)+'  '+c.status;li.onclick=()=>{document.querySelectorAll('#convs li').forEach(n=>n.classList.remove('active'));li.classList.add('active');current=c.id;loadMsgs();};convUl.appendChild(li);});}catch(e){log('load conv error '+e);}}async function loadMsgs(){if(!current)return;msgs.innerHTML='åŠ è½½ä¸­...';try{const r=await fetch(api+`/conversations/${current}/messages?limit=50`);const j=await r.json();if(!j.success)return;msgs.innerHTML='';j.data.forEach(m=>append(m));btn.disabled=false;inp.focus();}catch(e){log('load msgs err '+e);}}function append(m){const d=document.createElement('div');d.className='m';d.innerHTML='<span class="sender">'+m.sender_type+':</span>'+m.content;msgs.appendChild(d);msgs.scrollTop=msgs.scrollHeight;}function connect(){wsState.textContent='è¿æ¥ä¸­...';ws=new WebSocket(wsUrl);ws.onopen=()=>{wsState.textContent='åœ¨çº¿';};ws.onclose=()=>{wsState.textContent='é‡è¿...';setTimeout(connect,1500);};ws.onerror=()=>{wsState.textContent='é”™è¯¯';};ws.onmessage=e=>{try{const evt=JSON.parse(e.data);if(evt.type && evt.type.startsWith('domain.event.message_')){if(evt.data?.message && evt.data.message.conversation_id===current){append({sender_type:evt.data.message.sender_type,content:evt.data.message.content});}}}catch(err){log(err);}};}btn.onclick=()=>{if(!current)return;const text=inp.value.trim();if(!text)return;fetch(api+`/conversations/${current}/messages`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({conversation_id:current,sender_type:'agent',sender_id:'agent_demo',content:text,message_type:'text'})}).then(r=>r.json()).then(j=>{if(j.success){inp.value='';}});};inp.addEventListener('keypress',e=>{if(e.key==='Enter')btn.click();});loadConvs();connect();setInterval(loadConvs,20000);})();</script></body></html>