# 店铺审核功能测试指南

## 功能概述

店铺审核功能确保所有新建店铺经过超级管理员审核后才能使用客服服务，提高平台质量。

## 审核流程

### 1. 店主提交店铺申请
- 登录管理后台：http://localhost:3030/admin-new
- 使用店主账号：`shop_owner` / `123456`
- 点击"创建店铺"按钮
- 填写表单：
  - 店铺名称：（必填）店铺的显示名称
  - 店铺域名：（必填）绑定的域名，如 example.com
  - 域名描述：（必填）业务内容说明，有助于审核
- 提交后店铺状态为"待审核"

### 2. 超级管理员审核
- 登录管理后台：http://localhost:3030/admin-new
- 使用超级管理员账号：`admin` / `admin123`
- 点击"审核管理"入口
- 查看待审核店铺列表，包含：
  - 店铺基本信息（名称、域名、描述）
  - 申请人信息
  - 提交时间
- 操作选项：
  - 审核通过：店铺状态变为"已通过"，可正常使用
  - 审核拒绝：店铺状态变为"已拒绝"，填写拒绝原因

### 3. 状态查看
- 店主可在店铺列表中查看审核状态：
  - 🟡 待审核：黄色标签，等待管理员审核
  - 🟢 已通过：绿色标签，可正常使用客服功能
  - 🔴 已拒绝：红色标签，审核未通过

## API接口

### 创建店铺 (店主权限)
```
POST /api/shops
Headers: X-Session-Id: {sessionId}
Body: {
    "name": "店铺名称",
    "domain": "example.com", 
    "description": "业务描述"
}
```

### 获取待审核店铺 (超级管理员)
```
GET /api/admin/pending-shops
Headers: X-Session-Id: {sessionId}
```

### 审核店铺 (超级管理员)
```
POST /api/admin/review-shop/{shopId}
Headers: X-Session-Id: {sessionId}
Body: {
    "action": "approve|reject",
    "note": "审核备注"
}
```

## 测试用例

### 测试1：店主创建店铺
1. 使用店主账号登录
2. 创建新店铺，填写完整信息
3. 验证店铺状态为"待审核"
4. 确认店铺在列表中显示描述信息

### 测试2：审核通过流程
1. 使用超级管理员账号登录
2. 查看待审核店铺列表
3. 选择一个店铺点击"通过"
4. 验证店铺状态变为"已通过"

### 测试3：审核拒绝流程
1. 使用超级管理员账号登录
2. 选择一个店铺点击"拒绝"
3. 填写拒绝原因
4. 验证店铺状态变为"已拒绝"

### 测试4：权限验证
1. 验证普通员工无法创建店铺
2. 验证只有超级管理员可以审核
3. 验证API权限控制正常

## 数据结构

### 店铺对象
```javascript
{
    id: 'shop_xxx',
    name: '店铺名称',
    domain: 'example.com',
    description: '业务描述',
    ownerId: 'user_xxx',
    status: 'pending|approved|rejected',
    approvalStatus: 'pending|approved|rejected',
    submittedAt: Date,
    reviewedAt: Date,
    reviewedBy: 'admin_id',
    reviewNote: '审核备注',
    createdAt: Date
}
```

## 前端页面

### 店铺列表展示
- 店铺卡片显示状态标签
- 域名描述显示在域名下方
- 状态颜色区分：
  - 待审核：黄底红字
  - 已通过：绿底白字
  - 已拒绝：红底白字

### 审核管理界面
- 待审核店铺列表
- 详细信息展示
- 一键通过/拒绝操作
- 审核历史记录

## 技术实现

### 后端
- `database.js`：店铺数据模型，审核方法
- `auth-routes.js`：审核API接口
- `server.js`：路由配置

### 前端
- `admin-new.html`：管理界面
- 表单验证：必填字段检查
- 状态显示：动态样式更新
- 权限控制：按角色显示功能

## 部署说明

1. 确保数据库支持新字段
2. 重启服务应用新代码
3. 测试所有审核流程
4. 更新用户手册

---

**测试完成标准：**
- ✅ 店主可以提交店铺申请
- ✅ 超级管理员可以审核店铺
- ✅ 状态显示和更新正常
- ✅ 权限控制有效
- ✅ API接口功能正常
