<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>清除缓存并测试客户编号</title>
</head>
<body>
    <h1>清除缓存并测试客户编号</h1>
    
    <button onclick="clearStorage()">清除所有localStorage</button>
    <button onclick="testNewAlgorithm()">测试新的客户编号算法</button>
    <button onclick="goToMobileDashboard()">前往移动端管理后台</button>
    
    <div id="output"></div>
    
    <script src="/js/customer-numbering.js"></script>
    <script>
        function clearStorage() {
            localStorage.clear();
            document.getElementById('output').innerHTML = '<p style="color: green;">✅ localStorage已清空</p>';
        }
        
        function testNewAlgorithm() {
            if (!window.CustomerNumbering) {
                document.getElementById('output').innerHTML = '<p style="color: red;">❌ CustomerNumbering模块未加载</p>';
                return;
            }
            
            // 清空后重新测试
            localStorage.clear();
            window.CustomerNumbering = new CustomerNumberingSystem();
            
            const testResults = [];
            
            // 测试第一个客户
            const customer1 = window.CustomerNumbering.generateCustomerNumber('customer_001_first');
            testResults.push(`第1个客户: ${customer1} (期望: 客户001)`);
            
            // 测试第二个客户
            const customer2 = window.CustomerNumbering.generateCustomerNumber('customer_002_second');
            testResults.push(`第2个客户: ${customer2} (期望: 客户002)`);
            
            // 测试重复访问
            const customer1Again = window.CustomerNumbering.generateCustomerNumber('customer_001_first');
            testResults.push(`第1个客户重复访问: ${customer1Again} (期望: 客户001)`);
            
            // 测试第767个客户
            for (let i = 3; i <= 766; i++) {
                window.CustomerNumbering.generateCustomerNumber(`customer_${String(i).padStart(3, '0')}_test`);
            }
            const customer767 = window.CustomerNumbering.generateCustomerNumber('customer_767_final');
            testResults.push(`第767个客户: ${customer767} (期望: 客户767)`);
            
            // 显示结果
            let output = '<h2>测试结果:</h2><ul>';
            testResults.forEach(result => {
                const isCorrect = (result.includes('客户001') && result.includes('期望: 客户001')) ||
                                 (result.includes('客户002') && result.includes('期望: 客户002')) ||
                                 (result.includes('客户767') && result.includes('期望: 客户767'));
                const color = isCorrect ? 'green' : 'red';
                const icon = isCorrect ? '✅' : '❌';
                output += `<li style="color: ${color};">${icon} ${result}</li>`;
            });
            output += '</ul>';
            output += `<p><strong>当前计数器: ${window.CustomerNumbering.counter}</strong></p>`;
            output += `<p><strong>活跃客户数: ${Object.keys(window.CustomerNumbering.customerMap).length}</strong></p>`;
            
            document.getElementById('output').innerHTML = output;
        }
        
        function goToMobileDashboard() {
            window.open('http://localhost:3030/mobile/dashboard', '_blank');
        }
    </script>
</body>
</html>