<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒ‰é’®æµ‹è¯•é¡µé¢</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-card { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .btn { padding: 10px 20px; margin: 5px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn:hover { background: #5a67d8; }
        .result { background: #e8f5e8; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffe8e8; }
    </style>
</head>
<body>
    <h1>QuickTalk ç§»åŠ¨ç«¯ç®¡ç† - æŒ‰é’®åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-card">
        <h2>APIæµ‹è¯•</h2>
        <button class="btn" onclick="testHealthCheck()">å¥åº·æ£€æŸ¥</button>
        <button class="btn" onclick="testShops()">è·å–åº—é“ºåˆ—è¡¨</button>
        <button class="btn" onclick="testConversations()">è·å–å¯¹è¯åˆ—è¡¨</button>
        <button class="btn" onclick="testLogin()">æ¨¡æ‹Ÿç™»å½•</button>
        <div id="apiResults"></div>
    </div>

    <div class="test-card">
        <h2>ç§»åŠ¨ç«¯é¡µé¢æµ‹è¯•</h2>
        <button class="btn" onclick="openMobileAdmin()">æ‰“å¼€ç§»åŠ¨ç«¯ç®¡ç†</button>
        <button class="btn" onclick="openAdminPanel()">æ‰“å¼€æ¡Œé¢ç®¡ç†</button>
        <button class="btn" onclick="openMainSite()">æ‰“å¼€ä¸»ç«™</button>
        <div id="pageResults"></div>
    </div>

    <script>
        function showResult(elementId, message, isError = false) {
            const div = document.getElementById(elementId);
            div.innerHTML = `<div class="result ${isError ? 'error' : ''}">${message}</div>` + div.innerHTML;
        }

        async function testHealthCheck() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                showResult('apiResults', `âœ… å¥åº·æ£€æŸ¥æˆåŠŸ: ${data.message} (v${data.data.version})`);
            } catch (error) {
                showResult('apiResults', `âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}`, true);
            }
        }

        async function testShops() {
            try {
                const response = await fetch('/api/shops');
                const data = await response.json();
                const shopCount = data.data?.length || 0;
                showResult('apiResults', `âœ… åº—é“ºåˆ—è¡¨è·å–æˆåŠŸ: å…±${shopCount}ä¸ªåº—é“º`);
            } catch (error) {
                showResult('apiResults', `âŒ åº—é“ºåˆ—è¡¨è·å–å¤±è´¥: ${error.message}`, true);
            }
        }

        async function testConversations() {
            try {
                const response = await fetch('/api/conversations');
                const data = await response.json();
                const convCount = data.data?.length || 0;
                showResult('apiResults', `âœ… å¯¹è¯åˆ—è¡¨è·å–æˆåŠŸ: å…±${convCount}ä¸ªå¯¹è¯`);
            } catch (error) {
                showResult('apiResults', `âŒ å¯¹è¯åˆ—è¡¨è·å–å¤±è´¥: ${error.message}`, true);
            }
        }

        async function testLogin() {
            showResult('apiResults', 'ğŸ“ æ¨¡æ‹Ÿç™»å½•æµ‹è¯•: ç”¨æˆ·adminç™»å½•æˆåŠŸ');
        }

        function openMobileAdmin() {
            window.open('/mobile/admin', '_blank');
            showResult('pageResults', 'ğŸ“± å·²æ‰“å¼€ç§»åŠ¨ç«¯ç®¡ç†é¡µé¢');
        }

        function openAdminPanel() {
            window.open('/admin', '_blank');
            showResult('pageResults', 'ğŸ–¥ï¸ å·²æ‰“å¼€æ¡Œé¢ç«¯ç®¡ç†é¡µé¢');
        }

        function openMainSite() {
            window.open('/', '_blank');
            showResult('pageResults', 'ğŸ  å·²æ‰“å¼€ä¸»ç«™é¡µé¢');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œå¥åº·æ£€æŸ¥
        window.onload = function() {
            testHealthCheck();
        }
    </script>
</body>
</html>