<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒé™æ§åˆ¶æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        .user-switch {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            margin: 5px;
            cursor: pointer;
        }
        .user-switch:hover {
            background: #5a6fd8;
        }
        .user-switch.active {
            background: #28a745;
        }
        .permission-result {
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
        }
        .permission-result.allowed {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .permission-result.denied {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .shop-management-demo {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .option-btn {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 14px;
            color: #495057;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            display: block;
            width: 100%;
            margin: 5px 0;
        }
        .option-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
            color: #667eea;
        }
        .option-btn.success {
            color: #28a745;
            border-color: #28a745;
        }
        .option-btn.warning {
            color: #ffc107;
            border-color: #ffc107;
        }
        .option-btn.primary {
            color: #667eea;
            border-color: #667eea;
        }
        .option-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f8f9fa;
        }
        .info-message {
            background: #e7f1ff;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            font-size: 14px;
        }
        .info-message.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .info-message.warning {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }
        .info-message.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-approved { background: #e7f1ff; color: #0c5aa6; }
        .status-active { background: #d4edda; color: #155724; }
        .status-inactive { background: #f8d7da; color: #721c24; }
        .status-rejected { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æƒé™æ§åˆ¶ç³»ç»Ÿæµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>ç”¨æˆ·èº«ä»½åˆ‡æ¢</h3>
            <p>å½“å‰ç”¨æˆ·: <span id="current-user">æœªè®¾ç½®</span></p>
            <button class="user-switch" onclick="switchUser('admin')">ç®¡ç†å‘˜ (admin)</button>
            <button class="user-switch" onclick="switchUser('shop_owner')">åº—ä¸» (shop_owner)</button>
            <button class="user-switch" onclick="switchUser('agent')">å®¢æœ (agent)</button>
        </div>

        <div class="test-section">
            <h3>æƒé™æ£€æŸ¥æµ‹è¯•</h3>
            <button onclick="testPermissions()">æµ‹è¯•æ‰€æœ‰æƒé™</button>
            <div id="permission-results"></div>
        </div>

        <div class="test-section">
            <h3>åº—é“ºç®¡ç†ç•Œé¢é¢„è§ˆ</h3>
            <p>é€‰æ‹©åº—é“ºçŠ¶æ€æŸ¥çœ‹ä¸åŒç”¨æˆ·çœ‹åˆ°çš„ç®¡ç†ç•Œé¢ï¼š</p>
            <select id="shop-status" onchange="updateShopDemo()">
                <option value="pending">å¾…å®¡æ ¸ (pending)</option>
                <option value="approved">å·²æ‰¹å‡† (approved)</option>
                <option value="active">æ´»è·ƒ (active)</option>
                <option value="inactive">éæ´»è·ƒ (inactive)</option>
                <option value="rejected">å·²æ‹’ç» (rejected)</option>
            </select>
            <div id="shop-demo"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
        let userData = { role: 'shop_owner', username: 'æµ‹è¯•ç”¨æˆ·' };
        
        // åˆ‡æ¢ç”¨æˆ·èº«ä»½
        function switchUser(role) {
            userData.role = role;
            document.getElementById('current-user').textContent = `${role} (${getRoleText(role)})`;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.user-switch').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // é‡æ–°æµ‹è¯•æƒé™
            testPermissions();
            updateShopDemo();
        }

        function getRoleText(role) {
            const roleMap = {
                'super_admin': 'è¶…çº§ç®¡ç†å‘˜',
                'admin': 'ç®¡ç†å‘˜',
                'shop_owner': 'åº—ä¸»',
                'agent': 'å®¢æœ'
            };
            return roleMap[role] || role;
        }

        // æƒé™æ£€æŸ¥å‡½æ•°ï¼ˆä»åŸç³»ç»Ÿå¤åˆ¶ï¼‰
        function isAdmin() {
            return userData && (userData.role === 'admin' || userData.role === 'super_admin');
        }

        function canManageShops() {
            return isAdmin();
        }

        function canApproveShops() {
            return isAdmin();
        }

        function hasActionPermission(action) {
            const userIsAdmin = isAdmin();
            
            const adminOnlyActions = ['approve', 'reject', 'activate', 'deactivate'];
            if (adminOnlyActions.includes(action) && !userIsAdmin) {
                return false;
            }
            
            const publicActions = ['edit', 'integration'];
            if (publicActions.includes(action)) {
                return true;
            }
            
            if (action === 'employees') {
                return userIsAdmin || (userData.role === 'shop_owner');
            }
            
            return true;
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'å¾…å®¡æ ¸',
                'approved': 'å·²æ‰¹å‡†',
                'active': 'æ´»è·ƒ',
                'rejected': 'å·²æ‹’ç»',
                'inactive': 'éæ´»è·ƒ'
            };
            return statusMap[status] || status;
        }

        // æµ‹è¯•æ‰€æœ‰æƒé™
        function testPermissions() {
            const actions = ['approve', 'reject', 'activate', 'deactivate', 'edit', 'employees', 'integration'];
            const resultsDiv = document.getElementById('permission-results');
            
            let html = '<h4>æƒé™æµ‹è¯•ç»“æœï¼š</h4>';
            actions.forEach(action => {
                const allowed = hasActionPermission(action);
                const resultClass = allowed ? 'allowed' : 'denied';
                const resultText = allowed ? 'âœ… å…è®¸' : 'âŒ æ‹’ç»';
                html += `<div class="permission-result ${resultClass}">
                    <strong>${action}</strong>: ${resultText}
                </div>`;
            });
            
            resultsDiv.innerHTML = html;
        }

        // ç”Ÿæˆåº—é“ºç®¡ç†æ¼”ç¤º
        function generateManagementDemo(shop) {
            const userIsAdmin = isAdmin();
            let optionsHtml = '<div class="management-options">';
            
            if (userIsAdmin) {
                optionsHtml += `
                    <div class="option-group">
                        <h4>ç®¡ç†å‘˜æ“ä½œ</h4>
                        <div class="admin-info">
                            <p><strong>åº—é“º:</strong> ${shop.name}</p>
                            <p><strong>çŠ¶æ€:</strong> <span class="status-badge status-${shop.status}">${getStatusText(shop.status)}</span></p>
                        </div>
                `;
                
                switch (shop.status) {
                    case 'pending':
                        optionsHtml += `
                            <button class="option-btn success" onclick="simulateAction('approve')">
                                âœ… æ‰¹å‡†åº—é“º
                            </button>
                            <button class="option-btn warning" onclick="simulateAction('reject')">
                                âŒ æ‹’ç»åº—é“º
                            </button>
                        `;
                        break;
                    case 'approved':
                        optionsHtml += `
                            <button class="option-btn primary" onclick="simulateAction('activate')">
                                ğŸš€ æ¿€æ´»åº—é“º
                            </button>
                            <button class="option-btn warning" onclick="simulateAction('reject')">
                                âŒ æ’¤é”€æ‰¹å‡†
                            </button>
                        `;
                        break;
                    case 'active':
                        optionsHtml += `
                            <button class="option-btn warning" onclick="simulateAction('deactivate')">
                                â¸ï¸ åœç”¨åº—é“º
                            </button>
                        `;
                        break;
                    case 'inactive':
                        optionsHtml += `
                            <button class="option-btn primary" onclick="simulateAction('activate')">
                                ğŸš€ é‡æ–°æ¿€æ´»
                            </button>
                        `;
                        break;
                    case 'rejected':
                        optionsHtml += `
                            <button class="option-btn success" onclick="simulateAction('approve')">
                                âœ… é‡æ–°æ‰¹å‡†
                            </button>
                        `;
                        break;
                }
                
                optionsHtml += `
                    </div>
                    <div class="option-group">
                        <h4>é€šç”¨ç®¡ç†</h4>
                        <button class="option-btn" onclick="simulateAction('employees')">
                            ğŸ‘¥ å‘˜å·¥ç®¡ç†
                        </button>
                        <button class="option-btn" onclick="simulateAction('edit')">
                            âœï¸ ç¼–è¾‘ä¿¡æ¯
                        </button>
                        <button class="option-btn" onclick="simulateAction('integration')">
                            ğŸ”— é›†æˆä»£ç 
                        </button>
                    </div>
                `;
            } else {
                optionsHtml += `
                    <div class="option-group">
                        <h4>åº—é“ºç®¡ç†</h4>
                        <div class="shop-owner-info">
                            <p><strong>åº—é“º:</strong> ${shop.name}</p>
                            <p><strong>çŠ¶æ€:</strong> <span class="status-badge status-${shop.status}">${getStatusText(shop.status)}</span></p>
                        </div>
                `;
                
                switch (shop.status) {
                    case 'pending':
                        optionsHtml += `
                            <div class="info-message">
                                <p>æ‚¨çš„åº—é“ºæ­£åœ¨å®¡æ ¸ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ã€‚</p>
                            </div>
                            <button class="option-btn" onclick="simulateAction('edit')">
                                âœï¸ ç¼–è¾‘ä¿¡æ¯
                            </button>
                        `;
                        break;
                    case 'approved':
                        optionsHtml += `
                            <div class="info-message success">
                                <p>æ­å–œï¼æ‚¨çš„åº—é“ºå·²é€šè¿‡å®¡æ ¸ï¼Œè¯·ä»˜è´¹æ¿€æ´»ã€‚</p>
                            </div>
                            <button class="option-btn primary" onclick="simulateAction('pay')">
                                ğŸ’³ ä»˜è´¹æ¿€æ´»
                            </button>
                        `;
                        break;
                    case 'active':
                        optionsHtml += `
                            <div class="info-message success">
                                <p>æ‚¨çš„åº—é“ºæ­£åœ¨æ­£å¸¸è¿è¥ä¸­ã€‚</p>
                            </div>
                            <button class="option-btn" onclick="simulateAction('employees')">
                                ğŸ‘¥ å‘˜å·¥ç®¡ç†
                            </button>
                            <button class="option-btn" onclick="simulateAction('integration')">
                                ğŸ”— é›†æˆä»£ç 
                            </button>
                        `;
                        break;
                    case 'inactive':
                        optionsHtml += `
                            <div class="info-message warning">
                                <p>æ‚¨çš„åº—é“ºå·²åœç”¨ï¼Œè¯·ç»­è´¹é‡æ–°æ¿€æ´»ã€‚</p>
                            </div>
                            <button class="option-btn primary" onclick="simulateAction('renew')">
                                ğŸ’³ ç»­è´¹æ¿€æ´»
                            </button>
                        `;
                        break;
                    case 'rejected':
                        optionsHtml += `
                            <div class="info-message error">
                                <p>å¾ˆæŠ±æ­‰ï¼Œæ‚¨çš„åº—é“ºå®¡æ ¸æœªé€šè¿‡ï¼Œè¯·ä¿®æ”¹åé‡æ–°ç”³è¯·ã€‚</p>
                            </div>
                            <button class="option-btn warning" onclick="simulateAction('edit')">
                                âœï¸ ä¿®æ”¹ä¿¡æ¯
                            </button>
                        `;
                        break;
                }
                
                optionsHtml += `
                        <button class="option-btn" onclick="simulateAction('view')">
                            ğŸ‘ï¸ æŸ¥çœ‹è¯¦æƒ…
                        </button>
                    </div>
                `;
            }
            
            optionsHtml += '</div>';
            return optionsHtml;
        }

        function updateShopDemo() {
            const status = document.getElementById('shop-status').value;
            const shop = {
                id: 1,
                name: 'æµ‹è¯•åº—é“º',
                status: status,
                domain: 'test.example.com',
                created_at: '2024-01-01'
            };
            
            const demoHtml = generateManagementDemo(shop);
            document.getElementById('shop-demo').innerHTML = `
                <div class="shop-management-demo">
                    <h4>å½“å‰ç”¨æˆ·è§’è‰²: ${getRoleText(userData.role)}</h4>
                    ${demoHtml}
                </div>
            `;
        }

        function simulateAction(action) {
            if (hasActionPermission(action)) {
                alert(`âœ… æƒé™å…è®¸ï¼šæ‰§è¡Œ ${action} æ“ä½œ`);
            } else {
                alert(`âŒ æƒé™æ‹’ç»ï¼šæ‚¨æ²¡æœ‰æƒé™æ‰§è¡Œ ${action} æ“ä½œ`);
            }
        }

        // åˆå§‹åŒ–
        switchUser('shop_owner');
        updateShopDemo();
    </script>
</body>
</html>