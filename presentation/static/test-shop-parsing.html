<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åº—é“ºæ•°æ®è§£ææµ‹è¯•</title>
</head>
<body>
    <h1>åº—é“ºæ•°æ®è§£ææµ‹è¯•</h1>
    <div id="output"></div>
    
    <script>
        // æ¨¡æ‹ŸAPIå“åº”æ ¼å¼æµ‹è¯•
        async function testDataParsing() {
            const output = document.getElementById('output');
            
            // æµ‹è¯•åœºæ™¯1ï¼šæ­£ç¡®çš„APIå“åº”æ ¼å¼
            console.log('ğŸ§ª æµ‹è¯•åœºæ™¯1ï¼šæ­£ç¡®çš„APIå“åº”æ ¼å¼');
            const apiResponse = {
                success: true,
                data: [
                    { id: '1', name: 'æµ‹è¯•åº—é“º1', domain: 'test1.com' },
                    { id: '2', name: 'æµ‹è¯•åº—é“º2', domain: 'test2.com' }
                ],
                message: 'Success'
            };
            
            let shopsData = null;
            
            // åº”ç”¨æˆ‘ä»¬çš„è§£æé€»è¾‘
            if (apiResponse.success && Array.isArray(apiResponse.data)) {
                console.log('âœ… æˆåŠŸè·å–åº—é“ºæ•°æ®:', apiResponse.data);
                shopsData = apiResponse.data;
            } else if (Array.isArray(apiResponse)) {
                console.log('âœ… ç›´æ¥æ•°ç»„æ ¼å¼åº—é“ºæ•°æ®:', apiResponse);
                shopsData = apiResponse;
            } else {
                console.warn('âš ï¸ æ„å¤–çš„å“åº”æ ¼å¼:', apiResponse);
                shopsData = [];
            }
            
            // ç¡®ä¿shopsDataæ˜¯æ•°ç»„
            if (!Array.isArray(shopsData)) {
                console.error('âŒ shopsDataä¸æ˜¯æ•°ç»„:', typeof shopsData, shopsData);
                shopsData = [];
            }
            
            console.log('ğŸ“Š æœ€ç»ˆçš„åº—é“ºæ•°æ®:', shopsData);
            
            // æµ‹è¯•mapåŠŸèƒ½
            try {
                const shopsHTML = shopsData.map(shop => `
                    <div>åº—é“º: ${shop.name} - ${shop.domain}</div>
                `).join('');
                
                output.innerHTML = `
                    <h2>âœ… æµ‹è¯•æˆåŠŸ</h2>
                    <p>æ•°æ®ç±»å‹: ${Array.isArray(shopsData) ? 'æ•°ç»„' : typeof shopsData}</p>
                    <p>æ•°æ®é•¿åº¦: ${shopsData.length}</p>
                    <h3>è§£æç»“æœ:</h3>
                    ${shopsHTML}
                `;
                console.log('âœ… mapæ“ä½œæˆåŠŸå®Œæˆ');
            } catch (error) {
                output.innerHTML = `
                    <h2>âŒ æµ‹è¯•å¤±è´¥</h2>
                    <p>é”™è¯¯: ${error.message}</p>
                    <p>æ•°æ®ç±»å‹: ${typeof shopsData}</p>
                    <p>æ•°æ®å€¼: ${JSON.stringify(shopsData)}</p>
                `;
                console.error('âŒ mapæ“ä½œå¤±è´¥:', error);
            }
            
            // æµ‹è¯•åœºæ™¯2ï¼šé”™è¯¯çš„æ•°æ®æ ¼å¼
            console.log('\nğŸ§ª æµ‹è¯•åœºæ™¯2ï¼šé”™è¯¯çš„æ•°æ®æ ¼å¼');
            const badResponse = {
                success: true,
                data: "not an array", // é”™è¯¯çš„æ•°æ®ç±»å‹
                message: 'Bad data'
            };
            
            let badShopsData = null;
            if (badResponse.success && Array.isArray(badResponse.data)) {
                badShopsData = badResponse.data;
            } else if (Array.isArray(badResponse)) {
                badShopsData = badResponse;
            } else {
                console.warn('âš ï¸ æ„å¤–çš„å“åº”æ ¼å¼:', badResponse);
                badShopsData = [];
            }
            
            if (!Array.isArray(badShopsData)) {
                console.error('âŒ badShopsDataä¸æ˜¯æ•°ç»„ï¼Œå·²ä¿®æ­£ä¸ºç©ºæ•°ç»„');
                badShopsData = [];
            }
            
            console.log('ğŸ“Š ä¿®æ­£åçš„æ•°æ®:', badShopsData);
            console.log('âœ… é”™è¯¯å¤„ç†æµ‹è¯•å®Œæˆ');
        }
        
        // é¡µé¢åŠ è½½åè¿è¡Œæµ‹è¯•
        window.onload = testDataParsing;
    </script>
</body>
</html>