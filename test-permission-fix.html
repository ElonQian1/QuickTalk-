<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒé™æ§åˆ¶æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-title {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .test-result {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #5a6fd8;
        }
        
        #console {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ”’ QuickTalk æƒé™æ§åˆ¶æµ‹è¯•</h1>
    
    <div class="test-card">
        <h2 class="test-title">æµ‹è¯•ç›®æ ‡</h2>
        <p>éªŒè¯æœªç™»å½•ç”¨æˆ·æ˜¯å¦è¿˜èƒ½çœ‹åˆ°æ¶ˆæ¯æœç´¢æ¨¡å—ï¼ˆä¿®å¤Bugï¼‰</p>
        <ul>
            <li>âœ… æœªç™»å½•çŠ¶æ€ï¼šä¸åº”è¯¥çœ‹åˆ°æœç´¢ç•Œé¢</li>
            <li>âœ… ç™»å½•åæœ‰æ•°æ®ï¼šåº”è¯¥çœ‹åˆ°æœç´¢ç•Œé¢</li>
            <li>âœ… ç™»å½•åæ— æ•°æ®ï¼šæš‚æ—¶ä¸æ˜¾ç¤ºæœç´¢ç•Œé¢</li>
        </ul>
    </div>

    <div class="test-card">
        <h2 class="test-title">å½“å‰çŠ¶æ€æ£€æµ‹</h2>
        <button onclick="checkLoginStatus()">æ£€æŸ¥ç™»å½•çŠ¶æ€</button>
        <button onclick="checkSearchInterface()">æ£€æŸ¥æœç´¢ç•Œé¢</button>
        <button onclick="testSearchInit()">æµ‹è¯•æœç´¢åˆå§‹åŒ–</button>
        <button onclick="clearStorage()">æ¸…é™¤æœ¬åœ°å­˜å‚¨</button>
        <div id="status-results"></div>
    </div>

    <div class="test-card">
        <h2 class="test-title">æµ‹è¯•æµç¨‹</h2>
        <button onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
        <div id="test-results"></div>
    </div>

    <div class="test-card">
        <h2 class="test-title">æ§åˆ¶å°æ—¥å¿—</h2>
        <button onclick="clearConsole()">æ¸…é™¤æ—¥å¿—</button>
        <div id="console"></div>
    </div>

    <script>
        // é‡å†™console.logæ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;
        
        const consoleDiv = document.getElementById('console');
        
        function addToConsole(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : type === 'warn' ? 'âš ï¸' : 'ğŸ“';
            consoleDiv.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            addToConsole('log', args.join(' '));
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            addToConsole('error', args.join(' '));
        };
        
        console.warn = function(...args) {
            originalConsoleWarn.apply(console, args);
            addToConsole('warn', args.join(' '));
        };

        function clearConsole() {
            consoleDiv.textContent = '';
        }

        function showResult(containerId, message, type = 'success') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            container.appendChild(div);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        function checkLoginStatus() {
            clearResults('status-results');
            
            const sessionId = localStorage.getItem('sessionId');
            const currentUser = localStorage.getItem('currentUser');
            
            if (sessionId) {
                showResult('status-results', `âœ… ç”¨æˆ·å·²ç™»å½• SessionId: ${sessionId}`, 'success');
                if (currentUser) {
                    const user = JSON.parse(currentUser);
                    showResult('status-results', `ğŸ‘¤ å½“å‰ç”¨æˆ·: ${user.username}`, 'success');
                }
            } else {
                showResult('status-results', 'ğŸ”’ ç”¨æˆ·æœªç™»å½•', 'warning');
            }
            
            console.log('æ£€æŸ¥ç™»å½•çŠ¶æ€å®Œæˆ');
        }

        function checkSearchInterface() {
            clearResults('status-results');
            
            const searchPanel = document.getElementById('searchPanel');
            const messageSearchManager = window.messageSearchManager;
            
            if (searchPanel) {
                showResult('status-results', 'âŒ å‘ç°æœç´¢ç•Œé¢å­˜åœ¨ï¼ˆå¯èƒ½æ˜¯Bugï¼‰', 'error');
            } else {
                showResult('status-results', 'âœ… æœç´¢ç•Œé¢ä¸å­˜åœ¨ï¼ˆæ­£ç¡®ï¼‰', 'success');
            }
            
            if (messageSearchManager) {
                showResult('status-results', 'âŒ æœç´¢ç®¡ç†å™¨å·²åˆå§‹åŒ–ï¼ˆå¯èƒ½æ˜¯Bugï¼‰', 'error');
            } else {
                showResult('status-results', 'âœ… æœç´¢ç®¡ç†å™¨æœªåˆå§‹åŒ–ï¼ˆæ­£ç¡®ï¼‰', 'success');
            }
            
            console.log('æ£€æŸ¥æœç´¢ç•Œé¢å®Œæˆ');
        }

        function testSearchInit() {
            clearResults('status-results');
            
            if (typeof initMessageSearch === 'function') {
                showResult('status-results', 'âœ… initMessageSearch å‡½æ•°å­˜åœ¨', 'success');
                
                const result = initMessageSearch();
                if (result) {
                    showResult('status-results', 'âš ï¸ æœç´¢åˆå§‹åŒ–æˆåŠŸ', 'warning');
                } else {
                    showResult('status-results', 'âœ… æœç´¢åˆå§‹åŒ–è¢«æ­£ç¡®é˜»æ­¢', 'success');
                }
            } else {
                showResult('status-results', 'âŒ initMessageSearch å‡½æ•°ä¸å­˜åœ¨', 'error');
            }
            
            console.log('æµ‹è¯•æœç´¢åˆå§‹åŒ–å®Œæˆ');
        }

        function clearStorage() {
            localStorage.clear();
            sessionStorage.clear();
            showResult('status-results', 'ğŸ§¹ æœ¬åœ°å­˜å‚¨å·²æ¸…é™¤', 'success');
            console.log('æœ¬åœ°å­˜å‚¨å·²æ¸…é™¤');
        }

        async function runFullTest() {
            clearResults('test-results');
            console.log('ğŸš€ å¼€å§‹è¿è¡Œå®Œæ•´æµ‹è¯•...');
            
            // æµ‹è¯•1ï¼šæ¸…é™¤å­˜å‚¨ï¼Œæ£€æŸ¥æœªç™»å½•çŠ¶æ€
            localStorage.clear();
            showResult('test-results', 'æµ‹è¯•1: æ¸…é™¤å­˜å‚¨ï¼Œæ¨¡æ‹Ÿæœªç™»å½•çŠ¶æ€', 'success');
            
            // ç­‰å¾…ä¸€ä¸‹è®©çŠ¶æ€æ›´æ–°
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const searchPanelBefore = document.getElementById('searchPanel');
            if (!searchPanelBefore && !window.messageSearchManager) {
                showResult('test-results', 'âœ… æœªç™»å½•çŠ¶æ€ä¸‹æœç´¢åŠŸèƒ½è¢«æ­£ç¡®é˜»æ­¢', 'success');
            } else {
                showResult('test-results', 'âŒ æœªç™»å½•çŠ¶æ€ä¸‹ä»ç„¶æœ‰æœç´¢åŠŸèƒ½', 'error');
            }
            
            // æµ‹è¯•2ï¼šæ¨¡æ‹Ÿç™»å½•
            showResult('test-results', 'æµ‹è¯•2: æ¨¡æ‹Ÿç”¨æˆ·ç™»å½•', 'success');
            localStorage.setItem('sessionId', 'test_session_' + Date.now());
            localStorage.setItem('currentUser', JSON.stringify({
                id: 1,
                username: 'test_user',
                role: 'shop_owner'
            }));
            
            // æµ‹è¯•3ï¼šå°è¯•åˆå§‹åŒ–æœç´¢åŠŸèƒ½
            showResult('test-results', 'æµ‹è¯•3: å°è¯•åˆå§‹åŒ–æœç´¢åŠŸèƒ½', 'success');
            if (typeof initMessageSearch === 'function') {
                const initResult = initMessageSearch();
                if (initResult) {
                    showResult('test-results', 'âœ… ç™»å½•åæœç´¢åŠŸèƒ½å¯ä»¥æ­£å¸¸åˆå§‹åŒ–', 'success');
                } else {
                    showResult('test-results', 'âš ï¸ ç™»å½•åæœç´¢åŠŸèƒ½åˆå§‹åŒ–å¤±è´¥ï¼ˆå¯èƒ½å› ä¸ºæ²¡æœ‰æ¶ˆæ¯å®¹å™¨ï¼‰', 'warning');
                }
            }
            
            console.log('âœ… å®Œæ•´æµ‹è¯•å®Œæˆ');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
        window.addEventListener('load', () => {
            console.log('ğŸ” æƒé™æ§åˆ¶æµ‹è¯•é¡µé¢å·²åŠ è½½');
            checkLoginStatus();
            checkSearchInterface();
        });
    </script>
</body>
</html>
