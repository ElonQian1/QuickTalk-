# ELonTalk 客服系统 - Ubuntu 生产环境配置（Staging 测试版本）
# 部署路径: /root/ubuntu-deploy-ready/
# 配置时间: 2025-10-17
# 用途: 首次部署测试，使用 Let's Encrypt Staging 环境

# ========== 数据库配置 ==========
DATABASE_URL=sqlite:/root/ubuntu-deploy-ready/customer_service.db

# 跳过数据库迁移（使用 Sea-ORM 自动迁移）
# DISABLE_MIGRATION=false

# ========== JWT 安全配置 ==========
JWT_SECRET=your-super-secret-jwt-key-please-change-in-production-env-2025

# ========== 服务器配置 ==========
SERVER_HOST=0.0.0.0
SERVER_PORT=8080

# ========== HTTPS/TLS 配置（强制启用）==========
TLS_MODE=https
TLS_PORT=8443
TLS_DOMAIN=elontalk.duckdns.org
TLS_CERT_PATH=certs/server.crt
TLS_KEY_PATH=certs/server.key

# ========== ACME 自动证书配置 ==========
# 启用 ACME 自动证书
ACME_ENABLED=true

# ⚠️ 首次部署：使用 staging 测试环境（避免撞限频）
ACME_DIRECTORY_URL=https://acme-staging-v02.api.letsencrypt.org/directory

# 管理员邮箱（Let's Encrypt 会发送过期通知到此邮箱）
ACME_EMAIL=siwmm@163.com

# 域名（逗号分隔，当前只配置一个域名）
ACME_DOMAINS=elontalk.duckdns.org

# 挑战类型（DNS-01：不需要 80 端口，通过 DNS TXT 记录验证）
ACME_CHALLENGE=dns-01

# 提前续期天数（证书有效期 90 天，提前 30 天自动续期）
RENEW_BEFORE_DAYS=30

# ========== DuckDNS 配置（DNS-01 验证必需）==========
DUCKDNS_DOMAIN=elontalk
DUCKDNS_TOKEN=400bfeb6-b2fe-40e8-8cb6-7d38a2b943ca

# ========== 日志配置 ==========
RUST_LOG=info,customer_service_backend=debug

# ========== 其他配置 ==========
RUST_BACKTRACE=1
TZ=Asia/Shanghai

# ========== 首次部署说明（Staging 测试）==========
# 
# 📋 当前环境：Let's Encrypt Staging
# 
# ✅ 特点：
# - 证书由 "Fake LE Intermediate" 签发
# - 浏览器会显示"不受信任"（这是正常的）
# - 无速率限制，可以反复测试
# - 验证整个 ACME 流程是否正常
# 
# 📊 预期流程（约 3-5 分钟）：
# - 🔐 ACME 证书检查启动
# - 📝 创建 ACME 账户（Staging）
# - 🌐 设置 DuckDNS TXT 记录
# - ⏳ 等待 DNS 传播（120秒 + 30秒）
# - ✅ 证书签发成功（Staging 证书）
# - 🚀 HTTPS 服务器启动在 0.0.0.0:8443
# 
# ✅ 成功标志：
# - 看到 "✅ ACME 证书签发成功！"
# - 看到 "🚀 HTTPS 服务器启动"
# - 访问 https://elontalk.duckdns.org:8443（会提示不安全，正常）
# 
# 🔄 测试成功后切换到生产：
# 1. 停止服务：Ctrl+C
# 2. 删除 staging 证书：rm -f certs/server.crt certs/server.key
# 3. 复制生产配置：cp .env.production .env
# 4. 重新启动：./customer-service-backend
