# ELonTalk 客服系统 - Ubuntu 生产环境配置（Production 正式版本）
# 部署路径: /root/ubuntu-deploy-ready/
# 配置时间: 2025-10-17
# 用途: 生产部署，使用 Let's Encrypt Production 环境

# ========== 数据库配置 ==========
DATABASE_URL=sqlite:/root/ubuntu-deploy-ready/customer_service.db

# 跳过数据库迁移（使用 Sea-ORM 自动迁移）
# DISABLE_MIGRATION=false

# ========== JWT 安全配置 ==========
JWT_SECRET=your-super-secret-jwt-key-please-change-in-production-env-2025

# ========== 服务器配置 ==========
SERVER_HOST=0.0.0.0
SERVER_PORT=8080

# ========== HTTPS/TLS 配置（强制启用）==========
TLS_MODE=https
TLS_PORT=8443
TLS_DOMAIN=elontalk.duckdns.org
TLS_CERT_PATH=certs/server.crt
TLS_KEY_PATH=certs/server.key

# ========== ACME 自动证书配置 ==========
# 启用 ACME 自动证书
ACME_ENABLED=true

# ✅ 生产环境：使用 Let's Encrypt Production（受信任的证书）
ACME_DIRECTORY_URL=https://acme-v02.api.letsencrypt.org/directory

# 管理员邮箱（Let's Encrypt 会发送过期通知到此邮箱）
ACME_EMAIL=siwmm@163.com

# 域名（逗号分隔，支持多个域名）
# 可选：添加更多域名，用逗号分隔
# 例如：ACME_DOMAINS=elontalk.duckdns.org,www.elontalk.duckdns.org,api.elontalk.duckdns.org
ACME_DOMAINS=elontalk.duckdns.org

# 挑战类型（DNS-01：不需要 80 端口，通过 DNS TXT 记录验证）
ACME_CHALLENGE=dns-01

# 提前续期天数（证书有效期 90 天，提前 30 天自动续期）
RENEW_BEFORE_DAYS=30

# ========== DuckDNS 配置（DNS-01 验证必需）==========
DUCKDNS_DOMAIN=elontalk
DUCKDNS_TOKEN=400bfeb6-b2fe-40e8-8cb6-7d38a2b943ca

# ========== 日志配置 ==========
RUST_LOG=info,customer_service_backend=debug

# ========== 其他配置 ==========
RUST_BACKTRACE=1
TZ=Asia/Shanghai

# ========== 生产环境部署说明 ==========
# 
# 📋 当前环境：Let's Encrypt Production
# 
# ✅ 特点：
# - 证书由 Let's Encrypt Authority 签发
# - 浏览器完全信任，显示绿色锁
# - 有速率限制：每周每域名最多 50 张证书
# - 证书有效期 90 天，自动续期
# 
# ⚠️ 使用前提：
# - 必须先用 staging 环境测试成功
# - 确保删除了 staging 证书文件
# - 确保 DuckDNS TXT 记录已清理
# 
# 📊 预期流程（约 3-5 分钟）：
# - 🔐 ACME 证书检查启动
# - 📝 创建 ACME 账户（Production）
# - 🌐 设置 DuckDNS TXT 记录
# - ⏳ 等待 DNS 传播（120秒 + 30秒）
# - ✅ 证书签发成功（受信任的证书）
# - 🚀 HTTPS 服务器启动在 0.0.0.0:8443
# 
# ✅ 成功标志：
# - 看到 "✅ ACME 证书签发成功！"
# - 看到 "🚀 HTTPS 服务器启动"
# - 访问 https://elontalk.duckdns.org:8443（显示绿色锁）
# 
# 🔄 自动续期：
# - 证书有效期 90 天
# - 提前 30 天自动续期
# - 每次启动都会检查证书状态
# - 无需人工干预
# 
# 🚀 长期运行建议：
# - 使用 systemd 管理服务
# - 配置开机自启动
# - 设置日志轮转
# - 定期备份数据库
