# ğŸš€ Ubuntu éƒ¨ç½²å°±ç»ªæŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´**: 2025-10-16 23:44  
**ç¼–è¯‘ç±»å‹**: Release  
**ç›®æ ‡å¹³å°**: x86_64-unknown-linux-musl (Ubuntu Linux)

---

## âœ… éƒ¨ç½²åŒ…å†…å®¹ç¡®è®¤

### æ ¸å¿ƒæ–‡ä»¶
- âœ… **customer-service-backend** (10.36 MB) - æ–°ç¼–è¯‘çš„ Rust åç«¯ï¼ˆå¸¦ ACME + HTTPSï¼‰
- âœ… **.env** - ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆå·²é…ç½® ACMEï¼‰
- âœ… **customer-service.service** - systemd æœåŠ¡æ–‡ä»¶
- âœ… **start.sh** - å¯åŠ¨è„šæœ¬

### ç›®å½•ç»“æ„
```
ubuntu-deploy-ready/
â”œâ”€â”€ customer-service-backend     # æ–°ç¼–è¯‘çš„äºŒè¿›åˆ¶ï¼ˆ10.36 MBï¼‰
â”œâ”€â”€ .env                         # ç¯å¢ƒé…ç½®
â”œâ”€â”€ customer-service.service     # systemd æœåŠ¡
â”œâ”€â”€ start.sh                     # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ certs/                       # è¯ä¹¦ç›®å½•ï¼ˆACME è‡ªåŠ¨å¡«å……ï¼‰
â””â”€â”€ static/                      # å‰ç«¯é™æ€æ–‡ä»¶
```

---

## ğŸ” ACME è‡ªåŠ¨è¯ä¹¦é…ç½®

### å½“å‰é…ç½®
```env
ACME_ENABLED=true
ACME_DIRECTORY_URL=https://acme-v02.api.letsencrypt.org/directory
ACME_EMAIL=siwmm@163.com
ACME_DOMAINS=elontalk.duckdns.org
ACME_CHALLENGE=dns-01
DUCKDNS_DOMAIN=elontalk
DUCKDNS_TOKEN=400bfeb6-b2fe-40e8-8cb6-7d38a2b943ca
```

### âš ï¸ é¦–æ¬¡éƒ¨ç½²å»ºè®®
**å¼ºçƒˆå»ºè®®é¦–æ¬¡ä½¿ç”¨ Staging ç¯å¢ƒæµ‹è¯•ï¼**

ä¿®æ”¹ `.env` ä¸­çš„ ACME_DIRECTORY_URLï¼š
```env
# æµ‹è¯•ç¯å¢ƒï¼ˆæ¨èé¦–æ¬¡ä½¿ç”¨ï¼‰
ACME_DIRECTORY_URL=https://acme-staging-v02.api.letsencrypt.org/directory
```

æµ‹è¯•æˆåŠŸåæ”¹ä¸ºç”Ÿäº§ç¯å¢ƒï¼š
```env
# ç”Ÿäº§ç¯å¢ƒï¼ˆæµ‹è¯•é€šè¿‡åå¯ç”¨ï¼‰
ACME_DIRECTORY_URL=https://acme-v02.api.letsencrypt.org/directory
```

---

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤

### 1. ä¸Šä¼ éƒ¨ç½²åŒ…
å°†æ•´ä¸ª `ubuntu-deploy-ready` ç›®å½•ä¸Šä¼ åˆ°æœåŠ¡å™¨ `/root/ubuntu-deploy-ready`

```bash
# åœ¨ Windows ä¸Šä½¿ç”¨ SCPï¼ˆPowerShellï¼‰
scp -r ubuntu-deploy-ready root@your-server-ip:/root/
```

### 2. è®¾ç½®æƒé™
```bash
ssh root@your-server-ip
cd /root/ubuntu-deploy-ready
chmod +x customer-service-backend
chmod +x start.sh
chmod +x *.sh
```

### 3. é¦–æ¬¡å¯åŠ¨ï¼ˆå‰å°æµ‹è¯•ï¼‰
```bash
# å…ˆåœ¨å‰å°è¿è¡Œæµ‹è¯• ACME åŠŸèƒ½
./customer-service-backend
```

è§‚å¯Ÿè¾“å‡ºï¼Œç¡®è®¤ï¼š
- âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
- âœ… ACME DNS-01 éªŒè¯é€šè¿‡
- âœ… è¯ä¹¦ç”ŸæˆæˆåŠŸï¼ˆä¿å­˜åˆ° certs/ ç›®å½•ï¼‰
- âœ… HTTPS æœåŠ¡å™¨å¯åŠ¨åœ¨ 8443 ç«¯å£

### 4. å®‰è£… systemd æœåŠ¡
```bash
# å¤åˆ¶æœåŠ¡æ–‡ä»¶
sudo cp customer-service.service /etc/systemd/system/

# é‡è½½ systemd
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start customer-service

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status customer-service

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable customer-service
```

### 5. éªŒè¯éƒ¨ç½²
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status customer-service

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u customer-service -f

# æµ‹è¯• HTTPS è¿æ¥
curl -v https://elontalk.duckdns.org:8443/api/health
```

---

## ğŸ” æ•…éšœæ’é™¤

### ACME ç›¸å…³é—®é¢˜

#### 1. DuckDNS API å¤±è´¥
**ç—‡çŠ¶**: `Failed to set TXT record`

**æ£€æŸ¥**:
```bash
# æ‰‹åŠ¨æµ‹è¯• DuckDNS API
curl "https://www.duckdns.org/update?domains=elontalk&token=400bfeb6-b2fe-40e8-8cb6-7d38a2b943ca&txt=test&verbose=true"
```

åº”è¯¥è¿”å› `OK`

#### 2. DNS ä¼ æ’­è¶…æ—¶
**ç—‡çŠ¶**: `DNS TXT record not propagated`

**è§£å†³**:
```env
# åœ¨ .env ä¸­å¢åŠ ç­‰å¾…æ—¶é—´ï¼ˆé»˜è®¤ 60 ç§’ï¼‰
DNS_PROPAGATION_WAIT=120
```

#### 3. Rate Limitï¼ˆé€Ÿç‡é™åˆ¶ï¼‰
**ç—‡çŠ¶**: `Too many failed authorization attempts`

**è§£å†³**: è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦å…ˆç”¨ staging ç¯å¢ƒæµ‹è¯•ï¼
- Staging ç¯å¢ƒæ— é€Ÿç‡é™åˆ¶
- æµ‹è¯•é€šè¿‡åå†åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ

### è¯ä¹¦éªŒè¯

```bash
# æŸ¥çœ‹ç”Ÿæˆçš„è¯ä¹¦
openssl x509 -in certs/server.crt -text -noout

# æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
openssl x509 -in certs/server.crt -noout -dates

# éªŒè¯è¯ä¹¦é“¾
openssl verify -CAfile certs/server.crt certs/server.crt
```

---

## ğŸ“Š ç¼–è¯‘ä¿¡æ¯

```
ç¼–è¯‘å‘½ä»¤: cargo zigbuild --release --target x86_64-unknown-linux-musl --features https
ç¼–è¯‘æ—¶é—´: 2025-10-16 23:44:32
äºŒè¿›åˆ¶å¤§å°: 10.36 MB
ç¼–è¯‘è­¦å‘Š: 41 ä¸ªï¼ˆä¸»è¦æ˜¯æœªä½¿ç”¨çš„å¯¼å…¥å’Œå˜é‡ï¼‰
ç¼–è¯‘é”™è¯¯: 0

å¯ç”¨çš„ Features:
- https: HTTPS/TLS æ”¯æŒ
- ACME: è‡ªåŠ¨è¯ä¹¦ç®¡ç†ï¼ˆinstant-acme 0.7ï¼‰
- DuckDNS: DNS-01 éªŒè¯æä¾›å•†
- x509-parser: è¯ä¹¦è¿‡æœŸæ£€æŸ¥
```

---

## ğŸ¯ å…³é”®æé†’

### âœ… å¿…åšäº‹é¡¹
1. é¦–æ¬¡éƒ¨ç½²ä½¿ç”¨ ACME Staging ç¯å¢ƒ
2. ç¡®ä¿ 8443 ç«¯å£åœ¨é˜²ç«å¢™ä¸­å¼€æ”¾
3. éªŒè¯ DuckDNS åŸŸåè§£ææ­£ç¡®
4. å‰å°è¿è¡Œæµ‹è¯•é€šè¿‡åå†é…ç½® systemd

### âš ï¸ æ³¨æ„äº‹é¡¹
1. Let's Encrypt ç”Ÿäº§ç¯å¢ƒæœ‰é€Ÿç‡é™åˆ¶ï¼š
   - æ¯ä¸ªåŸŸåæ¯å‘¨ 5 æ¬¡å¤±è´¥éªŒè¯
   - æ¯ä¸ªè´¦æˆ·æ¯å‘¨ 50 ä¸ªè¯ä¹¦
2. DNS-01 éªŒè¯éœ€è¦ç­‰å¾… DNS ä¼ æ’­ï¼ˆé»˜è®¤ 60 ç§’ï¼‰
3. è¯ä¹¦è‡ªåŠ¨ç»­æœŸï¼šåˆ°æœŸå‰ 30 å¤©è§¦å‘

### ğŸ”’ å®‰å…¨å»ºè®®
1. ä¿®æ”¹ JWT_SECRET ä¸ºå¼ºå¯†ç 
2. å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶
3. ç›‘æ§è¯ä¹¦è¿‡æœŸæ—¶é—´
4. å®šæœŸæ£€æŸ¥æœåŠ¡æ—¥å¿—

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æŸ¥çœ‹æ—¥å¿—
```bash
# å®æ—¶æ—¥å¿—
sudo journalctl -u customer-service -f

# æœ€è¿‘ 100 è¡Œ
sudo journalctl -u customer-service -n 100

# ä»Šå¤©çš„æ—¥å¿—
sudo journalctl -u customer-service --since today
```

### é‡å¯æœåŠ¡
```bash
sudo systemctl restart customer-service
```

### æŸ¥çœ‹ ACME è¯ä¹¦ä¿¡æ¯
```bash
cd /root/ubuntu-deploy-ready/certs
ls -lh
openssl x509 -in server.crt -text -noout | grep -E 'Subject:|Issuer:|Not After'
```

---

## âœ¨ éƒ¨ç½²å®Œæˆå

è®¿é—®ä½ çš„å®¢æœç³»ç»Ÿï¼š
- **ä¸»é¡µ**: https://elontalk.duckdns.org:8443
- **API å¥åº·æ£€æŸ¥**: https://elontalk.duckdns.org:8443/api/health
- **åå°ç™»å½•**: https://elontalk.duckdns.org:8443/login

**ğŸ‰ ç¥éƒ¨ç½²é¡ºåˆ©ï¼**
