# 部署包清单

**生成时间**: 2025年10月15日 21:46  
**总文件数**: 23 个  
**总大小**: 10.26 MB  
**编译架构**: x86_64-unknown-linux-musl (静态链接)  
**目标系统**: Ubuntu 24.04 LTS

---

## 📁 文件清单

### 根目录文件

| 文件名 | 类型 | 大小 | 说明 |
|--------|------|------|------|
| customer-service-backend | 二进制 | 8.4 MB | Rust 后端主程序（静态编译，支持 HTTPS） |
| .env | 配置 | 1 KB | 环境变量配置文件 |
| deploy.sh | 脚本 | 5 KB | 一键部署脚本 |
| start.sh | 脚本 | 1 KB | 手动启动脚本 |
| customer-service.service | 配置 | 0.3 KB | systemd 服务配置 |
| README.md | 文档 | 10 KB | 完整部署文档 |
| QUICKSTART.md | 文档 | 1 KB | 快速开始指南 |

### certs/ 目录（SSL 证书）

| 文件名 | 说明 |
|--------|------|
| server.crt | SSL 证书（当前为自签名证书） |
| server.key | SSL 私钥 |
| server.crt.backup | 证书备份 |
| server.key.backup | 私钥备份 |
| dev-server.crt | 开发证书（可选） |

### static/ 目录（前端静态文件）

| 文件/目录 | 大小 | 说明 |
|-----------|------|------|
| index.html | 3 KB | 前端入口页面 |
| asset-manifest.json | 0.5 KB | 资源清单 |
| manifest.json | 0.5 KB | PWA 配置 |
| favicon.ico | 15 KB | 网站图标（ICO） |
| favicon.svg | 2 KB | 网站图标（SVG） |
| logo192.svg | 4 KB | PWA Logo 192x192 |
| logo512.svg | 8 KB | PWA Logo 512x512 |
| robots.txt | 0.1 KB | 搜索引擎爬虫配置 |
| static/js/main.*.js | 450 KB | React 主应用（gzip 后 ~130KB） |
| static/js/main.*.js.map | 1.5 MB | Source Map（调试用） |
| static/js/main.*.js.LICENSE.txt | 2 KB | 第三方许可证 |

---

## ✅ 编译特性

### Rust 后端编译选项

```toml
# 编译命令
cargo zigbuild --release --target x86_64-unknown-linux-musl --features https

# 启用的特性
- rustls-tls: Rustls TLS 实现（避免 OpenSSL 依赖）
- https: HTTPS 支持（包含 axum-server）
- sqlite-bundled: 静态链接 SQLite
- sea-orm: 现代 ORM 支持

# 优化选项
- lto = true (链接时优化)
- codegen-units = 1 (单元代码生成)
- panic = "abort" (紧急中止模式)
- strip = true (移除调试符号)
- opt-level = 3 (最高优化级别)
```

### 前端构建配置

```json
# React 生产构建
- 代码压缩和混淆
- Tree Shaking (移除未使用代码)
- Code Splitting (按需加载)
- Gzip 压缩优化
```

---

## 🔒 安全检查

### 已配置的安全特性

- ✅ **HTTPS 强制模式**: 所有 HTTP 请求自动重定向到 HTTPS
- ✅ **JWT 认证**: 使用 JWT Token 进行用户认证
- ✅ **bcrypt 密码加密**: 密码使用 bcrypt 哈希存储
- ✅ **CORS 配置**: 跨域请求控制
- ✅ **防火墙规则**: 仅开放必要端口（22, 8080, 8443）
- ✅ **证书权限**: 私钥文件权限设置为 600

### 需要手动配置的安全项

- ⚠️ **更换 JWT_SECRET**: 修改 `.env` 中的 JWT 密钥
- ⚠️ **更换 SSL 证书**: 当前为自签名证书，建议使用 Let's Encrypt
- ⚠️ **数据库备份**: 建议配置自动备份策略

---

## 🚀 部署要求

### 系统要求

- **操作系统**: Ubuntu 24.04 LTS (或兼容发行版)
- **架构**: x86_64 (AMD64)
- **内存**: 最低 512MB，推荐 1GB+
- **磁盘**: 最低 500MB 可用空间
- **网络**: 需要开放 22, 8080, 8443 端口

### 无需安装的依赖

由于使用静态编译，无需在目标服务器上安装：
- ❌ Rust 工具链
- ❌ Node.js
- ❌ SQLite 系统库
- ❌ OpenSSL 系统库
- ❌ 额外的 Web 服务器（如 Nginx）

### 运行时依赖（系统自带）

- ✅ Linux 内核 (4.0+)
- ✅ glibc (或 musl libc)
- ✅ systemd (服务管理)

---

## 📊 性能指标

### 后端性能

- **启动时间**: < 1 秒
- **内存占用**: 20-50 MB（空闲状态）
- **响应时间**: < 100ms（API 请求）
- **并发连接**: 支持 1000+ WebSocket 连接
- **静态文件**: 直接由 Rust 服务器提供（零拷贝）

### 前端性能

- **首次加载**: gzip 压缩后 ~130KB
- **加载时间**: < 2 秒（4G 网络）
- **渲染性能**: React 18 并发模式
- **PWA 支持**: 支持离线缓存

---

## 🔄 版本信息

### 核心依赖版本

```toml
[后端]
Rust Edition: 2021
Tokio: 1.38
Axum: 0.7
Sea-ORM: 0.12
SQLx: 0.7
Rustls: 0.21
bcrypt: 0.15

[前端]
React: 18.x
TypeScript: 4.x
Zustand: 4.x
Styled Components: 6.x
```

---

## 📝 部署后验证

### 验证清单

```bash
# 1. 检查文件完整性
cd /root/ubuntu-deploy-ready
ls -la customer-service-backend  # 应该看到 8.4MB 文件
ls -la certs/server.crt certs/server.key  # 证书文件存在
ls -la static/index.html  # 前端文件存在

# 2. 验证可执行权限
./customer-service-backend --version  # 应该输出版本信息

# 3. 测试手动启动
./customer-service-backend  # 应该正常启动并监听端口

# 4. 验证端口监听
netstat -tlnp | grep ':8443'  # HTTPS 端口
netstat -tlnp | grep ':8080'  # HTTP 端口

# 5. 测试 HTTP 请求
curl -k https://localhost:8443  # 应该返回 HTML 内容
```

---

## 🆘 常见问题

### Q1: 提示 "permission denied"

```bash
# 解决：赋予执行权限
chmod +x customer-service-backend
```

### Q2: 端口被占用

```bash
# 解决：查找并终止占用进程
lsof -i :8443
kill -9 <PID>
```

### Q3: 证书错误

```bash
# 解决：检查证书文件权限
chmod 600 certs/server.key
chmod 644 certs/server.crt
```

### Q4: 数据库初始化失败

```bash
# 解决：检查目录权限
chmod 755 /root/ubuntu-deploy-ready
touch customer_service.db
chmod 644 customer_service.db
```

---

## 📞 技术支持

如有问题，请查看：
1. **完整文档**: `README.md`
2. **快速指南**: `QUICKSTART.md`
3. **日志输出**: `journalctl -u customer-service -f`

---

**生成工具**: Rust cargo-zigbuild + React CRA  
**编译平台**: Windows 11  
**目标平台**: Ubuntu 24.04 LTS (x86_64)  
**编译时间**: 约 12 秒（Rust） + 60 秒（React）
