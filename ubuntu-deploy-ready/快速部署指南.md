# Ubuntu 部署包使用说明

## 📦 包含内容

### 核心文件
- `customer-service-backend` - Linux可执行文件 (8.4MB, HTTPS支持)
- `static/` - React前端静态文件 
- `certs/` - SSL证书文件
- `.env` - HTTPS生产环境配置
- `.env.http` - HTTP测试配置

### 启动脚本
- `start.sh` - 智能启动脚本 (自动检测证书)
- `customer-service.service` - systemd服务配置

## 🚀 部署步骤

### 1. 上传到服务器
```bash
# 将整个 ubuntu-deploy-ready 文件夹上传到服务器的 /root/ 目录
scp -r ubuntu-deploy-ready root@43.139.82.12:/root/
```

### 2. 设置权限并启动
```bash
# SSH登录到Ubuntu服务器
ssh root@43.139.82.12

# 进入部署目录
cd /root/ubuntu-deploy-ready

# 添加执行权限
chmod +x customer-service-backend start.sh

# 启动服务 (自动检测HTTPS证书)
./start.sh
```

### 3. 验证访问
- **HTTPS**: https://43.139.82.12:8443 (如果有有效证书)
- **HTTP**: http://43.139.82.12:8080 (备用方案)
- **域名HTTPS**: https://elontalk.duckdns.org:8443
- **域名HTTP**: http://elontalk.duckdns.org:8080

## ⚙️ 配置说明

### HTTPS模式 (.env)
- 默认启用HTTPS
- 使用端口8443
- 需要有效SSL证书
- 自动HTTP重定向

### HTTP模式 (.env.http)
```bash
# 如果证书有问题，可以使用HTTP模式
cp .env.http .env
./start.sh
```

## 🔧 Sea-ORM数据库

### 自动特性
- ✅ 自动创建数据库文件
- ✅ 自动执行数据库迁移
- ✅ 自动验证表结构
- ✅ 备份已有数据

### 数据库文件
- `customer_service.db` - SQLite数据库文件 (自动创建)

## 🛠️ 系统服务 (可选)

### 配置systemd自动启动
```bash
# 复制服务文件
cp customer-service.service /etc/systemd/system/

# 重新加载systemd
systemctl daemon-reload

# 启用自动启动
systemctl enable customer-service

# 启动服务
systemctl start customer-service

# 查看状态
systemctl status customer-service
```

## 🔍 故障排除

### 端口检查
```bash
# 检查端口是否被占用
netstat -tlnp | grep -E ':(8080|8443)'

# 检查防火墙
ufw status
ufw allow 8080/tcp
ufw allow 8443/tcp
```

### 日志查看
```bash
# 查看服务日志 (如果用systemd启动)
journalctl -u customer-service -f

# 查看直接启动的日志
./customer-service-backend
```

### 证书问题
```bash
# 检查证书文件
ls -la certs/
openssl x509 -in certs/server.crt -text -noout

# 如果证书有问题，切换到HTTP模式
cp .env.http .env
./start.sh
```

## 📊 性能信息

- **二进制文件**: 8.4MB (静态链接，零依赖)
- **内存使用**: ~20MB
- **启动时间**: <2秒  
- **并发连接**: 支持1000+
- **TLS实现**: Rustls (纯Rust，内存安全)

## 🌐 服务器信息

- **服务器IP**: 43.139.82.12
- **域名**: elontalk.duckdns.org
- **DuckDNS Token**: 400bfeb6-b2fe-40e8-8cb6-7d38a2b943ca
- **管理员邮箱**: siwmm@163.com
- **部署路径**: /root/ubuntu-deploy-ready/

---
**编译时间**: 2025年10月15日 14:38  
**编译工具**: Rust + Zig (交叉编译)  
**目标平台**: Ubuntu 24.04 LTS x86_64