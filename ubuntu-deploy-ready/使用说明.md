# Ubuntu æœåŠ¡å™¨å¯åŠ¨è¯´æ˜

## âŒ é—®é¢˜è¯Šæ–­ï¼šæœåŠ¡å™¨å¯åŠ¨åç«‹å³ Terminated

### å¯èƒ½åŸå› 

1. **SSH ä¼šè¯æ–­å¼€** - å¦‚æœç›´æ¥åœ¨ SSH ä¸­è¿è¡Œ `./customer-service-backend`ï¼ŒSSH æ–­å¼€æ—¶ç¨‹åºä¼šè¢«ç»ˆæ­¢
2. **ç«¯å£å·²è¢«å ç”¨** - è™½ç„¶ä»£ç ä¼šå°è¯•ç»ˆæ­¢æ—§è¿›ç¨‹ï¼Œä½†å¯èƒ½å­˜åœ¨ç«äº‰æ¡ä»¶
3. **æƒé™é—®é¢˜** - æ–‡ä»¶æˆ–ç›®å½•æƒé™ä¸æ­£ç¡®
4. **ç¨‹åº Bug** - ç¨‹åºå†…éƒ¨é”™è¯¯å¯¼è‡´ç«‹å³é€€å‡º

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: ä½¿ç”¨ systemd æœåŠ¡ï¼ˆæ¨èï¼‰

```bash
# ç¡®ä¿æœåŠ¡é…ç½®æ­£ç¡®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start customer-service

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status customer-service

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u customer-service -f
```

### æ–¹æ¡ˆ 2: ä½¿ç”¨ debug å¯åŠ¨è„šæœ¬

```bash
cd /root/ubuntu-deploy-ready

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x debug-start.sh

# è¿è¡Œè°ƒè¯•å¯åŠ¨è„šæœ¬
./debug-start.sh

# æŸ¥çœ‹æ—¥å¿—
tail -f server.log
```

### æ–¹æ¡ˆ 3: ä½¿ç”¨ screen/tmuxï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰

```bash
# å®‰è£… screen
apt-get install screen

# åˆ›å»ºæ–°ä¼šè¯
screen -S customer-service

# å¯åŠ¨æœåŠ¡å™¨
cd /root/ubuntu-deploy-ready
./customer-service-backend

# åˆ†ç¦»ä¼šè¯: æŒ‰ Ctrl+A, ç„¶åæŒ‰ D
# é‡æ–°è¿æ¥: screen -r customer-service
```

### æ–¹æ¡ˆ 4: æ‰‹åŠ¨åå°è¿è¡Œ

```bash
cd /root/ubuntu-deploy-ready

# åå°è¿è¡Œå¹¶è¾“å‡ºåˆ°æ—¥å¿—
nohup ./customer-service-backend > server.log 2>&1 &

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep customer-service

# æŸ¥çœ‹æ—¥å¿—
tail -f server.log
```

## ğŸ” è°ƒè¯•æ­¥éª¤

å¦‚æœæœåŠ¡å™¨ä»ç„¶ Terminatedï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ£€æŸ¥ï¼š

### 1. æ£€æŸ¥ç«¯å£å ç”¨

```bash
# æ£€æŸ¥ 8443 ç«¯å£
lsof -ti:8443

# æ£€æŸ¥ 8080 ç«¯å£  
lsof -ti:8080

# å¦‚æœæœ‰è¿›ç¨‹å ç”¨ï¼Œæ‰‹åŠ¨ç»ˆæ­¢
kill -9 $(lsof -ti:8443)
kill -9 $(lsof -ti:8080)
```

### 2. æ£€æŸ¥æ–‡ä»¶æƒé™

```bash
cd /root/ubuntu-deploy-ready

# æ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶
ls -l customer-service-backend

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x customer-service-backend

# æ£€æŸ¥è¯ä¹¦æ–‡ä»¶
ls -l certs/
```

### 3. æ£€æŸ¥ç¯å¢ƒå˜é‡

```bash
cat .env

# ç¡®ä¿åŒ…å«:
# TLS_MODE=https
# DATABASE_URL=sqlite:customer_service.db
# ACME_ENABLED=true
```

### 4. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
export RUST_LOG=debug
export RUST_BACKTRACE=full

# è¿è¡Œç¨‹åº
./customer-service-backend 2>&1 | tee detailed.log
```

### 5. æ£€æŸ¥ç³»ç»Ÿèµ„æº

```bash
# æ£€æŸ¥å†…å­˜
free -h

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ£€æŸ¥è¿›ç¨‹æ•°é™åˆ¶
ulimit -a
```

## ğŸ“‹ systemd æœåŠ¡é…ç½®

ç¡®ä¿ `/root/ubuntu-deploy-ready/customer-service.service` åŒ…å«æ­£ç¡®é…ç½®:

```ini
[Unit]
Description=ELonTalk Customer Service System (HTTPS)
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/root/ubuntu-deploy-ready
ExecStart=/root/ubuntu-deploy-ready/customer-service-backend
Environment=DATABASE_URL=sqlite:customer_service.db
Environment=RUST_LOG=info
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

å®‰è£…æœåŠ¡:

```bash
# å¤åˆ¶æœåŠ¡æ–‡ä»¶
cp /root/ubuntu-deploy-ready/customer-service.service /etc/systemd/system/

# é‡æ–°åŠ è½½ systemd
systemctl daemon-reload

# å¯ç”¨å¼€æœºè‡ªå¯
systemctl enable customer-service

# å¯åŠ¨æœåŠ¡
systemctl start customer-service

# æŸ¥çœ‹çŠ¶æ€
systemctl status customer-service
```

## ğŸ†˜ å¦‚æœæ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥

1. **é‡æ–°ç¼–è¯‘**:
   ```bash
   cd /root/ubuntu-deploy-ready/backend
   cargo clean
   cargo build --release --features https
   cp target/release/customer-service-backend ..
   ```

2. **æ£€æŸ¥ç¨‹åºç‰ˆæœ¬**:
   ```bash
   ./customer-service-backend --version
   ldd ./customer-service-backend  # æ£€æŸ¥ä¾èµ–
   ```

3. **ä½¿ç”¨ strace è¯Šæ–­**:
   ```bash
   strace -f ./customer-service-backend 2>&1 | tee strace.log
   ```

4. **è”ç³»æŠ€æœ¯æ”¯æŒ**ï¼Œæä¾›:
   - `server.log` æ—¥å¿—æ–‡ä»¶
   - `strace.log` è¿½è¸ªæ–‡ä»¶
   - `systemctl status customer-service` è¾“å‡º
   - `journalctl -u customer-service -n 100` è¾“å‡º
