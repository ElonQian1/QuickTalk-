# Ubuntu 部署包说明 - v2.0

## 📦 部署包内容

此部署包包含 ELonTalk 客服系统的完整生产环境文件：

### 🔧 核心文件
- `customer-service-backend` - 交叉编译的 Rust 二进制文件 (11.1MB)
- `.env` - 生产环境配置（HTTPS + ACME 自动证书）
- `customer_service.db` - 真实 SQLite 数据库文件

### 📂 目录结构
- `static/` - React 前端构建文件
- `certs/` - SSL 证书存储目录（会自动生成）
- `*.sh` - 启动和部署脚本

### 🚀 部署脚本
- `start.sh` - 标准启动脚本
- `智能更新部署.sh` - ⭐ **推荐使用**，保护现有配置

## ⚠️ 重要提示

### 🔐 配置保护问题
**问题**: 每次上传新的部署包都会覆盖服务器上的配置和证书  
**解决**: 使用智能部署脚本

### 📋 智能部署功能
- ✅ 自动备份现有的 `.env` 配置
- ✅ 自动备份 SSL 证书和私钥
- ✅ 自动备份数据库文件
- ✅ 更新程序文件和前端代码
- ✅ 智能恢复生产环境设置
- ✅ 保持服务连续性

## 🎯 部署步骤

### 1. 上传到服务器
```bash
scp -r ubuntu-deploy-ready/ root@43.139.82.12:/root/
```

### 2. 智能部署（推荐）
```bash
cd /root/ubuntu-deploy-ready
chmod +x 智能更新部署.sh
./智能更新部署.sh
```

### 3. 验证部署
```bash
# 检查服务状态
systemctl status customer-service

# 测试访问
curl -I https://elontalk.duckdns.org:8443
```

## 🔧 配置说明

### ACME 证书配置
```bash
ACME_ENABLED=true
ACME_DIRECTORY_URL=https://acme-v02.api.letsencrypt.org/directory  # 生产环境
```

### 数据库路径
```bash
DATABASE_URL=sqlite:/root/ubuntu-deploy-ready/customer_service.db
```

### HTTPS 设置
```bash
TLS_MODE=https
TLS_PORT=8443
TLS_DOMAIN=elontalk.duckdns.org
```

## 📊 部署包版本信息

- **编译时间**: 2025年10月17日 12:52
- **后端版本**: Rust HTTPS + ACME 完整版
- **前端版本**: React 生产构建
- **数据库**: 与服务器同步的真实数据
- **证书**: 支持 Let's Encrypt 自动管理

## 🆘 故障排除

### 问题1: 证书申请失败
**解决**: 检查 DuckDNS Token 和域名配置

### 问题2: 配置被覆盖
**解决**: 使用智能部署脚本而不是直接覆盖文件

### 问题3: 服务无法启动
**解决**: 检查文件权限和端口占用

### 问题4: 浏览器显示"不安全"
**解决**: 确认使用生产环境 ACME_DIRECTORY_URL

## 🎉 预期结果

部署成功后，系统将在以下地址提供服务：

- **主要访问**: https://elontalk.duckdns.org:8443 🔒
- **备用访问**: http://43.139.82.12:8080
- **管理后台**: 自动加载 React 前端界面
- **API 服务**: /api/* 路径
- **WebSocket**: /ws/* 路径

---

**📞 技术支持**: siwmm@163.com  
**📄 详细文档**: 见 docs/HTTPS完整部署指南.md