# Ubuntu 快速部署指令

## ✅ 部署包准备完成

**编译时间**: 2025年10月17日 12:38
**后端版本**: Rust 交叉编译 (x86_64-unknown-linux-musl)
**前端版本**: React 生产构建 (最新)
**支持**: HTTPS + ACME 自动证书

## 🎯 核心文件状态

- ✅ `customer-service-backend` (11.1MB) - 新编译的 Linux 二进制文件
- ✅ `static/` - 最新前端构建文件  
- ✅ `certs/` - SSL 证书文件
- ✅ `.env` - HTTPS 生产环境配置
- ✅ `start.sh` - 智能启动脚本
- ✅ `customer_service.db` - 数据库文件

## 🚀 Ubuntu 部署步骤

### 1. 上传整个文件夹到 Ubuntu
```bash
# 将整个 ubuntu-deploy-ready 文件夹上传到：
/root/ubuntu-deploy-ready/
```

### 2. 设置权限并启动
```bash
cd /root/ubuntu-deploy-ready/
chmod +x customer-service-backend
chmod +x start.sh
chmod +x *.sh

# 启动 HTTPS 服务
./start.sh
```

### 3. 验证服务
```bash
# 检查服务状态
systemctl status customer-service

# 查看日志
journalctl -f -u customer-service

# 测试访问
curl -k https://localhost:8443/api/health
```

## 🌐 访问地址

- **HTTPS**: https://elontalk.duckdns.org:8443
- **管理后台**: https://elontalk.duckdns.org:8443
- **WebSocket SDK**: wss://elontalk.duckdns.org:8443/ws/customer/...

## 🔧 重要配置

### 环境变量 (.env)
- `TLS_MODE=https` - 强制 HTTPS
- `TLS_PORT=8443` - HTTPS 端口
- `ACME_ENABLED=true` - 自动证书
- `TLS_DOMAIN=elontalk.duckdns.org` - 域名

### 防火墙设置
```bash
ufw allow 8443/tcp
ufw enable
```

## ⚡ 特性

1. **零依赖部署** - 静态链接二进制文件
2. **HTTPS 支持** - Rustls TLS 实现
3. **自动证书** - Let's Encrypt + DuckDNS
4. **Sea-ORM 自动迁移** - 数据库自动更新
5. **Systemd 服务** - 开机自启动

## 📋 故障排除

### 如果服务无法启动：
```bash
# 检查日志
./customer-service-backend 2>&1 | head -20

# 检查证书
ls -la certs/

# 测试 HTTP 模式
TLS_MODE=http ./customer-service-backend
```

### 如果证书问题：
```bash
# 重新申请证书
./setup-https.sh

# 或使用自签名证书
openssl req -x509 -newkey rsa:4096 -keyout certs/server.key -out certs/server.crt -days 365 -nodes
```

---

**部署准备完成**: ✅  
**文件夹**: `ubuntu-deploy-ready/` (准备上传)  
**下一步**: 上传到 Ubuntu 服务器 `/root/ubuntu-deploy-ready/`