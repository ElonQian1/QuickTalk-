# Ubuntu部署包 - 快速部署指南

## 📦 部署包内容

- `customer-service-backend` - Linux可执行文件 (带HTTPS支持)
- `static/` - 前端静态文件
- `certs/` - SSL证书目录
- `.env.production` - 生产环境配置
- `start-production.sh` - 启动脚本
- `deploy.sh` - systemd部署脚本
- `customer-service.service` - systemd服务文件

## 🚀 快速部署步骤

### 1️⃣ 上传到服务器

```bash
# 在本地Windows上传整个文件夹
scp -r ubuntu-deploy-ready/ root@43.139.82.12:/root/
```

### 2️⃣ 登录服务器并启动

```bash
# SSH登录到Ubuntu服务器
ssh root@43.139.82.12

# 进入部署目录
cd /root/ubuntu-deploy-ready

# 赋予执行权限
chmod +x start-production.sh

# 运行启动脚本
./start-production.sh
```

### 3️⃣ 选择启动方式

脚本会提示选择启动方式：

- **选项1**: 前台运行 - 适合测试，可查看实时日志
- **选项2**: 后台运行 - 使用nohup方式
- **选项3**: systemd服务 - 推荐生产环境使用

## 🌐 访问地址

- **HTTPS (推荐)**: https://elontalk.duckdns.org:8443
- **HTTP (备用)**: http://43.139.82.12:8080

## 📋 重要信息

- **部署路径**: `/root/ubuntu-deploy-ready/`
- **域名**: elontalk.duckdns.org
- **管理员邮箱**: siwmm@163.com
- **数据库**: SQLite (自动迁移)
- **证书**: ACME自动申请 (Let's Encrypt)

## 🔧 常用命令

### systemd方式启动后：

```bash
# 查看服务状态
systemctl status customer-service.service

# 查看日志
journalctl -u customer-service.service -f

# 重启服务
systemctl restart customer-service.service

# 停止服务
systemctl stop customer-service.service
```

### nohup方式启动后：

```bash
# 查看日志
tail -f customer-service.log

# 停止服务
pkill -f customer-service-backend
```

### 前台运行：

- 按 `Ctrl+C` 停止服务

## ⚠️ 注意事项

1. **HTTPS证书**: 首次启动时会自动申请Let's Encrypt证书
2. **DNS配置**: 确保elontalk.duckdns.org已正确配置DuckDNS
3. **防火墙**: 确保8443端口(HTTPS)和8080端口(HTTP)已开放
4. **数据库**: 首次启动会自动创建和迁移数据库

## 🐛 故障排查

### 如果服务无法启动：

```bash
# 检查端口占用
netstat -tlnp | grep -E '8080|8443'

# 检查日志
journalctl -u customer-service.service -n 100

# 手动运行查看错误
cd /root/ubuntu-deploy-ready
./customer-service-backend
```

### 如果证书申请失败：

1. 检查DNS是否正确配置
2. 确认DuckDNS Token正确
3. 查看日志中的详细错误信息

## 📝 配置文件说明

- `.env.production` - 生产环境配置，包含：
  - 数据库路径
  - HTTPS端口和域名
  - ACME证书配置
  - DuckDNS Token

## 🔄 更新部署

重新编译并上传后，在服务器上：

```bash
cd /root/ubuntu-deploy-ready

# 停止服务
systemctl stop customer-service.service

# 重新启动
./start-production.sh
```

---

**编译时间**: 2025-10-18
**后端版本**: 带HTTPS支持的交叉编译版本
**前端版本**: React生产构建
