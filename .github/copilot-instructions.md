# QuickTalk å®¢æœç³»ç»Ÿ - AI ç¼–ç æŒ‡å—

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

è¿™æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„å®æ—¶å®¢æœç³»ç»Ÿï¼Œé‡‡ç”¨ Node.js + WebSocket + SQLite/å†…å­˜æ•°æ®åº“çš„æ¶æ„ã€‚

### æ ¸å¿ƒç»„ä»¶
- **`server.js`**: ä¸»æœåŠ¡å™¨ï¼Œé›†æˆæ¨¡å—åŒ–ç³»ç»Ÿå’Œå…¼å®¹æ€§æ¨¡å—
- **`src/modules/ModularApp.js`**: æ—§ç‰ˆæ¨¡å—åŒ–æ¶æ„ï¼ˆå·²è¢«æ›¿æ¢ï¼‰
- **`src/app/modular-app.js`**: æ–°æ¨¡å—åŒ–åº”ç”¨ç®¡ç†å™¨ï¼ˆå½“å‰æ´»è·ƒï¼‰
- **`src/websocket/WebSocketRouter.js`**: WebSocket è·¯ç”±ç³»ç»Ÿ
- **`src/database/`**: æ•°æ®åº“å±‚ï¼ˆdatabase-core.js, shop-repository.js, message-repository.jsï¼‰
- **`src/client-api/`**: å®¢æˆ·ç«¯APIè·¯ç”±å’Œå¤„ç†å™¨
- **`static/`**: å‰ç«¯é™æ€æ–‡ä»¶ï¼ˆåˆ†ä¸ºæ¡Œé¢ç«¯/ç§»åŠ¨ç«¯ï¼‰

## ğŸ”„ å¼€å‘å·¥ä½œæµ

### å¤šç»ˆç«¯è¿è¡Œæ¨¡å¼ (é‡è¦!)
**å§‹ç»ˆä½¿ç”¨ç‹¬ç«‹ç»ˆç«¯è¿è¡Œä¸åŒæœåŠ¡ï¼Œé¿å…é˜»å¡:**

```bash
# ç»ˆç«¯ 1: å¯åŠ¨åç«¯æœåŠ¡å™¨ï¼ˆå¼€å‘æ¨¡å¼ï¼Œæ”¯æŒçƒ­åŠ è½½ï¼‰
npm run dev  # ä½¿ç”¨ nodemonï¼Œè‡ªåŠ¨é‡è½½

# ç»ˆç«¯ 2: è¿è¡Œæµ‹è¯•è„šæœ¬
node test-*.js

# ç»ˆç«¯ 3: æ•°æ®åº“ç›¸å…³æ“ä½œ
node debug-database.js
node setup-test-data.js
```

### âš ï¸ å¼€å‘æ¨¡å¼é‡è¦åŸåˆ™
- **ä¸è¦é‡å¯æœåŠ¡å™¨**: ä½¿ç”¨ `npm run dev` å¼€å‘æ¨¡å¼ï¼Œæ”¯æŒçƒ­åŠ è½½
- **ä¸è¦æ£€æµ‹æœåŠ¡å™¨çŠ¶æ€**: AIä»£ç†å¼€å‘æ—¶ä¸éœ€è¦æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨
- **ä¸è¦è‡ªåŠ¨é‡å¯æœåŠ¡**: ä»£ç ä¿®æ”¹æ—¶è®© nodemon è‡ªåŠ¨å¤„ç†é‡è½½
- **æ—¥å¿—è·å–**: å¦‚æœæ— æ³•è·å–åç«¯/å‰å°æ—¥å¿—ï¼Œè¯·ç”¨æˆ·å¤åˆ¶æ—¥å¿—å†…å®¹æä¾›ç»™AIä»£ç†

### æ•°æ®åº“åˆ‡æ¢
```bash
# åˆ‡æ¢åˆ°å†…å­˜æ•°æ®åº“ï¼ˆå¼€å‘/æµ‹è¯•ï¼‰
npm run db:memory

# åˆ‡æ¢åˆ° SQLite æ•°æ®åº“ï¼ˆç”Ÿäº§ï¼‰
npm run db:sqlite
```

## ğŸ”§ é¡¹ç›®ç‰¹å®šæ¨¡å¼

### åŒæ•°æ®åº“ç³»ç»Ÿ
- **`database-sqlite.js`**: æŒä¹…åŒ– SQLite æ•°æ®åº“
- **`database-memory.js`**: å†…å­˜æ•°æ®åº“ï¼ˆæµ‹è¯•ç”¨ï¼‰
- é€šè¿‡ npm scripts åŠ¨æ€åˆ‡æ¢ï¼Œè‡ªåŠ¨ä¿®æ”¹ `server.js` ä¸­çš„ require è·¯å¾„

### WebSocket é€šä¿¡æ¨¡å¼
```javascript
// å®¢æˆ·ç«¯è¿æ¥æ¨¡å¼
ws://localhost:3030/ws

// æ¶ˆæ¯æ ¼å¼æ ‡å‡†
{
  type: 'message|join|leave|typing',
  content: 'text',
  userId: 'uuid',
  timestamp: Date.now()
}
```

### æ¨¡å—åŒ–åˆå§‹åŒ–é¡ºåº
1. æ•°æ®åº“å±‚ (`database-sqlite` æˆ– `database-memory`)
2. ä»“åº“å±‚ (`ShopRepository`, `MessageAdapter`)
3. å®‰å…¨å±‚ (`SecurityManager`)
4. WebSocket è·¯ç”± (`WebSocketRouter`)
5. Express è·¯ç”±é›†æˆ

## ğŸ§ª æµ‹è¯•å’Œè°ƒè¯•

### é‡è¦æµ‹è¯•æ–‡ä»¶
- **`test-complete-websocket.js`**: å®Œæ•´ WebSocket åŠŸèƒ½æµ‹è¯•
- **`test-message-flow.js`**: æ¶ˆæ¯æµæµ‹è¯•
- **`debug-database.js`**: æ•°æ®åº“çŠ¶æ€æ£€æŸ¥
- **`setup-test-data.js`**: åˆå§‹åŒ–æµ‹è¯•æ•°æ®

### è°ƒè¯•å·¥å…·
```bash
# æ£€æŸ¥æ•°æ®åº“ç»“æ„
node check-database-structure.js

# è°ƒè¯•ç”¨æˆ·-åº—é“ºå…³ç³»
node debug-user-shops.js

# æµ‹è¯•å®¢æˆ·ç«¯API
node test-client-api.js
```

## ğŸ”— é›†æˆæ¨¡å¼

### åµŒå…¥å¼å®¢æœä»£ç 
ä½¿ç”¨ `integration-code-*.html` æ–‡ä»¶ç”Ÿæˆç¬¬ä¸‰æ–¹ç½‘ç«™åµŒå…¥ä»£ç :
- **Smart Polling**: `integration-code-smart-polling.html`
- **WebSocket**: `integration-code-websocket.html`
- **Final Fixed**: `integration-code-final-fixed.html`

### API ç«¯ç‚¹
```javascript
// å®¢æˆ·ç«¯ API
GET  /api/messages/:conversationId  // è·å–æ¶ˆæ¯å†å²
POST /api/send                      // å‘é€æ¶ˆæ¯
POST /api/connect                   // å»ºç«‹è¿æ¥

// ç®¡ç†ç«¯ API
GET  /admin                         // ç®¡ç†åå°
POST /api/admin/login              // ç®¡ç†å‘˜ç™»å½•
```

## ğŸ“± ç§»åŠ¨ç«¯æ”¯æŒ

é¡¹ç›®åŒ…å«ä¸“é—¨çš„ç§»åŠ¨ç«¯æ¨¡å— (`src/mobile/`), ä½¿ç”¨å“åº”å¼è®¾è®¡é€‚é…æ‰‹æœºç«¯è®¿é—®ã€‚

## âš ï¸ é‡è¦çº¦å®š

- **å¼€å‘æ¨¡å¼ä¼˜å…ˆ**: ä½¿ç”¨ `npm run dev` å¯åŠ¨ï¼Œæ”¯æŒçƒ­åŠ è½½ï¼Œæ— éœ€æ‰‹åŠ¨é‡å¯
- **ä¸è¦é‡å¯æœåŠ¡å™¨**: AIä»£ç†å¼€å‘è¿‡ç¨‹ä¸­ç¦æ­¢æ£€æµ‹æˆ–é‡å¯æœåŠ¡å™¨
- **æ—¥å¿—å¤„ç†**: æ— æ³•è·å–åç«¯æ—¥å¿—æ—¶ï¼Œè¯·ç”¨æˆ·å¤åˆ¶æ—¥å¿—å†…å®¹æä¾›
- **æ•°æ®åº“é€‰æ‹©**: å¼€å‘ç”¨å†…å­˜åº“ï¼Œç”Ÿäº§ç”¨ SQLite
- **WebSocket ä¼˜å…ˆ**: å®æ—¶åŠŸèƒ½ä¾èµ– WebSocketï¼ŒHTTP API ä»…ä½œè¡¥å……
- **æ¨¡å—åŒ–å¼€å‘**: æ–°åŠŸèƒ½æ·»åŠ åˆ° `src/modules/` è€Œéä¸» `server.js`

## ğŸ”¥ ä»£ç ç»Ÿä¸€æ€§åŸåˆ™ (é‡è¦!)

### é¿å…é‡å¤ä»£ç å’Œå¤šç‰ˆæœ¬å…±å­˜
- **ç¦æ­¢åˆ›å»ºæ–°æ—§ä¸¤å¥—ä»£ç **: AIä»£ç†å¼€å‘æ—¶å¿…é¡»æ£€æµ‹ç°æœ‰åŠŸèƒ½ï¼Œå¦‚å‘ç°é‡å¤é€»è¾‘åº”ç«‹å³åˆå¹¶
- **å•ä¸€ä»£ç è·¯å¾„**: é¡¹ç›®å¿…é¡»å§‹ç»ˆä¿æŒåªæœ‰ä¸€å¥—ä»£ç ï¼Œä¸å…è®¸å¤šä¸ªç‰ˆæœ¬çš„åŠŸèƒ½åŒæ—¶å­˜åœ¨
- **é‡æ„è€Œéå¢åŠ **: å‘ç°ç±»ä¼¼åŠŸèƒ½æ—¶ï¼Œåº”é‡æ„ç°æœ‰ä»£ç è€Œä¸æ˜¯åˆ›å»ºæ–°çš„å®ç°
- **ä¸»åŠ¨æ£€æµ‹é‡å¤**: å¼€å‘å‰å¿…é¡»æœç´¢ç°æœ‰ä»£ç ï¼Œç¡®è®¤åŠŸèƒ½æ˜¯å¦å·²å­˜åœ¨
- **åˆ é™¤è¿‡æ—¶ä»£ç **: å®ç°æ–°åŠŸèƒ½åï¼Œå¿…é¡»åˆ é™¤è¢«æ›¿æ¢çš„æ—§ä»£ç å’Œæ–‡ä»¶

### ä»£ç ä¸€è‡´æ€§æ£€æŸ¥æ¸…å•
åœ¨å¼€å‘ä»»ä½•åŠŸèƒ½å‰ï¼ŒAIä»£ç†å¿…é¡»æ‰§è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š
1. **æœç´¢ç°æœ‰å®ç°**: ä½¿ç”¨ `grep_search` å’Œ `semantic_search` æŸ¥æ‰¾ç›¸ä¼¼åŠŸèƒ½
2. **åˆ†æä»£ç é‡å¤**: æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç›¸åŒæˆ–ç±»ä¼¼çš„é€»è¾‘å®ç°
3. **è¯„ä¼°åˆå¹¶å¯èƒ½**: åˆ¤æ–­æ˜¯å¦å¯ä»¥é‡æ„ç°æœ‰ä»£ç è€Œéæ–°å»º
4. **æ¸…ç†è¿‡æ—¶ä»£ç **: å®Œæˆæ–°åŠŸèƒ½åï¼Œåˆ é™¤æ‰€æœ‰è¢«æ›¿æ¢çš„æ—§å®ç°
5. **éªŒè¯å•ä¸€è·¯å¾„**: ç¡®ä¿åŠŸèƒ½åªæœ‰ä¸€ä¸ªå…¥å£ç‚¹å’Œå®ç°è·¯å¾„

## ğŸ“ è¯¦ç»†æ–‡ä»¶ç»“æ„

### æ ¹ç›®å½•å…³é”®æ–‡ä»¶
```
QuickTalk-/
â”œâ”€â”€ server.js                 # ä¸»æœåŠ¡å™¨å…¥å£ï¼Œé›†æˆæ–°æ—§ç³»ç»Ÿ
â”œâ”€â”€ package.json              # ä¾èµ–å’Œscriptså®šä¹‰
â”œâ”€â”€ database-sqlite.js        # SQLiteæ•°æ®åº“å®ç°
â”œâ”€â”€ database-memory.js        # å†…å­˜æ•°æ®åº“ï¼ˆæµ‹è¯•ç”¨ï¼‰
â”œâ”€â”€ auth-routes.js           # è®¤è¯è·¯ç”±
â””â”€â”€ .github/
    â””â”€â”€ copilot-instructions.md  # æœ¬æ–‡ä»¶
```

### æ ¸å¿ƒæ¨¡å—ç»“æ„
```
src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ modular-app.js       # æ–°æ¨¡å—åŒ–åº”ç”¨ä¸»æ§åˆ¶å™¨ï¼ˆå½“å‰æ´»è·ƒï¼‰
â”œâ”€â”€ modules/
â”‚   â””â”€â”€ ModularApp.js        # æ—§æ¨¡å—åŒ–ç³»ç»Ÿï¼ˆå·²è¢«æ›¿æ¢ï¼‰
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ database-core.js     # æ•°æ®åº“æ ¸å¿ƒæŠ½è±¡
â”‚   â”œâ”€â”€ shop-repository.js   # åº—é“ºæ•°æ®ä»“åº“
â”‚   â””â”€â”€ message-repository.js # æ¶ˆæ¯æ•°æ®ä»“åº“
â”œâ”€â”€ client-api/
â”‚   â”œâ”€â”€ client-api-router.js # å®¢æˆ·ç«¯APIè·¯ç”±
â”‚   â”œâ”€â”€ connection-handler.js # è¿æ¥å¤„ç†å™¨
â”‚   â””â”€â”€ message-handler.js   # æ¶ˆæ¯å¤„ç†å™¨
â””â”€â”€ websocket/
    â””â”€â”€ WebSocketRouter.js   # WebSocketè·¯ç”±ç³»ç»Ÿ
```

## ğŸ—ï¸ æ„å»ºå’ŒéªŒè¯æ­¥éª¤

### ç¯å¢ƒè¦æ±‚
- Node.js 16+ 
- npm æˆ– yarn
- SQLite3 (ç”Ÿäº§ç¯å¢ƒ)

### å®Œæ•´å¯åŠ¨æµç¨‹
```bash
# 1. å®‰è£…ä¾èµ–ï¼ˆé¦–æ¬¡è¿è¡Œå¿…é¡»ï¼‰
npm install

# 2. é€‰æ‹©æ•°æ®åº“æ¨¡å¼
npm run db:memory    # å¼€å‘/æµ‹è¯•ç¯å¢ƒ
npm run db:sqlite    # ç”Ÿäº§ç¯å¢ƒ

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆæ¨èï¼‰
npm run dev         # æ”¯æŒçƒ­é‡è½½ï¼Œä»£ç ä¿®æ”¹è‡ªåŠ¨é‡å¯

# 4. ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
npm start          # ä¸æ”¯æŒçƒ­é‡è½½
```

### é‡è¦ç«¯ç‚¹éªŒè¯
å¯åŠ¨åéªŒè¯ä»¥ä¸‹ç«¯ç‚¹å¯æ­£å¸¸è®¿é—®ï¼š
- `http://localhost:3030/` - é¡¹ç›®ä¸»é¡µ
- `http://localhost:3030/admin` - ç®¡ç†åå°
- `http://localhost:3030/customer` - å®¢æœèŠå¤©
- `ws://localhost:3030/ws` - WebSocketè¿æ¥

### æµ‹è¯•å’Œè°ƒè¯•å‘½ä»¤
```bash
# æ•°æ®åº“ç»“æ„æ£€æŸ¥
node debug-database.js

# å®Œæ•´WebSocketåŠŸèƒ½æµ‹è¯•
node test-complete-websocket.js

# æ¶ˆæ¯æµæµ‹è¯•
node test-message-flow.js

# è®¾ç½®æµ‹è¯•æ•°æ®
node setup-test-data.js
```

## ğŸš« å¼€å‘çº¦æŸ
- **ç¦æ­¢æ‰‹åŠ¨é‡å¯æœåŠ¡å™¨**: ä½¿ç”¨nodemonçš„çƒ­é‡è½½åŠŸèƒ½
- **ç¦æ­¢æ£€æµ‹æœåŠ¡å™¨çŠ¶æ€**: AIä»£ç†ä¸åº”å°è¯•æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
- **å¤šç»ˆç«¯åŸåˆ™**: ä¸åŒåŠŸèƒ½ä½¿ç”¨ç‹¬ç«‹ç»ˆç«¯ï¼Œé¿å…é˜»å¡
- **ç¦æ­¢é‡å¤ä»£ç **: ä¸¥ç¦åˆ›å»ºåŠŸèƒ½ç›¸åŒæˆ–ç›¸ä¼¼çš„å¤šä¸ªå®ç°
- **ç¦æ­¢ç‰ˆæœ¬å…±å­˜**: ä¸å…è®¸æ–°æ—§ä¸¤å¥—ä»£ç åŒæ—¶å­˜åœ¨äºé¡¹ç›®ä¸­
- **å¼ºåˆ¶ä»£ç ç»Ÿä¸€**: å‘ç°é‡å¤é€»è¾‘å¿…é¡»ç«‹å³åˆå¹¶ï¼Œä¿æŒå•ä¸€ä»£ç è·¯å¾„
- **æ¸…ç†ä¹‰åŠ¡**: å®ç°æ–°åŠŸèƒ½åå¿…é¡»åˆ é™¤æ‰€æœ‰è¢«æ›¿æ¢çš„æ—§ä»£ç å’Œæ–‡ä»¶