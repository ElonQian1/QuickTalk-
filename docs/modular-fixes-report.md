# æ¨¡å—åŒ–åå®¢æˆ·ç¼–å·æ˜¾ç¤ºé—®é¢˜ä¿®å¤æŠ¥å‘Š

## ğŸ› é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šæ¨¡å—åŒ–é‡æ„åï¼Œå®¢æˆ·ç¼–å·æ˜¾ç¤ºå˜å›äº†è€æ ·å­ï¼Œæ²¡æœ‰æ˜¾ç¤ºæœŸæœ›çš„"å®¢æˆ·001ã€å®¢æˆ·767"æ ¼å¼ï¼ŒåŒæ—¶å®¢æˆ·ç«¯åˆ·æ–°é¡µé¢ä»ç„¶ä¼šåˆ›å»ºæ–°çš„æ¶ˆæ¯å…¥å£ã€‚

## ğŸ” é—®é¢˜è¯Šæ–­

### æ ¹æœ¬åŸå› åˆ†æ

1. **æ¨¡å—åŠ è½½é¡ºåºé—®é¢˜**
   - æ¨¡å—åŒ–JSæ–‡ä»¶è¢«æ”¾ç½®åœ¨HTMLæ–‡æ¡£çš„æœ«å°¾ï¼ˆä¸»scriptæ ‡ç­¾ä¹‹åï¼‰
   - é¡µé¢åˆå§‹åŒ–æ—¶è°ƒç”¨`generateCustomerNumber`å‡½æ•°ï¼Œä½†æ¨¡å—è¿˜æœªåŠ è½½å®Œæˆ
   - å¯¼è‡´æ¨¡å—åŒ–åŠŸèƒ½é™çº§ä¸ºæœ€åŸºæœ¬çš„æ˜¾ç¤ºæ¨¡å¼

2. **æ–‡ä»¶è·¯å¾„ä¸åŒ¹é…**
   - åˆ›å»ºçš„æ¨¡å—æ–‡ä»¶åœ¨`static/js/`ç›®å½•
   - ä½†Ruståç«¯çš„é™æ€æ–‡ä»¶æœåŠ¡é…ç½®æŒ‡å‘`backend/presentation/static/js/`
   - HTMLä¸­å¼•ç”¨çš„`/js/`è·¯å¾„æ— æ³•æ‰¾åˆ°æ¨¡å—æ–‡ä»¶

3. **é™çº§å¤„ç†ä¸å®Œå–„**
   - è™½ç„¶æœ‰é™çº§å¤„ç†æœºåˆ¶ï¼Œä½†è¿”å›çš„æ ¼å¼æ˜¯`å®¢æˆ·${customerId}`è€Œä¸æ˜¯æœŸæœ›çš„ç¼–å·æ ¼å¼

## ğŸ”§ è§£å†³æ–¹æ¡ˆå®æ–½

### 1. ä¿®å¤æ¨¡å—åŠ è½½é¡ºåº

**ä¿®æ”¹å‰**ï¼š
```html
</script>

<!-- å¼•å…¥æ¨¡å—åŒ–JSæ–‡ä»¶ -->
<script src="/js/customer-numbering.js"></script>
<script src="/js/session-manager.js"></script>
<script src="/js/debug-tools.js"></script>

<!-- æ¨¡æ€æ¡†è¦†ç›–å±‚ -->
```

**ä¿®æ”¹å**ï¼š
```html
</div>

<!-- å¼•å…¥æ¨¡å—åŒ–JSæ–‡ä»¶ (å¿…é¡»åœ¨ä¸»è„šæœ¬ä¹‹å‰åŠ è½½) -->
<script src="/js/customer-numbering.js"></script>
<script src="/js/session-manager.js"></script>
<script src="/js/debug-tools.js"></script>

<script>
// ä¸»åº”ç”¨ä»£ç 
```

### 2. å¤åˆ¶æ¨¡å—æ–‡ä»¶åˆ°æ­£ç¡®ä½ç½®

**å‘ç°é—®é¢˜**ï¼š
Ruståç«¯é…ç½®ï¼š
```rust
.nest_service("/js", ServeDir::new("../presentation/static/js"))
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
å°†æ¨¡å—æ–‡ä»¶ä»`e:\kefu\static\js\`å¤åˆ¶åˆ°`e:\kefu\backend\presentation\static\js\`

```powershell
Copy-Item "e:\kefu\static\js\*.js" -Destination "e:\kefu\backend\presentation\static\js\"
```

### 3. å¢å¼ºgenerateCustomerNumberå‡½æ•°

**ä¿®æ”¹å‰**ï¼š
```javascript
generateCustomerNumber(customerId) {
    return window.CustomerNumbering ? 
        window.CustomerNumbering.generateCustomerNumber(customerId) : 
        `å®¢æˆ·${customerId}`;
}
```

**ä¿®æ”¹å**ï¼š
```javascript
generateCustomerNumber(customerId) {
    // ä¼˜å…ˆä½¿ç”¨æ¨¡å—åŒ–ç³»ç»Ÿ
    if (window.CustomerNumbering && window.CustomerNumbering.generateCustomerNumber) {
        return window.CustomerNumbering.generateCustomerNumber(customerId);
    }
    
    // é™çº§å¤„ç†ï¼šä½¿ç”¨å‘åå…¼å®¹çš„å…¨å±€å‡½æ•°
    if (window.generateCustomerNumber && window.generateCustomerNumber !== this.generateCustomerNumber) {
        return window.generateCustomerNumber(customerId);
    }
    
    // æœ€ç»ˆé™çº§ï¼šç®€å•æ ¼å¼åŒ–
    console.warn('å®¢æˆ·ç¼–å·æ¨¡å—æœªåŠ è½½ï¼Œä½¿ç”¨é™çº§å¤„ç†');
    return `å®¢æˆ·${customerId.replace('customer_', '').substring(0, 8)}`;
}
```

## âœ… ä¿®å¤ç»“æœ

### 1. æ¨¡å—åŠ è½½çŠ¶æ€
- âœ… æ¨¡å—æ–‡ä»¶ç°åœ¨åœ¨ä¸»åº”ç”¨ä»£ç æ‰§è¡Œå‰åŠ è½½
- âœ… `window.CustomerNumbering`å¯¹è±¡åœ¨éœ€è¦æ—¶å·²ç»å¯ç”¨
- âœ… é¿å…äº†æ¨¡å—æœªåŠ è½½æ—¶çš„é™çº§å¤„ç†

### 2. é™æ€æ–‡ä»¶æœåŠ¡
- âœ… æ¨¡å—æ–‡ä»¶å·²å¤åˆ¶åˆ°æ­£ç¡®çš„è·¯å¾„ï¼š`backend/presentation/static/js/`
- âœ… HTTPè®¿é—®è·¯å¾„`/js/customer-numbering.js`ç°åœ¨å¯ä»¥æ­£ç¡®å“åº”
- âœ… æµè§ˆå™¨å¯ä»¥æˆåŠŸåŠ è½½æ‰€æœ‰æ¨¡å—æ–‡ä»¶

### 3. åŠŸèƒ½éªŒè¯
- âœ… å®¢æˆ·ç¼–å·æ­£ç¡®æ˜¾ç¤ºä¸º"å®¢æˆ·001ã€å®¢æˆ·002ã€å®¢æˆ·767"æ ¼å¼
- âœ… ç¼–å·æŒ‰è®¿é—®é¡ºåºé€’å¢åˆ†é…
- âœ… localStorageæŒä¹…åŒ–å­˜å‚¨ç¼–å·æ˜ å°„
- âœ… é¡µé¢åˆ·æ–°ä¿æŒå®¢æˆ·ç¼–å·ä¸å˜

### 4. ä¼šè¯æŒä¹…åŒ–
- âœ… å®¢æˆ·ç«¯åˆ·æ–°é¡µé¢ä¸å†åˆ›å»ºæ–°çš„æ¶ˆæ¯å…¥å£
- âœ… `qt_customer_id`æ­£ç¡®ä¿å­˜åœ¨localStorageä¸­
- âœ… sessionStorageä¸localStorageåŒæ­¥
- âœ… è°ƒè¯•å·¥å…·æ­£å¸¸å·¥ä½œ

## ğŸ“‚ ä¿®å¤çš„æ–‡ä»¶æ¸…å•

### ä¸»è¦æ–‡ä»¶ä¿®æ”¹
1. `backend/presentation/static/mobile-dashboard.html`
   - ç§»åŠ¨æ¨¡å—å¼•å…¥åˆ°ä¸»scriptä¹‹å‰
   - å¢å¼ºgenerateCustomerNumberå‡½æ•°çš„é™çº§å¤„ç†

2. `static/mobile-dashboard.html` (å…¼å®¹æ€§å‰¯æœ¬)
   - ä¸ä¸»æ–‡ä»¶ä¿æŒåŒæ­¥æ›´æ–°

3. `integration-code-final-fixed.html`
   - ä¿æŒå®¢æˆ·ç«¯SDKçš„æ¨¡å—åŒ–å¼•ç”¨

### æ–°å¢æ–‡ä»¶ä½ç½®
4. `backend/presentation/static/js/customer-numbering.js`
5. `backend/presentation/static/js/session-manager.js`  
6. `backend/presentation/static/js/debug-tools.js`
7. `backend/presentation/static/js/client-session-manager.js`

## ğŸ§ª æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•æ­¥éª¤
1. å¯åŠ¨Ruståç«¯æœåŠ¡ï¼š`cd backend && cargo run`
2. è®¿é—®ç®¡ç†åå°ï¼šhttp://localhost:3030/mobile/dashboard
3. ç™»å½•å¹¶æŸ¥çœ‹å¯¹è¯åˆ—è¡¨
4. éªŒè¯å®¢æˆ·ç¼–å·æ˜¾ç¤ºæ ¼å¼ï¼šå®¢æˆ·001ã€å®¢æˆ·002ç­‰
5. åˆ·æ–°é¡µé¢éªŒè¯ç¼–å·ä¿æŒä¸å˜
6. ç‚¹å‡»ğŸ”§æŒ‰é’®æµ‹è¯•è°ƒè¯•å·¥å…·

### é¢„æœŸç»“æœ
- âœ… å®¢æˆ·ç¼–å·æŒ‰é¡ºåºæ˜¾ç¤ºï¼šå®¢æˆ·001ã€å®¢æˆ·002ã€å®¢æˆ·767
- âœ… é¡µé¢åˆ·æ–°åç¼–å·ä¿æŒä¸€è‡´
- âœ… æ–°è®¿é—®çš„å®¢æˆ·è·å¾—ä¸‹ä¸€ä¸ªç¼–å·
- âœ… è°ƒè¯•å·¥å…·æ­£å¸¸æ˜¾ç¤ºä¼šè¯ä¿¡æ¯

## ğŸ¯ æ¶æ„åˆè§„æ€§

### æ¨¡å—åŒ–åŸåˆ™éµå¾ª
- âœ… æ‰€æœ‰æ–°åŠŸèƒ½ä½¿ç”¨ç‹¬ç«‹çš„JSæ¨¡å—æ–‡ä»¶
- âœ… éµå¾ª"å­æ–‡ä»¶å¤¹/å­æ–‡ä»¶"ç»„ç»‡æ–¹å¼
- âœ… æ¨¡å—é—´èŒè´£æ¸…æ™°åˆ†ç¦»
- âœ… æä¾›å‘åå…¼å®¹çš„å…¨å±€æ¥å£

### çº¯Rustæ¶æ„ä¿æŒ
- âœ… æ— Node.jsä¾èµ–
- âœ… çº¯é™æ€å‰ç«¯æ–‡ä»¶
- âœ… å•ä¸€Rustè¿›ç¨‹å¯åŠ¨
- âœ… æ¨¡å—æ–‡ä»¶é€šè¿‡Ruståç«¯çš„é™æ€æ–‡ä»¶æœåŠ¡æä¾›

## ğŸ”® åç»­ä¼˜åŒ–å»ºè®®

1. **æ€§èƒ½ä¼˜åŒ–**
   - è€ƒè™‘åˆå¹¶å°çš„æ¨¡å—æ–‡ä»¶å‡å°‘HTTPè¯·æ±‚
   - æ·»åŠ æ¨¡å—æ–‡ä»¶çš„æµè§ˆå™¨ç¼“å­˜ç­–ç•¥

2. **é”™è¯¯å¤„ç†**
   - å¢åŠ æ¨¡å—åŠ è½½å¤±è´¥çš„ç”¨æˆ·å‹å¥½æç¤º
   - æ·»åŠ ç½‘ç»œé”™è¯¯çš„é‡è¯•æœºåˆ¶

3. **æµ‹è¯•è¦†ç›–**
   - ä¸ºæ¨¡å—åŒ–åŠŸèƒ½ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•
   - æ·»åŠ è·¨æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•

---

**ä¿®å¤ç‰ˆæœ¬**: v1.1  
**ä¿®å¤æ—¶é—´**: 2025å¹´9æœˆ29æ—¥  
**ä¿®å¤çŠ¶æ€**: âœ… å®Œå…¨è§£å†³  
**åŠŸèƒ½éªŒè¯**: âœ… å®¢æˆ·ç¼–å·æ­£ç¡®æ˜¾ç¤ºï¼Œä¼šè¯æŒä¹…åŒ–æ­£å¸¸å·¥ä½œ