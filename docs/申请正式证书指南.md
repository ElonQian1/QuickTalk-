# ç”³è¯·æ­£å¼ HTTPS è¯ä¹¦æŒ‡å—

## ğŸ¯ é—®é¢˜ç°çŠ¶

å½“å‰ä½¿ç”¨çš„æ˜¯**è‡ªç­¾åè¯ä¹¦**ï¼ˆlocalhostï¼‰ï¼Œå¯¼è‡´æµè§ˆå™¨æ˜¾ç¤º"ä¸å®‰å…¨"è­¦å‘Šã€‚

éœ€è¦ç”³è¯·**ç”±å—ä¿¡ä»» CA ç­¾å‘çš„æ­£å¼è¯ä¹¦**æ‰èƒ½è§£å†³ã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆ Aï¼šä½¿ç”¨å…è´¹åŸŸå + Let's Encryptï¼ˆæ¨èï¼‰

### ğŸ“‹ å‡†å¤‡å·¥ä½œ

ä½ å·²ç»æœ‰ï¼š
- **åŸŸå**: `elontalk.duckdns.org`
- **æœåŠ¡å™¨IP**: `43.139.82.12`
- **DuckDNS Token**: `400bfeb6-b2fe-40e8-8cb6-7d38a2b943ca`

### ğŸš€ æ­¥éª¤ 1ï¼šåœ¨ Ubuntu æœåŠ¡å™¨ä¸Šå®‰è£… Certbot

SSH ç™»å½•åˆ°ä½ çš„ Ubuntu æœåŠ¡å™¨ï¼š

```bash
# æ›´æ–°è½¯ä»¶åŒ…
sudo apt update

# å®‰è£… Certbot å’Œæ’ä»¶
sudo apt install certbot python3-certbot-nginx -y

# æˆ–è€…å¦‚æœæ²¡æœ‰ nginxï¼Œå®‰è£… standalone æ¨¡å¼
sudo apt install certbot -y
```

### ğŸš€ æ­¥éª¤ 2ï¼šåœæ­¢å½“å‰æœåŠ¡ï¼ˆè®© Certbot ä½¿ç”¨ 80 ç«¯å£ï¼‰

```bash
# åœæ­¢ä½ çš„å®¢æœç³»ç»Ÿ
sudo systemctl stop customer-service

# æˆ–è€…å¦‚æœæ²¡æœ‰ systemd æœåŠ¡
pkill customer-service-backend
```

### ğŸš€ æ­¥éª¤ 3ï¼šç”³è¯·è¯ä¹¦

```bash
# ä½¿ç”¨ standalone æ¨¡å¼ç”³è¯·è¯ä¹¦
sudo certbot certonly --standalone \
  --preferred-challenges http \
  --email siwmm@163.com \
  --agree-tos \
  --no-eff-email \
  -d elontalk.duckdns.org

# ç­‰å¾…å®Œæˆï¼Œè¯ä¹¦ä¼šä¿å­˜åˆ°ï¼š
# /etc/letsencrypt/live/elontalk.duckdns.org/
```

### ğŸš€ æ­¥éª¤ 4ï¼šå¤åˆ¶è¯ä¹¦åˆ°éƒ¨ç½²ç›®å½•

```bash
# å¤åˆ¶è¯ä¹¦æ–‡ä»¶
sudo cp /etc/letsencrypt/live/elontalk.duckdns.org/fullchain.pem \
        /root/ubuntu-deploy-ready/certs/server.crt

sudo cp /etc/letsencrypt/live/elontalk.duckdns.org/privkey.pem \
        /root/ubuntu-deploy-ready/certs/server.key

# è®¾ç½®æƒé™
sudo chmod 644 /root/ubuntu-deploy-ready/certs/server.crt
sudo chmod 600 /root/ubuntu-deploy-ready/certs/server.key
```

### ğŸš€ æ­¥éª¤ 5ï¼šé‡å¯æœåŠ¡

```bash
cd /root/ubuntu-deploy-ready
sudo systemctl start customer-service

# æˆ–è€…
./customer-service-backend
```

### ğŸš€ æ­¥éª¤ 6ï¼šéªŒè¯è¯ä¹¦

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š`https://elontalk.duckdns.org:8443`

åº”è¯¥çœ‹åˆ°ï¼š
- âœ… é”å›¾æ ‡å˜ç»¿è‰²
- âœ… æ˜¾ç¤º"è¿æ¥æ˜¯å®‰å…¨çš„"
- âœ… è¯ä¹¦é¢å‘è€…ï¼šLet's Encrypt

---

## âœ… è§£å†³æ–¹æ¡ˆ Bï¼šä½¿ç”¨ DNS éªŒè¯ï¼ˆå¦‚æœ 80 ç«¯å£è¢«å°ï¼‰

å¦‚æœä½ çš„æœåŠ¡å™¨ 80 ç«¯å£è¢«é˜²ç«å¢™å°é”ï¼Œä½¿ç”¨ DNS éªŒè¯ï¼š

### æ–¹æ³• 1ï¼šæ‰‹åŠ¨ DNS éªŒè¯

```bash
# ç”³è¯·è¯ä¹¦ï¼ˆDNS éªŒè¯ï¼‰
sudo certbot certonly --manual \
  --preferred-challenges dns \
  --email siwmm@163.com \
  --agree-tos \
  --no-eff-email \
  -d elontalk.duckdns.org
```

Certbot ä¼šæç¤ºä½ æ·»åŠ  DNS TXT è®°å½•ï¼š

```
Please deploy a DNS TXT record under the name:
_acme-challenge.elontalk.duckdns.org

with the following value:
xxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

### æ·»åŠ  DNS è®°å½•åˆ° DuckDNS

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
```
https://www.duckdns.org/update?domains=elontalk&token=400bfeb6-b2fe-40e8-8cb6-7d38a2b943ca&txt=xxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

ï¼ˆæ›¿æ¢ `xxxxxxxxxxxxxxxxxxxxxxxxxxxx` ä¸º Certbot æä¾›çš„å€¼ï¼‰

ç­‰å¾… 1-2 åˆ†é’Ÿåï¼ŒæŒ‰å›è½¦ç»§ç»­éªŒè¯ã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆ Cï¼šåœ¨ Windows ä¸Šç”³è¯·è¯ä¹¦ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰

å¦‚æœæ— æ³•åœ¨æœåŠ¡å™¨ä¸Šç”³è¯·ï¼Œå¯ä»¥åœ¨ Windows æœ¬åœ°ç”³è¯·åä¸Šä¼ ã€‚

### ğŸ”§ ä½¿ç”¨ win-acme

1. **ä¸‹è½½ win-acme**ï¼š
   ```powershell
   # ä¸‹è½½æœ€æ–°ç‰ˆæœ¬
   # https://github.com/win-acme/win-acme/releases/latest
   ```

2. **è¿è¡Œç”³è¯·**ï¼ˆéœ€è¦æ‰‹åŠ¨ DNS éªŒè¯ï¼‰ï¼š
   ```powershell
   .\wacs.exe
   # é€‰æ‹© M - Manual input
   # è¾“å…¥åŸŸå: elontalk.duckdns.org
   # é€‰æ‹©éªŒè¯æ–¹å¼: DNS-01
   ```

3. **å¤åˆ¶è¯ä¹¦**ï¼š
   ```powershell
   # è¯ä¹¦ä¿å­˜åœ¨ C:\ProgramData\win-acme\certificates\
   copy "C:\ProgramData\win-acme\certificates\elontalk.duckdns.org\*.crt" `
        "E:\duihua\customer-service-system\ubuntu-deploy-ready\certs\server.crt"
   
   copy "C:\ProgramData\win-acme\certificates\elontalk.duckdns.org\*.key" `
        "E:\duihua\customer-service-system\ubuntu-deploy-ready\certs\server.key"
   ```

---

## ğŸ”„ è¯ä¹¦è‡ªåŠ¨ç»­æœŸ

Let's Encrypt è¯ä¹¦æœ‰æ•ˆæœŸåªæœ‰ **90 å¤©**ï¼Œéœ€è¦å®šæœŸç»­æœŸã€‚

### åœ¨ Ubuntu ä¸Šè®¾ç½®è‡ªåŠ¨ç»­æœŸ

```bash
# Certbot ä¼šè‡ªåŠ¨åˆ›å»ºå®šæ—¶ä»»åŠ¡
# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡
sudo systemctl list-timers | grep certbot

# æ‰‹åŠ¨æµ‹è¯•ç»­æœŸ
sudo certbot renew --dry-run

# ç»­æœŸæˆåŠŸåï¼Œéœ€è¦å¤åˆ¶æ–°è¯ä¹¦å¹¶é‡å¯æœåŠ¡
# åˆ›å»ºç»­æœŸåé’©å­è„šæœ¬
sudo nano /etc/letsencrypt/renewal-hooks/post/copy-cert.sh
```

**è„šæœ¬å†…å®¹**ï¼š
```bash
#!/bin/bash
cp /etc/letsencrypt/live/elontalk.duckdns.org/fullchain.pem \
   /root/ubuntu-deploy-ready/certs/server.crt

cp /etc/letsencrypt/live/elontalk.duckdns.org/privkey.pem \
   /root/ubuntu-deploy-ready/certs/server.key

chmod 644 /root/ubuntu-deploy-ready/certs/server.crt
chmod 600 /root/ubuntu-deploy-ready/certs/server.key

systemctl restart customer-service
```

```bash
# è®¾ç½®è„šæœ¬å¯æ‰§è¡Œ
sudo chmod +x /etc/letsencrypt/renewal-hooks/post/copy-cert.sh
```

---

## ğŸ” éªŒè¯è¯ä¹¦ä¿¡æ¯

### åœ¨ Ubuntu ä¸ŠéªŒè¯

```bash
openssl x509 -in /root/ubuntu-deploy-ready/certs/server.crt -text -noout | grep -E "Subject:|Issuer:|Not After"
```

åº”è¯¥æ˜¾ç¤ºï¼š
```
Subject: CN=elontalk.duckdns.org
Issuer: C=US, O=Let's Encrypt, CN=R3
Not After : 2026-XX-XX XX:XX:XX GMT
```

### åœ¨æµè§ˆå™¨ä¸­éªŒè¯

è®¿é—®ï¼š`https://elontalk.duckdns.org:8443`

ç‚¹å‡»åœ°å€æ çš„é”å›¾æ ‡ â†’ æŸ¥çœ‹è¯ä¹¦ï¼š
- âœ… é¢å‘ç»™ï¼šelontalk.duckdns.org
- âœ… é¢å‘è€…ï¼šLet's Encrypt Authority X3
- âœ… æœ‰æ•ˆæœŸï¼š90 å¤©

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: 80 ç«¯å£è¢«å ç”¨æˆ–è¢«å°é”

**è§£å†³**ï¼šä½¿ç”¨ DNS-01 éªŒè¯ï¼ˆæ–¹æ¡ˆ Bï¼‰

### Q2: ç”³è¯·å¤±è´¥ - rate limit

**åŸå› **ï¼šLet's Encrypt æ¯å‘¨å¯¹åŒä¸€åŸŸåé™åˆ¶ 5 æ¬¡ç”³è¯·

**è§£å†³**ï¼šç­‰å¾… 1 å‘¨åé‡è¯•ï¼Œæˆ–ä½¿ç”¨æµ‹è¯•ç¯å¢ƒï¼š
```bash
sudo certbot certonly --standalone --staging -d elontalk.duckdns.org
```

### Q3: è¯ä¹¦è¿‡æœŸ

**è§£å†³**ï¼š
```bash
# æ‰‹åŠ¨ç»­æœŸ
sudo certbot renew

# å¼ºåˆ¶ç»­æœŸ
sudo certbot renew --force-renewal
```

### Q4: æµè§ˆå™¨ä»ç„¶æ˜¾ç¤ºä¸å®‰å…¨

**æ£€æŸ¥**ï¼š
1. æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„åŸŸåï¼ˆä¸æ˜¯ IP åœ°å€ï¼‰
2. æ˜¯å¦æ¸…é™¤äº†æµè§ˆå™¨ç¼“å­˜
3. è¯ä¹¦æ˜¯å¦å·²è¿‡æœŸ
4. æœåŠ¡å™¨æ˜¯å¦åŠ è½½äº†æ–°è¯ä¹¦ï¼ˆé‡å¯æœåŠ¡ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- Let's Encrypt å®˜æ–¹æ–‡æ¡£ï¼šhttps://letsencrypt.org/docs/
- Certbot ç”¨æˆ·æŒ‡å—ï¼šhttps://certbot.eff.org/instructions
- DuckDNS æ–‡æ¡£ï¼šhttps://www.duckdns.org/spec.jsp

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

**æœ€ç®€å•æœ€å¿«çš„æ–¹æ¡ˆ**ï¼šæ–¹æ¡ˆ Aï¼ˆåœ¨ Ubuntu æœåŠ¡å™¨ä¸Šç›´æ¥ç”³è¯·ï¼‰

åªéœ€è¦ 5 ä¸ªå‘½ä»¤ï¼š
```bash
sudo apt install certbot -y
sudo systemctl stop customer-service
sudo certbot certonly --standalone -d elontalk.duckdns.org --email siwmm@163.com --agree-tos
sudo cp /etc/letsencrypt/live/elontalk.duckdns.org/*.pem /root/ubuntu-deploy-ready/certs/
sudo systemctl start customer-service
```

å®Œæˆåï¼Œä½ çš„ç½‘ç«™å°±ä¼šæ˜¾ç¤º âœ… å®‰å…¨é”äº†ï¼
