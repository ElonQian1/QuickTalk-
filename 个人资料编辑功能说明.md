# 个人资料编辑功能使用说明

## 功能概述

在论坛客服系统的管理后台，用户现在可以通过点击右上角的用户徽章（显示用户名和角色的按钮）来编辑个人资料信息。

## 功能特性

### 🔍 可编辑的个人信息
- **用户名**: 可以修改显示的用户名
- **邮箱地址**: 可以更新邮箱信息
- **角色信息**: 只读显示，不可修改（由管理员控制）

### 🔐 密码修改功能
- **当前密码验证**: 修改密码时需要输入当前密码进行验证
- **新密码设置**: 设置新密码（最少6位字符）
- **密码确认**: 需要再次输入新密码确认

## 使用步骤

### 1. 访问个人资料编辑
1. 登录到管理后台：http://localhost:3030/admin-new
2. 在页面右上角找到用户徽章（显示为 "用户名 (角色)" 的紫色按钮）
3. 点击该徽章打开个人资料编辑窗口

### 2. 编辑基本信息
1. 在弹出的模态框中，可以看到当前的用户信息
2. 修改"用户名"和"邮箱"字段
3. 角色字段为只读，显示当前用户的权限级别

### 3. 修改密码（可选）
1. 如果需要修改密码，填写"当前密码"字段
2. 输入"新密码"（至少6位字符）
3. 在"确认新密码"字段再次输入新密码
4. 如果不需要修改密码，保持密码字段为空即可

### 4. 保存修改
1. 点击"保存修改"按钮提交更改
2. 系统会验证输入的信息
3. 成功后会显示确认消息，并自动关闭编辑窗口

## 验证规则

### 📋 基本信息验证
- 用户名不能为空
- 邮箱必须是有效的邮箱格式
- 用户名和邮箱不能与其他用户重复

### 🔒 密码验证
- 当前密码必须正确（如果要修改密码）
- 新密码长度至少6位字符
- 新密码和确认密码必须一致

## 用户角色说明

### 👑 超级管理员 (super_admin)
- 拥有系统的最高权限
- 可以管理所有店铺和用户
- 默认账号：admin / admin123

### 🏪 店主 (shop_owner)
- 可以管理自己的店铺
- 可以添加和管理店铺员工
- 默认账号：shop_owner / 123456

### 👤 员工 (employee)
- 可以处理客服对话
- 权限范围限于所属店铺

## 安全特性

- ✅ 密码修改需要验证当前密码
- ✅ 用户名和邮箱唯一性检查
- ✅ 会话验证确保操作安全
- ✅ 角色权限保护（用户不能修改自己的角色）

## API 接口

系统提供了以下API接口支持个人资料功能：

### 获取个人资料
```
GET /api/auth/profile
Headers: X-Session-Id: <session_id>
```

### 更新个人资料
```
PUT /api/auth/profile
Headers: 
  Content-Type: application/json
  X-Session-Id: <session_id>
Body: {
  "username": "新用户名",
  "email": "新邮箱@example.com",
  "currentPassword": "当前密码",  // 可选，仅在修改密码时需要
  "newPassword": "新密码"        // 可选，仅在修改密码时需要
}
```

## 测试页面

开发团队可以使用专门的测试页面来验证个人资料功能：
- 测试页面：http://localhost:3030/test-profile.html
- 该页面提供了登录、获取资料、更新资料的完整测试功能

## 故障排除

### 常见问题

**Q: 点击用户徽章没有反应？**
A: 检查浏览器控制台是否有JavaScript错误，确保页面完全加载。

**Q: 修改密码时提示"当前密码不正确"？**
A: 请确保输入的当前密码完全正确，注意大小写。

**Q: 用户名或邮箱显示"已被使用"？**
A: 系统中每个用户名和邮箱都必须唯一，请选择其他用户名或邮箱。

**Q: 新密码不符合要求？**
A: 新密码长度至少需要6位字符，请设置更复杂的密码。

## 技术实现

- **前端**: HTML5 + CSS3 + JavaScript（原生）
- **后端**: Node.js + Express
- **数据存储**: 内存数据库（生产环境建议使用MySQL/PostgreSQL）
- **认证**: 基于Session的用户认证
- **安全**: 密码哈希、CORS支持、输入验证

---

*更新时间：2025年9月7日*
*版本：v1.0*
