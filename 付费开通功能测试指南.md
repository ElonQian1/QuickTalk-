# 🎯 付费开通功能测试指南

## 💎 功能概述

**付费开通**是一个新增功能，允许未审核通过的店铺通过支付 ¥2000 立即获得审核通过并获得1年服务期。

## 🔧 核心特性

### 📋 业务逻辑
- **适用对象**: 仅限状态为 `pending`（待审核）的店铺
- **付费金额**: ¥2000（与续费价格相同）
- **服务内容**: 
  - ✅ 立即审核通过（无需人工审核）
  - ✅ 获得1年服务有效期
  - ✅ 支持支付宝/微信二维码支付

### 🎨 界面设计
- **按钮样式**: 💎 付费开通 (¥2000) - 蓝色主题
- **模态框**: 独立的付费开通支付界面
- **二维码**: 支付宝/微信主题化设计
- **成功提示**: 突出自动审核通过的价值

## 🧪 测试步骤

### 1. 准备测试环境
```bash
# 确保服务器运行
node server.js

# 访问管理后台
http://localhost:3030/admin
```

### 2. 登录测试账号
```
用户名: shop_owner
密码: 123456
```

### 3. 查看店铺列表
- 应该能看到两个店铺：
  - **测试店铺** - 状态: 已审核通过 ✅
  - **待审核测试店铺** - 状态: 待审核 ⏳

### 4. 测试付费开通流程

#### 步骤1: 点击付费开通按钮
- 找到状态为"待审核"的店铺
- 点击 "💎 付费开通 (¥2000)" 按钮
- 确认弹出付费开通确认对话框

#### 步骤2: 确认付费开通
- 阅读确认信息：店铺名称、价格、服务内容
- 点击"确定"创建付费开通订单

#### 步骤3: 选择支付方式
- **支付宝测试**:
  1. 点击支付宝支付按钮
  2. 观察蓝色主题动画效果
  3. 确认生成支付宝二维码

- **微信测试**:
  1. 关闭模态框，重新打开
  2. 点击微信支付按钮
  3. 观察绿色主题动画效果
  4. 确认生成微信二维码

#### 步骤4: 模拟支付成功
- 点击 "🧪 模拟支付成功 (测试)" 按钮
- 观察支付成功界面
- 确认自动关闭模态框
- 查看成功提示信息

#### 步骤5: 验证结果
- 刷新店铺列表（点击"返回店铺列表"）
- 确认原本待审核的店铺现在显示为"已审核通过" ✅
- 确认店铺现在有"💰 续费"按钮（而不是付费开通）

## 🎯 预期行为

### ✅ 正常流程
1. **按钮显示**: 待审核店铺显示付费开通按钮
2. **订单创建**: 成功创建付费开通订单
3. **二维码生成**: 正确生成支付二维码
4. **支付处理**: 模拟支付成功
5. **自动审核**: 店铺状态自动变为已审核通过
6. **有效期设置**: 店铺获得1年有效期

### ❌ 异常处理
1. **权限检查**: 只有店主才能付费开通自己的店铺
2. **状态检查**: 只有待审核店铺才能付费开通
3. **重复开通**: 已审核通过的店铺不显示付费开通按钮
4. **订单过期**: 30分钟后订单自动过期

## 🔍 技术验证

### 后端API测试
```bash
# 创建付费开通订单
POST /api/shops/{shopId}/activate

# 生成支付二维码
POST /api/activation-orders/{orderId}/qrcode

# 查询订单状态
GET /api/activation-orders/{orderId}/status

# 模拟支付成功
POST /api/activation-orders/{orderId}/mock-success
```

### 数据库状态检查
- `activationOrders` Map: 存储付费开通订单
- `activationQRCodes` Map: 缓存二维码数据
- 店铺状态变化: `pending` → `approved`
- 店铺有效期: 自动设置为1年后

## 🎨 界面对比

### 续费 vs 付费开通

| 功能 | 续费 | 付费开通 |
|------|------|----------|
| 适用对象 | 已审核通过店铺 | 待审核店铺 |
| 按钮图标 | 💰 续费 | 💎 付费开通 |
| 主要作用 | 延长有效期 | 审核通过+设置有效期 |
| 模态框标题 | 店铺续费 | 店铺付费开通 |
| 成功提示 | 有效期延长1年 | 审核通过+获得1年有效期 |

## 🚀 价值体现

### 🏢 商业价值
- **快速变现**: 待审核店铺可立即付费使用
- **减少流失**: 避免用户等待人工审核流失
- **收入提升**: 新的收入来源渠道

### 👤 用户价值  
- **即时服务**: 无需等待人工审核
- **透明定价**: 明确的付费开通价格
- **服务保障**: 付费即享受完整服务

---

## 🎯 测试重点

1. **功能完整性**: 所有操作流程正常
2. **界面美观性**: 动画效果和视觉设计
3. **状态一致性**: 数据库状态正确更新
4. **错误处理**: 异常情况优雅处理
5. **用户体验**: 操作简单直观

测试愉快！🎉
