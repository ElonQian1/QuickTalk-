# 店铺审核流程完整测试方案

## 测试目标
验证店铺审核机制的完整流程，包括：
1. 店主提交店铺申请（包含域名描述）
2. 超级管理员审核管理界面
3. 审核通过/拒绝操作
4. 状态更新和通知

## 测试环境
- 服务器地址：http://localhost:3030
- 管理后台：http://localhost:3030/admin-new

## 测试账户
1. **超级管理员账户**
   - 用户名：`admin`
   - 密码：`admin123`
   - 权限：审核管理、系统管理、店铺管理

2. **店主账户**
   - 用户名：`shop_owner`
   - 密码：`123456`
   - 权限：创建店铺、管理自己的店铺

## 测试步骤

### 步骤1：店主创建店铺申请

1. 打开管理后台：http://localhost:3030/admin-new
2. 使用店主账户登录（shop_owner / 123456）
3. 点击"🏪 创建店铺"按钮
4. 填写店铺信息：
   ```
   店铺名称：测试电商店铺
   店铺域名：test-shop.example.com
   域名描述：这是一个测试电商网站，主要销售数码产品和电子设备，需要客服支持处理订单咨询、售后服务等业务。
   ```
5. 点击"创建店铺"提交申请

**预期结果：**
- 创建成功提示："店铺创建成功，等待管理员审核"
- 店铺列表中显示新店铺，状态为"🟡 待审核"
- 店铺卡片显示域名描述信息

### 步骤2：超级管理员审核

1. 退出当前用户（登出）
2. 使用超级管理员账户登录（admin / admin123）
3. 界面上应显示"📋 审核管理"按钮
4. 点击"📋 审核管理"按钮打开审核面板
5. 查看待审核店铺列表

**预期结果：**
- 审核管理面板正常打开
- 显示待审核店铺：
  - 店铺名称：测试电商店铺
  - 域名：test-shop.example.com
  - 域名描述：业务内容描述
  - 申请人：shop_owner
  - 提交时间：当前时间
  - 操作按钮：✅通过、❌拒绝

### 步骤3：测试审核通过流程

1. 在审核管理面板中，点击"✅ 通过"按钮
2. 确认审核通过操作

**预期结果：**
- 显示"审核通过！"提示
- 待审核列表中该店铺消失
- 数据库中店铺状态更新为"approved"

### 步骤4：验证审核结果

1. 切换回店主账户登录
2. 查看店铺列表

**预期结果：**
- 店铺状态显示为"🟢 已通过"
- 店铺可正常使用（客服功能可用）

### 步骤5：测试审核拒绝流程

1. 使用店主账户创建第二个店铺：
   ```
   店铺名称：测试博客网站
   店铺域名：blog.test.com
   域名描述：个人博客网站，主要发布技术文章
   ```
2. 使用超级管理员账户进入审核管理
3. 点击"❌ 拒绝"按钮
4. 在弹出对话框中输入拒绝原因："个人博客不符合商业客服需求"
5. 确认拒绝操作

**预期结果：**
- 显示"已拒绝申请"提示
- 店铺状态更新为"🔴 已拒绝"
- 拒绝原因被记录

## 技术验证点

### 前端功能
- [x] 创建店铺表单包含域名描述字段
- [x] 审核管理按钮仅对超级管理员显示
- [x] 审核面板正确显示待审核店铺信息
- [x] 状态标签颜色区分（待审核/已通过/已拒绝）
- [x] 操作按钮交互正常

### 后端API
- [x] POST /api/shops 支持description参数
- [x] GET /api/admin/pending-shops 返回待审核店铺
- [x] POST /api/admin/review-shop/:shopId 处理审核操作
- [x] 权限验证：只有super_admin可以审核

### 数据库
- [x] shops表支持description、status等字段
- [x] 创建店铺时状态默认为pending
- [x] 审核操作正确更新状态和审核信息

## 测试数据示例

### 测试用店铺数据
```javascript
// 电商店铺（应该通过）
{
    name: "阿里巴巴旗舰店",
    domain: "alibaba-flagship.com",
    description: "阿里巴巴官方旗舰店，销售各类商品，需要7*24小时客服支持，处理订单咨询、退换货、物流查询等服务。"
}

// 个人博客（应该拒绝）
{
    name: "小明的技术博客",
    domain: "xiaoming-blog.com", 
    description: "个人技术博客，分享编程心得和学习笔记。"
}

// 企业官网（应该通过）
{
    name: "科技公司官网",
    domain: "techcorp.com.cn",
    description: "科技公司官方网站，提供产品展示、客户支持、技术咨询等服务，需要客服系统处理客户咨询。"
}
```

## 边界测试

### 1. 权限测试
- 普通员工无法创建店铺
- 普通员工和店主无法访问审核管理
- 超级管理员可以访问所有功能

### 2. 数据验证
- 必填字段验证（名称、域名、描述）
- 域名唯一性检查
- 描述长度限制

### 3. 并发测试
- 多个审核员同时审核不同店铺
- 同一店铺不能被重复审核

## 成功标准

✅ **基础功能**
- 店主可以提交包含描述的店铺申请
- 超级管理员可以查看待审核列表
- 审核通过/拒绝操作正常工作
- 状态显示正确更新

✅ **用户体验**
- 界面友好，操作流程清晰
- 状态标签颜色区分明显
- 错误提示和成功提示及时准确

✅ **权限安全**
- 权限控制严格，无越权操作
- API接口权限验证有效

✅ **数据完整性**
- 审核记录完整（时间、操作人、原因）
- 状态变更准确无误

---

**测试完成后，系统应该支持：**
1. 🏪 店主申请 → 📋 管理员审核 → ✅ 状态更新 → 🎯 服务上线
2. 完整的审核工作流程
3. 权限分级管理
4. 审核历史追溯
